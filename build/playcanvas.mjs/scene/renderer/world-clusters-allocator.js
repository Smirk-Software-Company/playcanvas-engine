import { DebugHelper } from '../../core/debug.js';
import { WorldClusters } from '../lighting/world-clusters.js';

const tempClusterArray = [];

/**
 * A class managing instances of world clusters used by the renderer for layers with
 * unique sets of clustered lights.
 *
 * @ignore
 */
class WorldClustersAllocator {
  /**
   * Create a new instance.
   *
   * @param {import('../../platform/graphics/graphics-device.js').GraphicsDevice} graphicsDevice -
   * The graphics device.
   */
  constructor(graphicsDevice) {
    /**
     * Empty cluster with no lights.
     *
     * @type {WorldClusters|null}
     */
    this._empty = null;
    /**
     * All allocated clusters
     *
     * @type {WorldClusters[]}
     */
    this._allocated = [];
    /**
     * Render actions with all unique light clusters. The key is the hash of lights on a layer, the
     * value is a render action with unique light clusters.
     *
     * @type {Map<number, import('../composition/render-action.js').RenderAction>}
     */
    this._clusters = new Map();
    this.device = graphicsDevice;
  }
  destroy() {
    // empty light cluster
    if (this._empty) {
      this._empty.destroy();
      this._empty = null;
    }

    // all other clusters
    this._allocated.forEach(cluster => {
      cluster.destroy();
    });
    this._allocated.length = 0;
  }
  get count() {
    return this._allocated.length;
  }

  // returns an empty light cluster object to be used when no lights are used
  get empty() {
    if (!this._empty) {
      // create cluster structure with no lights
      const empty = new WorldClusters(this.device);
      empty.name = 'ClusterEmpty';

      // update it once to avoid doing it each frame
      empty.update([], false, null);
      this._empty = empty;
    }
    return this._empty;
  }

  // assign light clusters to render actions that need it
  assign(renderActions) {
    const empty = this.empty;

    // reuse previously allocated clusters
    tempClusterArray.push(...this._allocated);
    this._allocated.length = 0;
    this._clusters.clear();

    // process all render actions
    const count = renderActions.length;
    for (let i = 0; i < count; i++) {
      const ra = renderActions[i];
      ra.lightClusters = null;

      // if the layer has lights used by clusters, and meshes
      const layer = ra.layer;
      if (layer.hasClusteredLights && layer.meshInstances.length) {
        // use existing clusters if the lights on the layer are the same
        const hash = layer.getLightIdHash();
        const existingRenderAction = this._clusters.get(hash);
        let clusters = existingRenderAction == null ? void 0 : existingRenderAction.lightClusters;

        // no match, needs new clusters
        if (!clusters) {
          var _tempClusterArray$pop;
          // use already allocated cluster from last frame, or create a new one
          clusters = (_tempClusterArray$pop = tempClusterArray.pop()) != null ? _tempClusterArray$pop : new WorldClusters(this.device);
          DebugHelper.setName(clusters, `Cluster-${this._allocated.length}`);
          this._allocated.push(clusters);
          this._clusters.set(hash, ra);
        }
        ra.lightClusters = clusters;
      }

      // no clustered lights, use the cluster with no lights
      if (!ra.lightClusters) {
        ra.lightClusters = empty;
      }
    }

    // delete leftovers
    tempClusterArray.forEach(item => item.destroy());
    tempClusterArray.length = 0;
  }
  update(renderActions, gammaCorrection, lighting) {
    // assign clusters to render actions
    this.assign(renderActions);

    // update all unique clusters
    this._clusters.forEach(renderAction => {
      const layer = renderAction.layer;
      const cluster = renderAction.lightClusters;
      cluster.update(layer.clusteredLightsSet, gammaCorrection, lighting);
    });
  }
}

export { WorldClustersAllocator };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ybGQtY2x1c3RlcnMtYWxsb2NhdG9yLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvcmVuZGVyZXIvd29ybGQtY2x1c3RlcnMtYWxsb2NhdG9yLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERlYnVnSGVscGVyIH0gZnJvbSAnLi4vLi4vY29yZS9kZWJ1Zy5qcyc7XG5pbXBvcnQgeyBXb3JsZENsdXN0ZXJzIH0gZnJvbSAnLi4vbGlnaHRpbmcvd29ybGQtY2x1c3RlcnMuanMnO1xuXG5jb25zdCB0ZW1wQ2x1c3RlckFycmF5ID0gW107XG5cbi8qKlxuICogQSBjbGFzcyBtYW5hZ2luZyBpbnN0YW5jZXMgb2Ygd29ybGQgY2x1c3RlcnMgdXNlZCBieSB0aGUgcmVuZGVyZXIgZm9yIGxheWVycyB3aXRoXG4gKiB1bmlxdWUgc2V0cyBvZiBjbHVzdGVyZWQgbGlnaHRzLlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV29ybGRDbHVzdGVyc0FsbG9jYXRvciB7XG4gICAgLyoqXG4gICAgICogRW1wdHkgY2x1c3RlciB3aXRoIG5vIGxpZ2h0cy5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtXb3JsZENsdXN0ZXJzfG51bGx9XG4gICAgICovXG4gICAgX2VtcHR5ID0gbnVsbDtcblxuICAgIC8qKlxuICAgICAqIEFsbCBhbGxvY2F0ZWQgY2x1c3RlcnNcbiAgICAgKlxuICAgICAqIEB0eXBlIHtXb3JsZENsdXN0ZXJzW119XG4gICAgICovXG4gICAgX2FsbG9jYXRlZCA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIGFjdGlvbnMgd2l0aCBhbGwgdW5pcXVlIGxpZ2h0IGNsdXN0ZXJzLiBUaGUga2V5IGlzIHRoZSBoYXNoIG9mIGxpZ2h0cyBvbiBhIGxheWVyLCB0aGVcbiAgICAgKiB2YWx1ZSBpcyBhIHJlbmRlciBhY3Rpb24gd2l0aCB1bmlxdWUgbGlnaHQgY2x1c3RlcnMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7TWFwPG51bWJlciwgaW1wb3J0KCcuLi9jb21wb3NpdGlvbi9yZW5kZXItYWN0aW9uLmpzJykuUmVuZGVyQWN0aW9uPn1cbiAgICAgKi9cbiAgICBfY2x1c3RlcnMgPSBuZXcgTWFwKCk7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZ3JhcGhpY3MtZGV2aWNlLmpzJykuR3JhcGhpY3NEZXZpY2V9IGdyYXBoaWNzRGV2aWNlIC1cbiAgICAgKiBUaGUgZ3JhcGhpY3MgZGV2aWNlLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGdyYXBoaWNzRGV2aWNlKSB7XG4gICAgICAgIHRoaXMuZGV2aWNlID0gZ3JhcGhpY3NEZXZpY2U7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcblxuICAgICAgICAvLyBlbXB0eSBsaWdodCBjbHVzdGVyXG4gICAgICAgIGlmICh0aGlzLl9lbXB0eSkge1xuICAgICAgICAgICAgdGhpcy5fZW1wdHkuZGVzdHJveSgpO1xuICAgICAgICAgICAgdGhpcy5fZW1wdHkgPSBudWxsO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gYWxsIG90aGVyIGNsdXN0ZXJzXG4gICAgICAgIHRoaXMuX2FsbG9jYXRlZC5mb3JFYWNoKChjbHVzdGVyKSA9PiB7XG4gICAgICAgICAgICBjbHVzdGVyLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuX2FsbG9jYXRlZC5sZW5ndGggPSAwO1xuICAgIH1cblxuICAgIGdldCBjb3VudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FsbG9jYXRlZC5sZW5ndGg7XG4gICAgfVxuXG4gICAgLy8gcmV0dXJucyBhbiBlbXB0eSBsaWdodCBjbHVzdGVyIG9iamVjdCB0byBiZSB1c2VkIHdoZW4gbm8gbGlnaHRzIGFyZSB1c2VkXG4gICAgZ2V0IGVtcHR5KCkge1xuICAgICAgICBpZiAoIXRoaXMuX2VtcHR5KSB7XG5cbiAgICAgICAgICAgIC8vIGNyZWF0ZSBjbHVzdGVyIHN0cnVjdHVyZSB3aXRoIG5vIGxpZ2h0c1xuICAgICAgICAgICAgY29uc3QgZW1wdHkgPSBuZXcgV29ybGRDbHVzdGVycyh0aGlzLmRldmljZSk7XG4gICAgICAgICAgICBlbXB0eS5uYW1lID0gJ0NsdXN0ZXJFbXB0eSc7XG5cbiAgICAgICAgICAgIC8vIHVwZGF0ZSBpdCBvbmNlIHRvIGF2b2lkIGRvaW5nIGl0IGVhY2ggZnJhbWVcbiAgICAgICAgICAgIGVtcHR5LnVwZGF0ZShbXSwgZmFsc2UsIG51bGwpO1xuICAgICAgICAgICAgdGhpcy5fZW1wdHkgPSBlbXB0eTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9lbXB0eTtcbiAgICB9XG5cbiAgICAvLyBhc3NpZ24gbGlnaHQgY2x1c3RlcnMgdG8gcmVuZGVyIGFjdGlvbnMgdGhhdCBuZWVkIGl0XG4gICAgYXNzaWduKHJlbmRlckFjdGlvbnMpIHtcblxuICAgICAgICBjb25zdCBlbXB0eSA9IHRoaXMuZW1wdHk7XG5cbiAgICAgICAgLy8gcmV1c2UgcHJldmlvdXNseSBhbGxvY2F0ZWQgY2x1c3RlcnNcbiAgICAgICAgdGVtcENsdXN0ZXJBcnJheS5wdXNoKC4uLnRoaXMuX2FsbG9jYXRlZCk7XG4gICAgICAgIHRoaXMuX2FsbG9jYXRlZC5sZW5ndGggPSAwO1xuICAgICAgICB0aGlzLl9jbHVzdGVycy5jbGVhcigpO1xuXG4gICAgICAgIC8vIHByb2Nlc3MgYWxsIHJlbmRlciBhY3Rpb25zXG4gICAgICAgIGNvbnN0IGNvdW50ID0gcmVuZGVyQWN0aW9ucy5sZW5ndGg7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgcmEgPSByZW5kZXJBY3Rpb25zW2ldO1xuICAgICAgICAgICAgcmEubGlnaHRDbHVzdGVycyA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIGlmIHRoZSBsYXllciBoYXMgbGlnaHRzIHVzZWQgYnkgY2x1c3RlcnMsIGFuZCBtZXNoZXNcbiAgICAgICAgICAgIGNvbnN0IGxheWVyID0gcmEubGF5ZXI7XG4gICAgICAgICAgICBpZiAobGF5ZXIuaGFzQ2x1c3RlcmVkTGlnaHRzICYmIGxheWVyLm1lc2hJbnN0YW5jZXMubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAvLyB1c2UgZXhpc3RpbmcgY2x1c3RlcnMgaWYgdGhlIGxpZ2h0cyBvbiB0aGUgbGF5ZXIgYXJlIHRoZSBzYW1lXG4gICAgICAgICAgICAgICAgY29uc3QgaGFzaCA9IGxheWVyLmdldExpZ2h0SWRIYXNoKCk7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdSZW5kZXJBY3Rpb24gPSB0aGlzLl9jbHVzdGVycy5nZXQoaGFzaCk7XG4gICAgICAgICAgICAgICAgbGV0IGNsdXN0ZXJzID0gZXhpc3RpbmdSZW5kZXJBY3Rpb24/LmxpZ2h0Q2x1c3RlcnM7XG5cbiAgICAgICAgICAgICAgICAvLyBubyBtYXRjaCwgbmVlZHMgbmV3IGNsdXN0ZXJzXG4gICAgICAgICAgICAgICAgaWYgKCFjbHVzdGVycykge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHVzZSBhbHJlYWR5IGFsbG9jYXRlZCBjbHVzdGVyIGZyb20gbGFzdCBmcmFtZSwgb3IgY3JlYXRlIGEgbmV3IG9uZVxuICAgICAgICAgICAgICAgICAgICBjbHVzdGVycyA9IHRlbXBDbHVzdGVyQXJyYXkucG9wKCkgPz8gbmV3IFdvcmxkQ2x1c3RlcnModGhpcy5kZXZpY2UpO1xuICAgICAgICAgICAgICAgICAgICBEZWJ1Z0hlbHBlci5zZXROYW1lKGNsdXN0ZXJzLCBgQ2x1c3Rlci0ke3RoaXMuX2FsbG9jYXRlZC5sZW5ndGh9YCk7XG5cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWxsb2NhdGVkLnB1c2goY2x1c3RlcnMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jbHVzdGVycy5zZXQoaGFzaCwgcmEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJhLmxpZ2h0Q2x1c3RlcnMgPSBjbHVzdGVycztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbm8gY2x1c3RlcmVkIGxpZ2h0cywgdXNlIHRoZSBjbHVzdGVyIHdpdGggbm8gbGlnaHRzXG4gICAgICAgICAgICBpZiAoIXJhLmxpZ2h0Q2x1c3RlcnMpIHtcbiAgICAgICAgICAgICAgICByYS5saWdodENsdXN0ZXJzID0gZW1wdHk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBkZWxldGUgbGVmdG92ZXJzXG4gICAgICAgIHRlbXBDbHVzdGVyQXJyYXkuZm9yRWFjaChpdGVtID0+IGl0ZW0uZGVzdHJveSgpKTtcbiAgICAgICAgdGVtcENsdXN0ZXJBcnJheS5sZW5ndGggPSAwO1xuICAgIH1cblxuICAgIHVwZGF0ZShyZW5kZXJBY3Rpb25zLCBnYW1tYUNvcnJlY3Rpb24sIGxpZ2h0aW5nKSB7XG5cbiAgICAgICAgLy8gYXNzaWduIGNsdXN0ZXJzIHRvIHJlbmRlciBhY3Rpb25zXG4gICAgICAgIHRoaXMuYXNzaWduKHJlbmRlckFjdGlvbnMpO1xuXG4gICAgICAgIC8vIHVwZGF0ZSBhbGwgdW5pcXVlIGNsdXN0ZXJzXG4gICAgICAgIHRoaXMuX2NsdXN0ZXJzLmZvckVhY2goKHJlbmRlckFjdGlvbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbGF5ZXIgPSByZW5kZXJBY3Rpb24ubGF5ZXI7XG4gICAgICAgICAgICBjb25zdCBjbHVzdGVyID0gcmVuZGVyQWN0aW9uLmxpZ2h0Q2x1c3RlcnM7XG4gICAgICAgICAgICBjbHVzdGVyLnVwZGF0ZShsYXllci5jbHVzdGVyZWRMaWdodHNTZXQsIGdhbW1hQ29ycmVjdGlvbiwgbGlnaHRpbmcpO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdvcmxkQ2x1c3RlcnNBbGxvY2F0b3IgfTtcbiJdLCJuYW1lcyI6WyJ0ZW1wQ2x1c3RlckFycmF5IiwiV29ybGRDbHVzdGVyc0FsbG9jYXRvciIsImNvbnN0cnVjdG9yIiwiZ3JhcGhpY3NEZXZpY2UiLCJfZW1wdHkiLCJfYWxsb2NhdGVkIiwiX2NsdXN0ZXJzIiwiTWFwIiwiZGV2aWNlIiwiZGVzdHJveSIsImZvckVhY2giLCJjbHVzdGVyIiwibGVuZ3RoIiwiY291bnQiLCJlbXB0eSIsIldvcmxkQ2x1c3RlcnMiLCJuYW1lIiwidXBkYXRlIiwiYXNzaWduIiwicmVuZGVyQWN0aW9ucyIsInB1c2giLCJjbGVhciIsImkiLCJyYSIsImxpZ2h0Q2x1c3RlcnMiLCJsYXllciIsImhhc0NsdXN0ZXJlZExpZ2h0cyIsIm1lc2hJbnN0YW5jZXMiLCJoYXNoIiwiZ2V0TGlnaHRJZEhhc2giLCJleGlzdGluZ1JlbmRlckFjdGlvbiIsImdldCIsImNsdXN0ZXJzIiwiX3RlbXBDbHVzdGVyQXJyYXkkcG9wIiwicG9wIiwiRGVidWdIZWxwZXIiLCJzZXROYW1lIiwic2V0IiwiaXRlbSIsImdhbW1hQ29ycmVjdGlvbiIsImxpZ2h0aW5nIiwicmVuZGVyQWN0aW9uIiwiY2x1c3RlcmVkTGlnaHRzU2V0Il0sIm1hcHBpbmdzIjoiOzs7QUFHQSxNQUFNQSxnQkFBZ0IsR0FBRyxFQUFFLENBQUE7O0FBRTNCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLHNCQUFzQixDQUFDO0FBdUJ6QjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7RUFDSUMsV0FBV0EsQ0FBQ0MsY0FBYyxFQUFFO0FBNUI1QjtBQUNKO0FBQ0E7QUFDQTtBQUNBO0lBSkksSUFLQUMsQ0FBQUEsTUFBTSxHQUFHLElBQUksQ0FBQTtBQUViO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7SUFKSSxJQUtBQyxDQUFBQSxVQUFVLEdBQUcsRUFBRSxDQUFBO0FBRWY7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEksSUFBQSxJQUFBLENBTUFDLFNBQVMsR0FBRyxJQUFJQyxHQUFHLEVBQUUsQ0FBQTtJQVNqQixJQUFJLENBQUNDLE1BQU0sR0FBR0wsY0FB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
