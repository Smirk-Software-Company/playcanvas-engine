import { Vec4 } from '../../core/math/vec4.js';
import { Mat4 } from '../../core/math/mat4.js';
import { CULLFACE_NONE } from '../../platform/graphics/constants.js';
import { DebugGraphics } from '../../platform/graphics/debug-graphics.js';
import { LIGHTTYPE_OMNI } from '../constants.js';
import { createShaderFromCode } from '../shader-lib/utils.js';
import { LightCamera } from './light-camera.js';
import { BlendState } from '../../platform/graphics/blend-state.js';
import { QuadRender } from '../graphics/quad-render.js';
import { DepthState } from '../../platform/graphics/depth-state.js';
import { RenderPass } from '../../platform/graphics/render-pass.js';

const textureBlitVertexShader = /* glsl */`
    attribute vec2 vertex_position;
    varying vec2 uv0;
    void main(void) {
        gl_Position = vec4(vertex_position, 0.5, 1.0);
        uv0 = vertex_position.xy * 0.5 + 0.5;
        #ifndef WEBGPU
            uv0.y = 1.0 - uv0.y;
        #endif
    }`;
const textureBlitFragmentShader = /* glsl */`
    varying vec2 uv0;
    uniform sampler2D blitTexture;
    void main(void) {
        gl_FragColor = texture2D(blitTexture, uv0);
    }`;

// shader runs for each face, with inViewProj matrix representing a face camera
const textureCubeBlitFragmentShader = /* glsl */`
    varying vec2 uv0;
    uniform samplerCube blitTexture;
    uniform mat4 invViewProj;
    void main(void) {
        vec4 projPos = vec4(uv0 * 2.0 - 1.0, 0.5, 1.0);
        vec4 worldPos = invViewProj * projPos;
        gl_FragColor = textureCube(blitTexture, worldPos.xyz);
    }`;
const _viewport = new Vec4();

// for rendering of cookies, store inverse view projection matrices for 6 faces, allowing cubemap faces to be copied into the atlas
const _invViewProjMatrices = [];

/**
 * A render pass used to render cookie textures (both 2D and Cubemap) into the texture atlas.
 *
 * @ignore
 */
class RenderPassCookieRenderer extends RenderPass {
  constructor(device, cubeSlotsOffsets) {
    super(device);
    /** @type {QuadRender|null} */
    this._quadRenderer2D = null;
    /** @type {QuadRender|null} */
    this._quadRendererCube = null;
    this._filteredLights = [];
    this._cubeSlotsOffsets = cubeSlotsOffsets;
    this.blitTextureId = device.scope.resolve('blitTexture');
    this.invViewProjId = device.scope.resolve('invViewProj');
  }
  destroy() {
    var _this$_quadRenderer2D, _this$_quadRendererCu;
    (_this$_quadRenderer2D = this._quadRenderer2D) == null ? void 0 : _this$_quadRenderer2D.destroy();
    this._quadRenderer2D = null;
    (_this$_quadRendererCu = this._quadRendererCube) == null ? void 0 : _this$_quadRendererCu.destroy();
    this._quadRendererCube = null;
  }
  initInvViewProjMatrices() {
    if (!_invViewProjMatrices.length) {
      for (let face = 0; face < 6; face++) {
        const camera = LightCamera.create(null, LIGHTTYPE_OMNI, face);
        const projMat = camera.projectionMatrix;
        const viewMat = camera.node.getLocalTransform().clone().invert();
        _invViewProjMatrices[face] = new Mat4().mul2(projMat, viewMat).invert();
      }
    }
  }
  get quadRenderer2D() {
    if (!this._quadRenderer2D) {
      const shader = createShaderFromCode(this.device, textureBlitVertexShader, textureBlitFragmentShader, `cookieRenderer2d`);
      this._quadRenderer2D = new QuadRender(shader);
    }
    return this._quadRenderer2D;
  }
  get quadRendererCube() {
    if (!this._quadRendererCube) {
      const shader = createShaderFromCode(this.device, textureBlitVertexShader, textureCubeBlitFragmentShader, `cookieRendererCube`);
      this._quadRendererCube = new QuadRender(shader);
    }
    return this._quadRendererCube;
  }
  execute() {
    // render state
    const device = this.device;
    device.setBlendState(BlendState.NOBLEND);
    device.setCullMode(CULLFACE_NONE);
    device.setDepthState(DepthState.NODEPTH);
    device.setStencilState();
    const renderTargetWidth = this.renderTarget.colorBuffer.width;
    const cubeSlotsOffsets = this._cubeSlotsOffsets;
    const filteredLights = this._filteredLights;
    for (let i = 0; i < filteredLights.length; i++) {
      const light = filteredLights[i];
      DebugGraphics.pushGpuMarker(this.device, `COOKIE ${light._node.name}`);
      const faceCount = light.numShadowFaces;
      const quad = faceCount > 1 ? this.quadRendererCube : this.quadRenderer2D;
      if (faceCount > 1) {
        this.initInvViewProjMatrices();
      }

      // source texture
      this.blitTextureId.setValue(light.cookie);

      // render it to a viewport of the target
      for (let face = 0; face < faceCount; face++) {
        _viewport.copy(light.atlasViewport);
        if (faceCount > 1) {
          // for cubemap, render to one of the 3x3 sub-areas
          const smallSize = _viewport.z / 3;
          const offset = cubeSlotsOffsets[face];
          _viewport.x += smallSize * offset.x;
          _viewport.y += smallSize * offset.y;
          _viewport.z = smallSize;
          _viewport.w = smallSize;

          // cubemap face projection uniform
          this.invViewProjId.setValue(_invViewProjMatrices[face].data);
        }
        _viewport.mulScalar(renderTargetWidth);
        quad.render(_viewport);
      }
      DebugGraphics.popGpuMarker(device);
    }
  }
}

export { RenderPassCookieRenderer };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLXBhc3MtY29va2llLXJlbmRlcmVyLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvc2NlbmUvcmVuZGVyZXIvcmVuZGVyLXBhc3MtY29va2llLXJlbmRlcmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFZlYzQgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjNC5qcyc7XG5pbXBvcnQgeyBNYXQ0IH0gZnJvbSAnLi4vLi4vY29yZS9tYXRoL21hdDQuanMnO1xuaW1wb3J0IHsgQ1VMTEZBQ0VfTk9ORSB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBEZWJ1Z0dyYXBoaWNzIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZGVidWctZ3JhcGhpY3MuanMnO1xuaW1wb3J0IHsgTElHSFRUWVBFX09NTkkgfSBmcm9tICcuLi9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgY3JlYXRlU2hhZGVyRnJvbUNvZGUgfSBmcm9tICcuLi9zaGFkZXItbGliL3V0aWxzLmpzJztcbmltcG9ydCB7IExpZ2h0Q2FtZXJhIH0gZnJvbSAnLi9saWdodC1jYW1lcmEuanMnO1xuaW1wb3J0IHsgQmxlbmRTdGF0ZSB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL2dyYXBoaWNzL2JsZW5kLXN0YXRlLmpzJztcbmltcG9ydCB7IFF1YWRSZW5kZXIgfSBmcm9tICcuLi9ncmFwaGljcy9xdWFkLXJlbmRlci5qcyc7XG5pbXBvcnQgeyBEZXB0aFN0YXRlIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vZ3JhcGhpY3MvZGVwdGgtc3RhdGUuanMnO1xuaW1wb3J0IHsgUmVuZGVyUGFzcyB9IGZyb20gXCIuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9yZW5kZXItcGFzcy5qc1wiO1xuXG5jb25zdCB0ZXh0dXJlQmxpdFZlcnRleFNoYWRlciA9IC8qIGdsc2wgKi8gYFxuICAgIGF0dHJpYnV0ZSB2ZWMyIHZlcnRleF9wb3NpdGlvbjtcbiAgICB2YXJ5aW5nIHZlYzIgdXYwO1xuICAgIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgICAgIGdsX1Bvc2l0aW9uID0gdmVjNCh2ZXJ0ZXhfcG9zaXRpb24sIDAuNSwgMS4wKTtcbiAgICAgICAgdXYwID0gdmVydGV4X3Bvc2l0aW9uLnh5ICogMC41ICsgMC41O1xuICAgICAgICAjaWZuZGVmIFdFQkdQVVxuICAgICAgICAgICAgdXYwLnkgPSAxLjAgLSB1djAueTtcbiAgICAgICAgI2VuZGlmXG4gICAgfWA7XG5cbmNvbnN0IHRleHR1cmVCbGl0RnJhZ21lbnRTaGFkZXIgPSAvKiBnbHNsICovIGBcbiAgICB2YXJ5aW5nIHZlYzIgdXYwO1xuICAgIHVuaWZvcm0gc2FtcGxlcjJEIGJsaXRUZXh0dXJlO1xuICAgIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmUyRChibGl0VGV4dHVyZSwgdXYwKTtcbiAgICB9YDtcblxuLy8gc2hhZGVyIHJ1bnMgZm9yIGVhY2ggZmFjZSwgd2l0aCBpblZpZXdQcm9qIG1hdHJpeCByZXByZXNlbnRpbmcgYSBmYWNlIGNhbWVyYVxuY29uc3QgdGV4dHVyZUN1YmVCbGl0RnJhZ21lbnRTaGFkZXIgPSAvKiBnbHNsICovIGBcbiAgICB2YXJ5aW5nIHZlYzIgdXYwO1xuICAgIHVuaWZvcm0gc2FtcGxlckN1YmUgYmxpdFRleHR1cmU7XG4gICAgdW5pZm9ybSBtYXQ0IGludlZpZXdQcm9qO1xuICAgIHZvaWQgbWFpbih2b2lkKSB7XG4gICAgICAgIHZlYzQgcHJvalBvcyA9IHZlYzQodXYwICogMi4wIC0gMS4wLCAwLjUsIDEuMCk7XG4gICAgICAgIHZlYzQgd29ybGRQb3MgPSBpbnZWaWV3UHJvaiAqIHByb2pQb3M7XG4gICAgICAgIGdsX0ZyYWdDb2xvciA9IHRleHR1cmVDdWJlKGJsaXRUZXh0dXJlLCB3b3JsZFBvcy54eXopO1xuICAgIH1gO1xuXG5jb25zdCBfdmlld3BvcnQgPSBuZXcgVmVjNCgpO1xuXG4vLyBmb3IgcmVuZGVyaW5nIG9mIGNvb2tpZXMsIHN0b3JlIGludmVyc2UgdmlldyBwcm9qZWN0aW9uIG1hdHJpY2VzIGZvciA2IGZhY2VzLCBhbGxvd2luZyBjdWJlbWFwIGZhY2VzIHRvIGJlIGNvcGllZCBpbnRvIHRoZSBhdGxhc1xuY29uc3QgX2ludlZpZXdQcm9qTWF0cmljZXMgPSBbXTtcblxuLyoqXG4gKiBBIHJlbmRlciBwYXNzIHVzZWQgdG8gcmVuZGVyIGNvb2tpZSB0ZXh0dXJlcyAoYm90aCAyRCBhbmQgQ3ViZW1hcCkgaW50byB0aGUgdGV4dHVyZSBhdGxhcy5cbiAqXG4gKiBAaWdub3JlXG4gKi9cbmNsYXNzIFJlbmRlclBhc3NDb29raWVSZW5kZXJlciBleHRlbmRzIFJlbmRlclBhc3Mge1xuICAgIC8qKiBAdHlwZSB7UXVhZFJlbmRlcnxudWxsfSAqL1xuICAgIF9xdWFkUmVuZGVyZXIyRCA9IG51bGw7XG5cbiAgICAvKiogQHR5cGUge1F1YWRSZW5kZXJ8bnVsbH0gKi9cbiAgICBfcXVhZFJlbmRlcmVyQ3ViZSA9IG51bGw7XG5cbiAgICBfZmlsdGVyZWRMaWdodHMgPSBbXTtcblxuICAgIGNvbnN0cnVjdG9yKGRldmljZSwgY3ViZVNsb3RzT2Zmc2V0cykge1xuICAgICAgICBzdXBlcihkZXZpY2UpO1xuICAgICAgICB0aGlzLl9jdWJlU2xvdHNPZmZzZXRzID0gY3ViZVNsb3RzT2Zmc2V0cztcblxuICAgICAgICB0aGlzLmJsaXRUZXh0dXJlSWQgPSBkZXZpY2Uuc2NvcGUucmVzb2x2ZSgnYmxpdFRleHR1cmUnKTtcbiAgICAgICAgdGhpcy5pbnZWaWV3UHJvaklkID0gZGV2aWNlLnNjb3BlLnJlc29sdmUoJ2ludlZpZXdQcm9qJyk7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5fcXVhZFJlbmRlcmVyMkQ/LmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fcXVhZFJlbmRlcmVyMkQgPSBudWxsO1xuXG4gICAgICAgIHRoaXMuX3F1YWRSZW5kZXJlckN1YmU/LmRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy5fcXVhZFJlbmRlcmVyQ3ViZSA9IG51bGw7XG4gICAgfVxuXG4gICAgaW5pdEludlZpZXdQcm9qTWF0cmljZXMoKSB7XG4gICAgICAgIGlmICghX2ludlZpZXdQcm9qTWF0cmljZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IDY7IGZhY2UrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNhbWVyYSA9IExpZ2h0Q2FtZXJhLmNyZWF0ZShudWxsLCBMSUdIVFRZUEVfT01OSSwgZmFjZSk7XG4gICAgICAgICAgICAgICAgY29uc3QgcHJvak1hdCA9IGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4O1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXdNYXQgPSBjYW1lcmEubm9kZS5nZXRMb2NhbFRyYW5zZm9ybSgpLmNsb25lKCkuaW52ZXJ0KCk7XG4gICAgICAgICAgICAgICAgX2ludlZpZXdQcm9qTWF0cmljZXNbZmFjZV0gPSBuZXcgTWF0NCgpLm11bDIocHJvak1hdCwgdmlld01hdCkuaW52ZXJ0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgcXVhZFJlbmRlcmVyMkQoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcXVhZFJlbmRlcmVyMkQpIHtcbiAgICAgICAgICAgIGNvbnN0IHNoYWRlciA9IGNyZWF0ZVNoYWRlckZyb21Db2RlKHRoaXMuZGV2aWNlLCB0ZXh0dXJlQmxpdFZlcnRleFNoYWRlciwgdGV4dHVyZUJsaXRGcmFnbWVudFNoYWRlciwgYGNvb2tpZVJlbmRlcmVyMmRgKTtcbiAgICAgICAgICAgIHRoaXMuX3F1YWRSZW5kZXJlcjJEID0gbmV3IFF1YWRSZW5kZXIoc2hhZGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fcXVhZFJlbmRlcmVyMkQ7XG4gICAgfVxuXG4gICAgZ2V0IHF1YWRSZW5kZXJlckN1YmUoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcXVhZFJlbmRlcmVyQ3ViZSkge1xuICAgICAgICAgICAgY29uc3Qgc2hhZGVyID0gY3JlYXRlU2hhZGVyRnJvbUNvZGUodGhpcy5kZXZpY2UsIHRleHR1cmVCbGl0VmVydGV4U2hhZGVyLCB0ZXh0dXJlQ3ViZUJsaXRGcmFnbWVudFNoYWRlciwgYGNvb2tpZVJlbmRlcmVyQ3ViZWApO1xuICAgICAgICAgICAgdGhpcy5fcXVhZFJlbmRlcmVyQ3ViZSA9IG5ldyBRdWFkUmVuZGVyKHNoYWRlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1YWRSZW5kZXJlckN1YmU7XG4gICAgfVxuXG4gICAgZXhlY3V0ZSgpIHtcblxuICAgICAgICAvLyByZW5kZXIgc3RhdGVcbiAgICAgICAgY29uc3QgZGV2aWNlID0gdGhpcy5kZXZpY2U7XG4gICAgICAgIGRldmljZS5zZXRCbGVuZFN0YXRlKEJsZW5kU3RhdGUuTk9CTEVORCk7XG4gICAgICAgIGRldmljZS5zZXRDdWxsTW9kZShDVUxMRkFDRV9OT05FKTtcbiAgICAgICAgZGV2aWNlLnNldERlcHRoU3RhdGUoRGVwdGhTdGF0ZS5OT0RFUFRIKTtcbiAgICAgICAgZGV2aWNlLnNldFN0ZW5jaWxTdGF0ZSgpO1xuXG4gICAgICAgIGNvbnN0IHJlbmRlclRhcmdldFdpZHRoID0gdGhpcy5yZW5kZXJUYXJnZXQuY29sb3JCdWZmZXIud2lkdGg7XG4gICAgICAgIGNvbnN0IGN1YmVTbG90c09mZnNldHMgPSB0aGlzLl9jdWJlU2xvdHNPZmZzZXRzO1xuXG4gICAgICAgIGNvbnN0IGZpbHRlcmVkTGlnaHRzID0gdGhpcy5fZmlsdGVyZWRMaWdodHM7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZmlsdGVyZWRMaWdodHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGxpZ2h0ID0gZmlsdGVyZWRMaWdodHNbaV07XG5cbiAgICAgICAgICAgIERlYnVnR3JhcGhpY3MucHVzaEdwdU1hcmtlcih0aGlzLmRldmljZSwgYENPT0tJRSAke2xpZ2h0Ll9ub2RlLm5hbWV9YCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGZhY2VDb3VudCA9IGxpZ2h0Lm51bVNoYWRvd0ZhY2VzO1xuICAgICAgICAgICAgY29uc3QgcXVhZCA9IGZhY2VDb3VudCA+IDEgPyB0aGlzLnF1YWRSZW5kZXJlckN1YmUgOiB0aGlzLnF1YWRSZW5kZXJlcjJEO1xuXG4gICAgICAgICAgICBpZiAoZmFjZUNvdW50ID4gMSkge1xuICAgICAgICAgICAgICAgIHRoaXMuaW5pdEludlZpZXdQcm9qTWF0cmljZXMoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc291cmNlIHRleHR1cmVcbiAgICAgICAgICAgIHRoaXMuYmxpdFRleHR1cmVJZC5zZXRWYWx1ZShsaWdodC5jb29raWUpO1xuXG4gICAgICAgICAgICAvLyByZW5kZXIgaXQgdG8gYSB2aWV3cG9ydCBvZiB0aGUgdGFyZ2V0XG4gICAgICAgICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGZhY2VDb3VudDsgZmFjZSsrKSB7XG5cbiAgICAgICAgICAgICAgICBfdmlld3BvcnQuY29weShsaWdodC5hdGxhc1ZpZXdwb3J0KTtcblxuICAgICAgICAgICAgICAgIGlmIChmYWNlQ291bnQgPiAxKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGN1YmVtYXAsIHJlbmRlciB0byBvbmUgb2YgdGhlIDN4MyBzdWItYXJlYXNcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc21hbGxTaXplID0gX3ZpZXdwb3J0LnogLyAzO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBjdWJlU2xvdHNPZmZzZXRzW2ZhY2VdO1xuICAgICAgICAgICAgICAgICAgICBfdmlld3BvcnQueCArPSBzbWFsbFNpemUgKiBvZmZzZXQueDtcbiAgICAgICAgICAgICAgICAgICAgX3ZpZXdwb3J0LnkgKz0gc21hbGxTaXplICogb2Zmc2V0Lnk7XG4gICAgICAgICAgICAgICAgICAgIF92aWV3cG9ydC56ID0gc21hbGxTaXplO1xuICAgICAgICAgICAgICAgICAgICBfdmlld3BvcnQudyA9IHNtYWxsU2l6ZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjdWJlbWFwIGZhY2UgcHJvamVjdGlvbiB1bmlmb3JtXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaW52Vmlld1Byb2pJZC5zZXRWYWx1ZShfaW52Vmlld1Byb2pNYXRyaWNlc1tmYWNlXS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBfdmlld3BvcnQubXVsU2NhbGFyKHJlbmRlclRhcmdldFdpZHRoKTtcblxuICAgICAgICAgICAgICAgIHF1YWQucmVuZGVyKF92aWV3cG9ydCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIERlYnVnR3JhcGhpY3MucG9wR3B1TWFya2VyKGRldmljZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IFJlbmRlclBhc3NDb29raWVSZW5kZXJlciB9O1xuIl0sIm5hbWVzIjpbInRleHR1cmVCbGl0VmVydGV4U2hhZGVyIiwidGV4dHVyZUJsaXRGcmFnbWVudFNoYWRlciIsInRleHR1cmVDdWJlQmxpdEZyYWdtZW50U2hhZGVyIiwiX3ZpZXdwb3J0IiwiVmVjNCIsIl9pbnZWaWV3UHJvak1hdHJpY2VzIiwiUmVuZGVyUGFzc0Nvb2tpZVJlbmRlcmVyIiwiUmVuZGVyUGFzcyIsImNvbnN0cnVjdG9yIiwiZGV2aWNlIiwiY3ViZVNsb3RzT2Zmc2V0cyIsIl9xdWFkUmVuZGVyZXIyRCIsIl9xdWFkUmVuZGVyZXJDdWJlIiwiX2ZpbHRlcmVkTGlnaHRzIiwiX2N1YmVTbG90c09mZnNldHMiLCJibGl0VGV4dHVyZUlkIiwic2NvcGUiLCJyZXNvbHZlIiwiaW52Vmlld1Byb2pJZCIsImRlc3Ryb3kiLCJfdGhpcyRfcXVhZFJlbmRlcmVyMkQiLCJfdGhpcyRfcXVhZFJlbmRlcmVyQ3UiLCJpbml0SW52Vmlld1Byb2pNYXRyaWNlcyIsImxlbmd0aCIsImZhY2UiLCJjYW1lcmEiLCJMaWdodENhbWVyYSIsImNyZWF0ZSIsIkxJR0hUVFlQRV9PTU5JIiwicHJvak1hdCIsInByb2plY3Rpb25NYXRyaXgiLCJ2aWV3TWF0Iiwibm9kZSIsImdldExvY2FsVHJhbnNmb3JtIiwiY2xvbmUiLCJpbnZlcnQiLCJNYXQ0IiwibXVsMiIsInF1YWRSZW5kZXJlcjJEIiwic2hhZGVyIiwiY3JlYXRlU2hhZGVyRnJvbUNvZGUiLCJRdWFkUmVuZGVyIiwicXVhZFJlbmRlcmVyQ3ViZSIsImV4ZWN1dGUiLCJzZXRCbGVuZFN0YXRlIiwiQmxlbmRTdGF0ZSIsIk5PQkxFTkQiLCJzZXRDdWxsTW9kZSIsIkNVTExGQUNFX05PTkUiLCJzZXREZXB0aFN0YXRlIiwiRGVwdGhTdGF0ZSIsIk5PREVQVEgiLCJzZXRTdGVuY2lsU3RhdGUiLCJyZW5kZXJUYXJnZXRXaWR0aCIsInJlbmRlclRhcmdldCIsImNvbG9yQnVmZmVyIiwid2lkdGgiLCJmaWx0ZXJlZExpZ2h0cyIsImkiLCJsaWdodCIsIkRlYnVnR3JhcGhpY3MiLCJwdXNoR3B1TWFya2VyIiwiX25vZGUiLCJuYW1lIiwiZmFjZUNvdW50IiwibnVtU2hhZG93RmFjZXMiLCJxdWFkIiwic2V0VmFsdWUiLCJjb29raWUiLCJjb3B5IiwiYXRsYXNWaWV3cG9ydCIsInNtYWxsU2l6ZSIsInoiLCJvZmZzZXQiLCJ4IiwieSIsInciLCJkYXRhIiwibXVsU2NhbGFyIiwicmVuZGVyIiwicG9wR3B1TWFya2VyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFZQSxNQUFNQSx1QkFBdUIsYUFBZSxDQUFBO0FBQzVDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFNLENBQUEsQ0FBQTtBQUVOLE1BQU1DLHlCQUF5QixhQUFlLENBQUE7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFNLENBQUEsQ0FBQTs7QUFFTjtBQUNBLE1BQU1DLDZCQUE2QixhQUFlLENBQUE7QUFDbEQ7QUFDQTtB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
