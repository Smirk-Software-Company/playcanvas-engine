import { SHADER_FORWARDHDR, GAMMA_SRGBHDR, TONEMAP_LINEAR, SHADERDEF_SCREENSPACE, SHADERDEF_SKIN, SHADERDEF_INSTANCING, SHADERDEF_MORPH_POSITION, SHADERDEF_MORPH_NORMAL, SHADERDEF_MORPH_TEXTURE_BASED, SHADERDEF_TANGENTS, SPRITE_RENDERMODE_SIMPLE, CUBEPROJ_NONE, SPECULAR_BLINN, GAMMA_NONE, MASK_AFFECT_DYNAMIC, LIGHTTYPE_DIRECTIONAL, LIGHTTYPE_OMNI, LIGHTTYPE_SPOT, SHADERDEF_NOSHADOW } from '../constants.js';

class LitMaterialOptionsBuilder {
  static update(litOptions, material, scene, objDefs, pass, sortedLights) {
    LitMaterialOptionsBuilder.updateSharedOptions(litOptions, material, scene, objDefs, pass);
    LitMaterialOptionsBuilder.updateMaterialOptions(litOptions, material);
    LitMaterialOptionsBuilder.updateEnvOptions(litOptions, material, scene);
    LitMaterialOptionsBuilder.updateLightingOptions(litOptions, material, objDefs, sortedLights);
    if (pass === SHADER_FORWARDHDR) {
      litOptions.gamma = GAMMA_SRGBHDR;
      litOptions.toneMap = TONEMAP_LINEAR;
    }
  }
  static updateSharedOptions(litOptions, material, scene, objDefs, pass) {
    litOptions.chunks = material.chunks;
    litOptions.pass = pass;
    litOptions.alphaTest = material.alphaTest > 0;
    litOptions.blendType = material.blendType;
    litOptions.screenSpace = objDefs && (objDefs & SHADERDEF_SCREENSPACE) !== 0;
    litOptions.skin = objDefs && (objDefs & SHADERDEF_SKIN) !== 0;
    litOptions.useInstancing = objDefs && (objDefs & SHADERDEF_INSTANCING) !== 0;
    litOptions.useMorphPosition = objDefs && (objDefs & SHADERDEF_MORPH_POSITION) !== 0;
    litOptions.useMorphNormal = objDefs && (objDefs & SHADERDEF_MORPH_NORMAL) !== 0;
    litOptions.useMorphTextureBased = objDefs && (objDefs & SHADERDEF_MORPH_TEXTURE_BASED) !== 0;
    litOptions.hasTangents = objDefs && (objDefs & SHADERDEF_TANGENTS) !== 0;
    litOptions.nineSlicedMode = material.nineSlicedMode || SPRITE_RENDERMODE_SIMPLE;

    // clustered lighting features (in shared options as shadow pass needs this too)
    if (material.useLighting && scene.clusteredLightingEnabled) {
      litOptions.clusteredLightingEnabled = true;
      litOptions.clusteredLightingCookiesEnabled = scene.lighting.cookiesEnabled;
      litOptions.clusteredLightingShadowsEnabled = scene.lighting.shadowsEnabled;
      litOptions.clusteredLightingShadowType = scene.lighting.shadowType;
      litOptions.clusteredLightingAreaLightsEnabled = scene.lighting.areaLightsEnabled;
    } else {
      litOptions.clusteredLightingEnabled = false;
      litOptions.clusteredLightingCookiesEnabled = false;
      litOptions.clusteredLightingShadowsEnabled = false;
      litOptions.clusteredLightingAreaLightsEnabled = false;
    }
  }
  static updateMaterialOptions(litOptions, material) {
    litOptions.useAmbientTint = false;
    litOptions.separateAmbient = false; // store ambient light color in separate variable, instead of adding it to diffuse directly
    litOptions.customFragmentShader = null;
    litOptions.pixelSnap = material.pixelSnap;
    litOptions.shadingModel = material.shadingModel;
    litOptions.ambientSH = material.ambientSH;
    litOptions.fastTbn = material.fastTbn;
    litOptions.twoSidedLighting = material.twoSidedLighting;
    litOptions.occludeDirect = material.occludeDirect;
    litOptions.occludeSpecular = material.occludeSpecular;
    litOptions.occludeSpecularFloat = material.occludeSpecularIntensity !== 1.0;
    litOptions.useMsdf = false;
    litOptions.msdfTextAttribute = false;
    litOptions.alphaToCoverage = material.alphaToCoverage;
    litOptions.opacityFadesSpecular = material.opacityFadesSpecular;
    litOptions.cubeMapProjection = CUBEPROJ_NONE;
    litOptions.conserveEnergy = material.conserveEnergy && material.shadingModel === SPECULAR_BLINN;
    litOptions.useSpecular = material.hasSpecular;
    litOptions.useSpecularityFactor = material.hasSpecularityFactor;
    litOptions.enableGGXSpecular = material.ggxSpecular;
    litOptions.fresnelModel = material.fresnelModel;
    litOptions.useRefraction = material.hasRefraction;
    litOptions.useClearCoat = material.hasClearCoat;
    litOptions.useSheen = material.hasSheen;
    litOptions.useIridescence = material.hasIrridescence;
    litOptions.useMetalness = material.hasMetalness;
    litOptions.useDynamicRefraction = material.dynamicRefraction;
    litOptions.vertexColors = false;
    litOptions.lightMapEnabled = material.hasLighting;
    litOptions.dirLightMapEnabled = material.dirLightMap;
    litOptions.useHeights = material.hasHeights;
    litOptions.useNormals = material.hasNormals;
    litOptions.useClearCoatNormals = material.hasClearCoatNormals;
    litOptions.useAo = material.hasAo;
    litOptions.diffuseMapEnabled = material.hasDiffuseMap;
  }
  static updateEnvOptions(litOptions, material, scene) {
    litOptions.fog = material.useFog ? scene.fog : 'none';
    litOptions.gamma = material.useGammaTonemap ? scene.gammaCorrection : GAMMA_NONE;
    litOptions.toneMap = material.useGammaTonemap ? scene.toneMapping : -1;
    litOptions.fixSeams = false;

    // source of reflections
    if (material.useSkybox && scene.envAtlas && scene.skybox) {
      litOptions.reflectionSource = 'envAtlasHQ';
      litOptions.reflectionEncoding = scene.envAtlas.encoding;
      litOptions.reflectionCubemapEncoding = scene.skybox.encoding;
    } else if (material.useSkybox && scene.envAtlas) {
      litOptions.reflectionSource = 'envAtlas';
      litOptions.reflectionEncoding = scene.envAtlas.encoding;
    } else if (material.useSkybox && scene.skybox) {
      litOptions.reflectionSource = 'cubeMap';
      litOptions.reflectionEncoding = scene.skybox.encoding;
    } else {
      litOptions.reflectionSource = null;
      litOptions.reflectionEncoding = null;
    }

    // source of environment ambient is as follows:
    if (material.ambientSH) {
      litOptions.ambientSource = 'ambientSH';
      litOptions.ambientEncoding = null;
    } else if (litOptions.reflectionSource && scene.envAtlas) {
      litOptions.ambientSource = 'envAtlas';
      litOptions.ambientEncoding = scene.envAtlas.encoding;
    } else {
      litOptions.ambientSource = 'constant';
      litOptions.ambientEncoding = null;
    }
    const hasSkybox = !!litOptions.reflectionSource;
    litOptions.skyboxIntensity = hasSkybox && (scene.skyboxIntensity !== 1 || scene.physicalUnits);
    litOptions.useCubeMapRotation = hasSkybox && scene._skyboxRotationShaderInclude;
  }
  static updateLightingOptions(litOptions, material, objDefs, sortedLights) {
    litOptions.lightMapWithoutAmbient = false;
    if (material.useLighting) {
      const lightsFiltered = [];
      const mask = objDefs ? objDefs >> 16 : MASK_AFFECT_DYNAMIC;

      // mask to select lights (dynamic vs lightmapped) when using clustered lighting
      litOptions.lightMaskDynamic = !!(mask & MASK_AFFECT_DYNAMIC);
      litOptions.lightMapWithoutAmbient = false;
      if (sortedLights) {
        LitMaterialOptionsBuilder.collectLights(LIGHTTYPE_DIRECTIONAL, sortedLights[LIGHTTYPE_DIRECTIONAL], lightsFiltered, mask);
        LitMaterialOptionsBuilder.collectLights(LIGHTTYPE_OMNI, sortedLights[LIGHTTYPE_OMNI], lightsFiltered, mask);
        LitMaterialOptionsBuilder.collectLights(LIGHTTYPE_SPOT, sortedLights[LIGHTTYPE_SPOT], lightsFiltered, mask);
      }
      litOptions.lights = lightsFiltered;
    } else {
      litOptions.lights = [];
    }
    if (litOptions.lights.length === 0 || (objDefs & SHADERDEF_NOSHADOW) !== 0) {
      litOptions.noShadow = true;
    }
  }
  static collectLights(lType, lights, lightsFiltered, mask) {
    for (let i = 0; i < lights.length; i++) {
      const light = lights[i];
      if (light.enabled) {
        if (light.mask & mask) {
          if (lType !== LIGHTTYPE_DIRECTIONAL) {
            if (light.isStatic) {
              continue;
            }
          }
          lightsFiltered.push(light);
        }
      }
    }
  }
}

export { LitMaterialOptionsBuilder };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl0LW1hdGVyaWFsLW9wdGlvbnMtYnVpbGRlci5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3NjZW5lL21hdGVyaWFscy9saXQtbWF0ZXJpYWwtb3B0aW9ucy1idWlsZGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENVQkVQUk9KX05PTkUsIEdBTU1BX1NSR0JIRFIsIEdBTU1BX05PTkUsIExJR0hUVFlQRV9ESVJFQ1RJT05BTCwgTElHSFRUWVBFX09NTkksIExJR0hUVFlQRV9TUE9ULCBNQVNLX0FGRkVDVF9EWU5BTUlDLCBTSEFERVJfRk9SV0FSREhEUiwgVE9ORU1BUF9MSU5FQVIsIFNIQURFUkRFRl9JTlNUQU5DSU5HLCBTSEFERVJERUZfTU9SUEhfTk9STUFMLCBTSEFERVJERUZfTU9SUEhfUE9TSVRJT04sIFNIQURFUkRFRl9NT1JQSF9URVhUVVJFX0JBU0VELCBTSEFERVJERUZfU0NSRUVOU1BBQ0UsIFNIQURFUkRFRl9TS0lOLCBTSEFERVJERUZfTk9TSEFET1csIFNIQURFUkRFRl9UQU5HRU5UUywgU1BFQ1VMQVJfQkxJTk4sIFNQUklURV9SRU5ERVJNT0RFX1NJTVBMRSB9IGZyb20gXCIuLi9jb25zdGFudHMuanNcIjtcblxuY2xhc3MgTGl0TWF0ZXJpYWxPcHRpb25zQnVpbGRlciB7XG4gICAgc3RhdGljIHVwZGF0ZShsaXRPcHRpb25zLCBtYXRlcmlhbCwgc2NlbmUsIG9iakRlZnMsIHBhc3MsIHNvcnRlZExpZ2h0cykge1xuICAgICAgICBMaXRNYXRlcmlhbE9wdGlvbnNCdWlsZGVyLnVwZGF0ZVNoYXJlZE9wdGlvbnMobGl0T3B0aW9ucywgbWF0ZXJpYWwsIHNjZW5lLCBvYmpEZWZzLCBwYXNzKTtcbiAgICAgICAgTGl0TWF0ZXJpYWxPcHRpb25zQnVpbGRlci51cGRhdGVNYXRlcmlhbE9wdGlvbnMobGl0T3B0aW9ucywgbWF0ZXJpYWwpO1xuICAgICAgICBMaXRNYXRlcmlhbE9wdGlvbnNCdWlsZGVyLnVwZGF0ZUVudk9wdGlvbnMobGl0T3B0aW9ucywgbWF0ZXJpYWwsIHNjZW5lKTtcbiAgICAgICAgTGl0TWF0ZXJpYWxPcHRpb25zQnVpbGRlci51cGRhdGVMaWdodGluZ09wdGlvbnMobGl0T3B0aW9ucywgbWF0ZXJpYWwsIG9iakRlZnMsIHNvcnRlZExpZ2h0cyk7XG5cbiAgICAgICAgaWYgKHBhc3MgPT09IFNIQURFUl9GT1JXQVJESERSKSB7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmdhbW1hID0gR0FNTUFfU1JHQkhEUjtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMudG9uZU1hcCA9IFRPTkVNQVBfTElORUFSO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc3RhdGljIHVwZGF0ZVNoYXJlZE9wdGlvbnMobGl0T3B0aW9ucywgbWF0ZXJpYWwsIHNjZW5lLCBvYmpEZWZzLCBwYXNzKSB7XG4gICAgICAgIGxpdE9wdGlvbnMuY2h1bmtzID0gbWF0ZXJpYWwuY2h1bmtzO1xuICAgICAgICBsaXRPcHRpb25zLnBhc3MgPSBwYXNzO1xuICAgICAgICBsaXRPcHRpb25zLmFscGhhVGVzdCA9IG1hdGVyaWFsLmFscGhhVGVzdCA+IDA7XG4gICAgICAgIGxpdE9wdGlvbnMuYmxlbmRUeXBlID0gbWF0ZXJpYWwuYmxlbmRUeXBlO1xuXG4gICAgICAgIGxpdE9wdGlvbnMuc2NyZWVuU3BhY2UgPSBvYmpEZWZzICYmIChvYmpEZWZzICYgU0hBREVSREVGX1NDUkVFTlNQQUNFKSAhPT0gMDtcbiAgICAgICAgbGl0T3B0aW9ucy5za2luID0gb2JqRGVmcyAmJiAob2JqRGVmcyAmIFNIQURFUkRFRl9TS0lOKSAhPT0gMDtcbiAgICAgICAgbGl0T3B0aW9ucy51c2VJbnN0YW5jaW5nID0gb2JqRGVmcyAmJiAob2JqRGVmcyAmIFNIQURFUkRFRl9JTlNUQU5DSU5HKSAhPT0gMDtcbiAgICAgICAgbGl0T3B0aW9ucy51c2VNb3JwaFBvc2l0aW9uID0gb2JqRGVmcyAmJiAob2JqRGVmcyAmIFNIQURFUkRFRl9NT1JQSF9QT1NJVElPTikgIT09IDA7XG4gICAgICAgIGxpdE9wdGlvbnMudXNlTW9ycGhOb3JtYWwgPSBvYmpEZWZzICYmIChvYmpEZWZzICYgU0hBREVSREVGX01PUlBIX05PUk1BTCkgIT09IDA7XG4gICAgICAgIGxpdE9wdGlvbnMudXNlTW9ycGhUZXh0dXJlQmFzZWQgPSBvYmpEZWZzICYmIChvYmpEZWZzICYgU0hBREVSREVGX01PUlBIX1RFWFRVUkVfQkFTRUQpICE9PSAwO1xuICAgICAgICBsaXRPcHRpb25zLmhhc1RhbmdlbnRzID0gb2JqRGVmcyAmJiAoKG9iakRlZnMgJiBTSEFERVJERUZfVEFOR0VOVFMpICE9PSAwKTtcblxuICAgICAgICBsaXRPcHRpb25zLm5pbmVTbGljZWRNb2RlID0gbWF0ZXJpYWwubmluZVNsaWNlZE1vZGUgfHwgU1BSSVRFX1JFTkRFUk1PREVfU0lNUExFO1xuXG4gICAgICAgIC8vIGNsdXN0ZXJlZCBsaWdodGluZyBmZWF0dXJlcyAoaW4gc2hhcmVkIG9wdGlvbnMgYXMgc2hhZG93IHBhc3MgbmVlZHMgdGhpcyB0b28pXG4gICAgICAgIGlmIChtYXRlcmlhbC51c2VMaWdodGluZyAmJiBzY2VuZS5jbHVzdGVyZWRMaWdodGluZ0VuYWJsZWQpIHtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuY2x1c3RlcmVkTGlnaHRpbmdFbmFibGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuY2x1c3RlcmVkTGlnaHRpbmdDb29raWVzRW5hYmxlZCA9IHNjZW5lLmxpZ2h0aW5nLmNvb2tpZXNFbmFibGVkO1xuICAgICAgICAgICAgbGl0T3B0aW9ucy5jbHVzdGVyZWRMaWdodGluZ1NoYWRvd3NFbmFibGVkID0gc2NlbmUubGlnaHRpbmcuc2hhZG93c0VuYWJsZWQ7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmNsdXN0ZXJlZExpZ2h0aW5nU2hhZG93VHlwZSA9IHNjZW5lLmxpZ2h0aW5nLnNoYWRvd1R5cGU7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmNsdXN0ZXJlZExpZ2h0aW5nQXJlYUxpZ2h0c0VuYWJsZWQgPSBzY2VuZS5saWdodGluZy5hcmVhTGlnaHRzRW5hYmxlZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuY2x1c3RlcmVkTGlnaHRpbmdFbmFibGVkID0gZmFsc2U7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmNsdXN0ZXJlZExpZ2h0aW5nQ29va2llc0VuYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuY2x1c3RlcmVkTGlnaHRpbmdTaGFkb3dzRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgICAgbGl0T3B0aW9ucy5jbHVzdGVyZWRMaWdodGluZ0FyZWFMaWdodHNFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgdXBkYXRlTWF0ZXJpYWxPcHRpb25zKGxpdE9wdGlvbnMsIG1hdGVyaWFsKSB7XG4gICAgICAgIGxpdE9wdGlvbnMudXNlQW1iaWVudFRpbnQgPSBmYWxzZTtcbiAgICAgICAgbGl0T3B0aW9ucy5zZXBhcmF0ZUFtYmllbnQgPSBmYWxzZTsgICAgLy8gc3RvcmUgYW1iaWVudCBsaWdodCBjb2xvciBpbiBzZXBhcmF0ZSB2YXJpYWJsZSwgaW5zdGVhZCBvZiBhZGRpbmcgaXQgdG8gZGlmZnVzZSBkaXJlY3RseVxuICAgICAgICBsaXRPcHRpb25zLmN1c3RvbUZyYWdtZW50U2hhZGVyID0gbnVsbDtcbiAgICAgICAgbGl0T3B0aW9ucy5waXhlbFNuYXAgPSBtYXRlcmlhbC5waXhlbFNuYXA7XG5cbiAgICAgICAgbGl0T3B0aW9ucy5zaGFkaW5nTW9kZWwgPSBtYXRlcmlhbC5zaGFkaW5nTW9kZWw7XG4gICAgICAgIGxpdE9wdGlvbnMuYW1iaWVudFNIID0gbWF0ZXJpYWwuYW1iaWVudFNIO1xuICAgICAgICBsaXRPcHRpb25zLmZhc3RUYm4gPSBtYXRlcmlhbC5mYXN0VGJuO1xuICAgICAgICBsaXRPcHRpb25zLnR3b1NpZGVkTGlnaHRpbmcgPSBtYXRlcmlhbC50d29TaWRlZExpZ2h0aW5nO1xuICAgICAgICBsaXRPcHRpb25zLm9jY2x1ZGVEaXJlY3QgPSBtYXRlcmlhbC5vY2NsdWRlRGlyZWN0O1xuICAgICAgICBsaXRPcHRpb25zLm9jY2x1ZGVTcGVjdWxhciA9IG1hdGVyaWFsLm9jY2x1ZGVTcGVjdWxhcjtcbiAgICAgICAgbGl0T3B0aW9ucy5vY2NsdWRlU3BlY3VsYXJGbG9hdCA9IChtYXRlcmlhbC5vY2NsdWRlU3BlY3VsYXJJbnRlbnNpdHkgIT09IDEuMCk7XG5cbiAgICAgICAgbGl0T3B0aW9ucy51c2VNc2RmID0gZmFsc2U7XG4gICAgICAgIGxpdE9wdGlvbnMubXNkZlRleHRBdHRyaWJ1dGUgPSBmYWxzZTtcblxuICAgICAgICBsaXRPcHRpb25zLmFscGhhVG9Db3ZlcmFnZSA9IG1hdGVyaWFsLmFscGhhVG9Db3ZlcmFnZTtcbiAgICAgICAgbGl0T3B0aW9ucy5vcGFjaXR5RmFkZXNTcGVjdWxhciA9IG1hdGVyaWFsLm9wYWNpdHlGYWRlc1NwZWN1bGFyO1xuXG4gICAgICAgIGxpdE9wdGlvbnMuY3ViZU1hcFByb2plY3Rpb24gPSBDVUJFUFJPSl9OT05FO1xuXG4gICAgICAgIGxpdE9wdGlvbnMuY29uc2VydmVFbmVyZ3kgPSBtYXRlcmlhbC5jb25zZXJ2ZUVuZXJneSAmJiBtYXRlcmlhbC5zaGFkaW5nTW9kZWwgPT09IFNQRUNVTEFSX0JMSU5OO1xuICAgICAgICBsaXRPcHRpb25zLnVzZVNwZWN1bGFyID0gbWF0ZXJpYWwuaGFzU3BlY3VsYXI7XG4gICAgICAgIGxpdE9wdGlvbnMudXNlU3BlY3VsYXJpdHlGYWN0b3IgPSBtYXRlcmlhbC5oYXNTcGVjdWxhcml0eUZhY3RvcjtcbiAgICAgICAgbGl0T3B0aW9ucy5lbmFibGVHR1hTcGVjdWxhciA9IG1hdGVyaWFsLmdneFNwZWN1bGFyO1xuICAgICAgICBsaXRPcHRpb25zLmZyZXNuZWxNb2RlbCA9IG1hdGVyaWFsLmZyZXNuZWxNb2RlbDtcbiAgICAgICAgbGl0T3B0aW9ucy51c2VSZWZyYWN0aW9uID0gbWF0ZXJpYWwuaGFzUmVmcmFjdGlvbjtcbiAgICAgICAgbGl0T3B0aW9ucy51c2VDbGVhckNvYXQgPSBtYXRlcmlhbC5oYXNDbGVhckNvYXQ7XG4gICAgICAgIGxpdE9wdGlvbnMudXNlU2hlZW4gPSBtYXRlcmlhbC5oYXNTaGVlbjtcbiAgICAgICAgbGl0T3B0aW9ucy51c2VJcmlkZXNjZW5jZSA9IG1hdGVyaWFsLmhhc0lycmlkZXNjZW5jZTtcbiAgICAgICAgbGl0T3B0aW9ucy51c2VNZXRhbG5lc3MgPSBtYXRlcmlhbC5oYXNNZXRhbG5lc3M7XG4gICAgICAgIGxpdE9wdGlvbnMudXNlRHluYW1pY1JlZnJhY3Rpb24gPSBtYXRlcmlhbC5keW5hbWljUmVmcmFjdGlvbjtcblxuICAgICAgICBsaXRPcHRpb25zLnZlcnRleENvbG9ycyA9IGZhbHNlO1xuICAgICAgICBsaXRPcHRpb25zLmxpZ2h0TWFwRW5hYmxlZCA9IG1hdGVyaWFsLmhhc0xpZ2h0aW5nO1xuICAgICAgICBsaXRPcHRpb25zLmRpckxpZ2h0TWFwRW5hYmxlZCA9IG1hdGVyaWFsLmRpckxpZ2h0TWFwO1xuICAgICAgICBsaXRPcHRpb25zLnVzZUhlaWdodHMgPSBtYXRlcmlhbC5oYXNIZWlnaHRzO1xuICAgICAgICBsaXRPcHRpb25zLnVzZU5vcm1hbHMgPSBtYXRlcmlhbC5oYXNOb3JtYWxzO1xuICAgICAgICBsaXRPcHRpb25zLnVzZUNsZWFyQ29hdE5vcm1hbHMgPSBtYXRlcmlhbC5oYXNDbGVhckNvYXROb3JtYWxzO1xuICAgICAgICBsaXRPcHRpb25zLnVzZUFvID0gbWF0ZXJpYWwuaGFzQW87XG4gICAgICAgIGxpdE9wdGlvbnMuZGlmZnVzZU1hcEVuYWJsZWQgPSBtYXRlcmlhbC5oYXNEaWZmdXNlTWFwO1xuICAgIH1cblxuICAgIHN0YXRpYyB1cGRhdGVFbnZPcHRpb25zKGxpdE9wdGlvbnMsIG1hdGVyaWFsLCBzY2VuZSkge1xuICAgICAgICBsaXRPcHRpb25zLmZvZyA9IG1hdGVyaWFsLnVzZUZvZyA/IHNjZW5lLmZvZyA6ICdub25lJztcbiAgICAgICAgbGl0T3B0aW9ucy5nYW1tYSA9IG1hdGVyaWFsLnVzZUdhbW1hVG9uZW1hcCA/IHNjZW5lLmdhbW1hQ29ycmVjdGlvbiA6IEdBTU1BX05PTkU7XG4gICAgICAgIGxpdE9wdGlvbnMudG9uZU1hcCA9IG1hdGVyaWFsLnVzZUdhbW1hVG9uZW1hcCA/IHNjZW5lLnRvbmVNYXBwaW5nIDogLTE7XG4gICAgICAgIGxpdE9wdGlvbnMuZml4U2VhbXMgPSBmYWxzZTtcblxuICAgICAgICAvLyBzb3VyY2Ugb2YgcmVmbGVjdGlvbnNcbiAgICAgICAgaWYgKG1hdGVyaWFsLnVzZVNreWJveCAmJiBzY2VuZS5lbnZBdGxhcyAmJiBzY2VuZS5za3lib3gpIHtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMucmVmbGVjdGlvblNvdXJjZSA9ICdlbnZBdGxhc0hRJztcbiAgICAgICAgICAgIGxpdE9wdGlvbnMucmVmbGVjdGlvbkVuY29kaW5nID0gc2NlbmUuZW52QXRsYXMuZW5jb2Rpbmc7XG4gICAgICAgICAgICBsaXRPcHRpb25zLnJlZmxlY3Rpb25DdWJlbWFwRW5jb2RpbmcgPSBzY2VuZS5za3lib3guZW5jb2Rpbmc7XG4gICAgICAgIH0gZWxzZSBpZiAobWF0ZXJpYWwudXNlU2t5Ym94ICYmIHNjZW5lLmVudkF0bGFzKSB7XG4gICAgICAgICAgICBsaXRPcHRpb25zLnJlZmxlY3Rpb25Tb3VyY2UgPSAnZW52QXRsYXMnO1xuICAgICAgICAgICAgbGl0T3B0aW9ucy5yZWZsZWN0aW9uRW5jb2RpbmcgPSBzY2VuZS5lbnZBdGxhcy5lbmNvZGluZztcbiAgICAgICAgfSBlbHNlIGlmIChtYXRlcmlhbC51c2VTa3lib3ggJiYgc2NlbmUuc2t5Ym94KSB7XG4gICAgICAgICAgICBsaXRPcHRpb25zLnJlZmxlY3Rpb25Tb3VyY2UgPSAnY3ViZU1hcCc7XG4gICAgICAgICAgICBsaXRPcHRpb25zLnJlZmxlY3Rpb25FbmNvZGluZyA9IHNjZW5lLnNreWJveC5lbmNvZGluZztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMucmVmbGVjdGlvblNvdXJjZSA9IG51bGw7XG4gICAgICAgICAgICBsaXRPcHRpb25zLnJlZmxlY3Rpb25FbmNvZGluZyA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBzb3VyY2Ugb2YgZW52aXJvbm1lbnQgYW1iaWVudCBpcyBhcyBmb2xsb3dzOlxuICAgICAgICBpZiAobWF0ZXJpYWwuYW1iaWVudFNIKSB7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmFtYmllbnRTb3VyY2UgPSAnYW1iaWVudFNIJztcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuYW1iaWVudEVuY29kaW5nID0gbnVsbDtcbiAgICAgICAgfSBlbHNlIGlmIChsaXRPcHRpb25zLnJlZmxlY3Rpb25Tb3VyY2UgJiYgc2NlbmUuZW52QXRsYXMpIHtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuYW1iaWVudFNvdXJjZSA9ICdlbnZBdGxhcyc7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmFtYmllbnRFbmNvZGluZyA9IHNjZW5lLmVudkF0bGFzLmVuY29kaW5nO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGl0T3B0aW9ucy5hbWJpZW50U291cmNlID0gJ2NvbnN0YW50JztcbiAgICAgICAgICAgIGxpdE9wdGlvbnMuYW1iaWVudEVuY29kaW5nID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGhhc1NreWJveCA9ICEhbGl0T3B0aW9ucy5yZWZsZWN0aW9uU291cmNlO1xuICAgICAgICBsaXRPcHRpb25zLnNreWJveEludGVuc2l0eSA9IGhhc1NreWJveCAmJiAoc2NlbmUuc2t5Ym94SW50ZW5zaXR5ICE9PSAxIHx8IHNjZW5lLnBoeXNpY2FsVW5pdHMpO1xuICAgICAgICBsaXRPcHRpb25zLnVzZUN1YmVNYXBSb3RhdGlvbiA9IGhhc1NreWJveCAmJiBzY2VuZS5fc2t5Ym94Um90YXRpb25TaGFkZXJJbmNsdWRlO1xuICAgIH1cblxuICAgIHN0YXRpYyB1cGRhdGVMaWdodGluZ09wdGlvbnMobGl0T3B0aW9ucywgbWF0ZXJpYWwsIG9iakRlZnMsIHNvcnRlZExpZ2h0cykge1xuICAgICAgICBsaXRPcHRpb25zLmxpZ2h0TWFwV2l0aG91dEFtYmllbnQgPSBmYWxzZTtcblxuICAgICAgICBpZiAobWF0ZXJpYWwudXNlTGlnaHRpbmcpIHtcbiAgICAgICAgICAgIGNvbnN0IGxpZ2h0c0ZpbHRlcmVkID0gW107XG4gICAgICAgICAgICBjb25zdCBtYXNrID0gb2JqRGVmcyA/IChvYmpEZWZzID4+IDE2KSA6IE1BU0tfQUZGRUNUX0RZTkFNSUM7XG5cbiAgICAgICAgICAgIC8vIG1hc2sgdG8gc2VsZWN0IGxpZ2h0cyAoZHluYW1pYyB2cyBsaWdodG1hcHBlZCkgd2hlbiB1c2luZyBjbHVzdGVyZWQgbGlnaHRpbmdcbiAgICAgICAgICAgIGxpdE9wdGlvbnMubGlnaHRNYXNrRHluYW1pYyA9ICEhKG1hc2sgJiBNQVNLX0FGRkVDVF9EWU5BTUlDKTtcbiAgICAgICAgICAgIGxpdE9wdGlvbnMubGlnaHRNYXBXaXRob3V0QW1iaWVudCA9IGZhbHNlO1xuXG4gICAgICAgICAgICBpZiAoc29ydGVkTGlnaHRzKSB7XG4gICAgICAgICAgICAgICAgTGl0TWF0ZXJpYWxPcHRpb25zQnVpbGRlci5jb2xsZWN0TGlnaHRzKExJR0hUVFlQRV9ESVJFQ1RJT05BTCwgc29ydGVkTGlnaHRzW0xJR0hUVFlQRV9ESVJFQ1RJT05BTF0sIGxpZ2h0c0ZpbHRlcmVkLCBtYXNrKTtcbiAgICAgICAgICAgICAgICBMaXRNYXRlcmlhbE9wdGlvbnNCdWlsZGVyLmNvbGxlY3RMaWdodHMoTElHSFRUWVBFX09NTkksIHNvcnRlZExpZ2h0c1tMSUdIVFRZUEVfT01OSV0sIGxpZ2h0c0ZpbHRlcmVkLCBtYXNrKTtcbiAgICAgICAgICAgICAgICBMaXRNYXRlcmlhbE9wdGlvbnNCdWlsZGVyLmNvbGxlY3RMaWdodHMoTElHSFRUWVBFX1NQT1QsIHNvcnRlZExpZ2h0c1tMSUdIVFRZUEVfU1BPVF0sIGxpZ2h0c0ZpbHRlcmVkLCBtYXNrKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpdE9wdGlvbnMubGlnaHRzID0gbGlnaHRzRmlsdGVyZWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsaXRPcHRpb25zLmxpZ2h0cyA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxpdE9wdGlvbnMubGlnaHRzLmxlbmd0aCA9PT0gMCB8fCAoKG9iakRlZnMgJiBTSEFERVJERUZfTk9TSEFET1cpICE9PSAwKSkge1xuICAgICAgICAgICAgbGl0T3B0aW9ucy5ub1NoYWRvdyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0aWMgY29sbGVjdExpZ2h0cyhsVHlwZSwgbGlnaHRzLCBsaWdodHNGaWx0ZXJlZCwgbWFzaykge1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpZ2h0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbGlnaHQgPSBsaWdodHNbaV07XG4gICAgICAgICAgICBpZiAobGlnaHQuZW5hYmxlZCkge1xuICAgICAgICAgICAgICAgIGlmIChsaWdodC5tYXNrICYgbWFzaykge1xuICAgICAgICAgICAgICAgICAgICBpZiAobFR5cGUgIT09IExJR0hUVFlQRV9ESVJFQ1RJT05BTCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxpZ2h0LmlzU3RhdGljKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGlnaHRzRmlsdGVyZWQucHVzaChsaWdodCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBMaXRNYXRlcmlhbE9wdGlvbnNCdWlsZGVyIH07XG4iXSwibmFtZXMiOlsiTGl0TWF0ZXJpYWxPcHRpb25zQnVpbGRlciIsInVwZGF0ZSIsImxpdE9wdGlvbnMiLCJtYXRlcmlhbCIsInNjZW5lIiwib2JqRGVmcyIsInBhc3MiLCJzb3J0ZWRMaWdodHMiLCJ1cGRhdGVTaGFyZWRPcHRpb25zIiwidXBkYXRlTWF0ZXJpYWxPcHRpb25zIiwidXBkYXRlRW52T3B0aW9ucyIsInVwZGF0ZUxpZ2h0aW5nT3B0aW9ucyIsIlNIQURFUl9GT1JXQVJESERSIiwiZ2FtbWEiLCJHQU1NQV9TUkdCSERSIiwidG9uZU1hcCIsIlRPTkVNQVBfTElORUFSIiwiY2h1bmtzIiwiYWxwaGFUZXN0IiwiYmxlbmRUeXBlIiwic2NyZWVuU3BhY2UiLCJTSEFERVJERUZfU0NSRUVOU1BBQ0UiLCJza2luIiwiU0hBREVSREVGX1NLSU4iLCJ1c2VJbnN0YW5jaW5nIiwiU0hBREVSREVGX0lOU1RBTkNJTkciLCJ1c2VNb3JwaFBvc2l0aW9uIiwiU0hBREVSREVGX01PUlBIX1BPU0lUSU9OIiwidXNlTW9ycGhOb3JtYWwiLCJTSEFERVJERUZfTU9SUEhfTk9STUFMIiwidXNlTW9ycGhUZXh0dXJlQmFzZWQiLCJTSEFERVJERUZfTU9SUEhfVEVYVFVSRV9CQVNFRCIsImhhc1RhbmdlbnRzIiwiU0hBREVSREVGX1RBTkdFTlRTIiwibmluZVNsaWNlZE1vZGUiLCJTUFJJVEVfUkVOREVSTU9ERV9TSU1QTEUiLCJ1c2VMaWdodGluZyIsImNsdXN0ZXJlZExpZ2h0aW5nRW5hYmxlZCIsImNsdXN0ZXJlZExpZ2h0aW5nQ29va2llc0VuYWJsZWQiLCJsaWdodGluZyIsImNvb2tpZXNFbmFibGVkIiwiY2x1c3RlcmVkTGlnaHRpbmdTaGFkb3dzRW5hYmxlZCIsInNoYWRvd3NFbmFibGVkIiwiY2x1c3RlcmVkTGlnaHRpbmdTaGFkb3dUeXBlIiwic2hhZG93VHlwZSIsImNsdXN0ZXJlZExpZ2h0aW5nQXJlYUxpZ2h0c0VuYWJsZWQiLCJhcmVhTGlnaHRzRW5hYmxlZCIsInVzZUFtYmllbnRUaW50Iiwic2VwYXJhdGVBbWJpZW50IiwiY3VzdG9tRnJhZ21lbnRTaGFkZXIiLCJwaXhlbFNuYXAiLCJzaGFkaW5nTW9kZWwiLCJhbWJpZW50U0giLCJmYXN0VGJuIiwidHdvU2lkZWRMaWdodGluZyIsIm9jY2x1ZGVEaXJlY3QiLCJvY2NsdWRlU3BlY3VsYXIiLCJvY2NsdWRlU3BlY3VsYXJGbG9hdCIsIm9jY2x1ZGVTcGVjdWxhckludGVuc2l0eSIsInVzZU1zZGYiLCJtc2RmVGV4dEF0dHJpYnV0ZSIsImFscGhhVG9Db3ZlcmFnZSIsIm9wYWNpdHlGYWRlc1NwZWN1bGFyIiwiY3ViZU1hcFByb2plY3Rpb24iLCJDVUJFUFJPSl9OT05FIiwiY29uc2VydmVFbmVyZ3kiLCJTUEVDVUxBUl9CTElOTiIsInVzZVNwZWN1bGFyIiwiaGFzU3BlY3VsYXIiLCJ1c2VTcGVjdWxhcml0eUZhY3RvciIsImhhc1NwZWN1bGFyaXR5RmFjdG9yIiwiZW5hYmxlR0dYU3BlY3VsYXIiLCJnZ3hTcGVjdWxhciIsImZyZXNuZWxNb2RlbCIsInVzZVJlZnJhY3Rpb24iLCJoYXNSZWZyYWN0aW9uIiwidXNlQ2xlYXJDb2F0IiwiaGFzQ2xlYXJDb2F0IiwidXNlU2hlZW4iLCJoYXNTaGVlbiIsInVzZUlyaWRlc2NlbmNlIiwiaGFzSXJyaWRlc2NlbmNlIiwidXNlTWV0YWxuZXNzIiwiaGFzTWV0YWxuZXNzIiwidXNlRHluYW1pY1JlZnJhY3Rpb24iLCJkeW5hbWljUmVmcmFjdGlvbiIsInZlcnRleENvbG9ycyIsImxpZ2h0TWFwRW5hYmxlZCIsImhhc0xpZ2h0aW5nIiwiZGlyTGlnaHRNYXBFbmFibGVkIiwiZGlyTGlnaHRNYXAiLCJ1c2VIZWlnaHRzIiwiaGFzSGVpZ2h0cyIsInVzZU5vcm1hbHMiLCJoYXNOb3JtYWxzIiwidXNlQ2xlYXJDb2F0Tm9ybWFscyIsImhhc0NsZWFyQ29hdE5vcm1hbHMiLCJ1c2VBbyIsImhhc0FvIiwiZGlmZnVzZU1hcEVuYWJsZWQiLCJoYXNEaWZmdXNlTWFwIiwiZm9nIiwidXNlRm9nIiwidXNlR2FtbWFUb25lbWFwIiwiZ2FtbWFDb3JyZWN0aW9uIiwiR0FNTUFfTk9ORSIsInRvbmVNYXBwaW5nIiwiZml4U2VhbXMiLCJ1c2VTa3lib3giLCJlbnZBdGxhcyIsInNreWJveCIsInJlZmxlY3Rpb25Tb3VyY2UiLCJyZWZsZWN0aW9uRW5jb2RpbmciLCJlbmNvZGluZyIsInJlZmxlY3Rpb25DdWJlbWFwRW5jb2RpbmciLCJhbWJpZW50U291cmNlIiwiYW1iaWVudEVuY29kaW5nIiwiaGFzU2t5Ym94Iiwic2t5Ym94SW50ZW5zaXR5IiwicGh5c2ljYWxVbml0cyIsInVzZUN1YmVNYXBSb3RhdGlvbiIsIl9za3lib3hSb3RhdGlvblNoYWRlckluY2x1ZGUiLCJsaWdodE1hcFdpdGhvdXRBbWJpZW50IiwibGlnaHRzRmlsdGVyZWQiLCJtYXNrIiwiTUFTS19BRkZFQ1RfRFlOQU1JQyIsImxpZ2h0TWFza0R5bmFtaWMiLCJjb2xsZWN0TGlnaHRzIiwiTElHSFRUWVBFX0RJUkVDVElPTkFMIiwiTElHSFRUWVBFX09NTkkiLCJMSUdIVFRZUEVfU1BPVCIsImxpZ2h0cyIsImxlbmd0aCIsIlNIQURFUkRFRl9OT1NIQURPVyIsIm5vU2hhZG93IiwibFR5cGUiLCJpIiwibGlnaHQiLCJlbmFibGVkIiwiaXNTdGF0aWMiLCJwdXNoIl0sIm1hcHBpbmdzIjoiOztBQUVBLE1BQU1BLHlCQUF5QixDQUFDO0FBQzVCLEVBQUEsT0FBT0MsTUFBTUEsQ0FBQ0MsVUFBVSxFQUFFQyxRQUFRLEVBQUVDLEtBQUssRUFBRUMsT0FBTyxFQUFFQyxJQUFJLEVBQUVDLFlBQVksRUFBRTtBQUNwRVAsSUFBQUEseUJBQXlCLENBQUNRLG1CQUFtQixDQUFDTixVQUFVLEVBQUVDLFFBQVEsRUFBRUMsS0FBSyxFQUFFQyxPQUFPLEVBQUVDLElBQUksQ0FBQyxDQUFBO0FBQ3pGTixJQUFBQSx5QkFBeUIsQ0FBQ1MscUJBQXFCLENBQUNQLFVBQVUsRUFBRUMsUUFBUSxDQUFDLENBQUE7SUFDckVILHlCQUF5QixDQUFDVSxnQkFBZ0IsQ0FB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
