import { platform } from '../../core/platform.js';
import { EventHandler } from '../../core/event-handler.js';
import { EVENT_MOUSEUP, EVENT_MOUSEDOWN, EVENT_MOUSEMOVE, EVENT_MOUSEWHEEL } from './constants.js';
import { isMousePointerLocked, MouseEvent } from './mouse-event.js';

/**
 * Callback used by {@link Mouse#enablePointerLock} and {@link Application#disablePointerLock}.
 *
 * @callback LockMouseCallback
 */

/**
 * A Mouse Device, bound to a DOM Element.
 *
 * @augments EventHandler
 * @category Input
 */
class Mouse extends EventHandler {
  /**
   * Create a new Mouse instance.
   *
   * @param {Element} [element] - The Element that the mouse events are attached to.
   */
  constructor(element) {
    super();

    // Clear the mouse state
    this._lastX = 0;
    this._lastY = 0;
    this._buttons = [false, false, false];
    this._lastbuttons = [false, false, false];

    // Setup event handlers so they are bound to the correct 'this'
    this._upHandler = this._handleUp.bind(this);
    this._downHandler = this._handleDown.bind(this);
    this._moveHandler = this._handleMove.bind(this);
    this._wheelHandler = this._handleWheel.bind(this);
    this._contextMenuHandler = event => {
      event.preventDefault();
    };
    this._target = null;
    this._attached = false;
    this.attach(element);
  }

  /**
   * Fired when the mouse is moved.
   *
   * @event Mouse#mousemove
   * @param {MouseEvent} event - The MouseEvent object.
   */

  /**
   * Fired when a mouse button is pressed.
   *
   * @event Mouse#mousedown
   * @param {MouseEvent} event - The MouseEvent object.
   */

  /**
   * Fired when a mouse button is released.
   *
   * @event Mouse#mouseup
   * @param {MouseEvent} event - The MouseEvent object.
   */

  /**
   * Fired when a mouse wheel is moved.
   *
   * @event Mouse#mousewheel
   * @param {MouseEvent} event - The MouseEvent object.
   */

  /**
   * Check if the mouse pointer has been locked, using {@link Mouse#enablePointerLock}.
   *
   * @returns {boolean} True if locked.
   */
  static isPointerLocked() {
    return isMousePointerLocked();
  }

  /**
   * Attach mouse events to an Element.
   *
   * @param {Element} element - The DOM element to attach the mouse to.
   */
  attach(element) {
    this._target = element;
    if (this._attached) return;
    this._attached = true;
    const opts = platform.passiveEvents ? {
      passive: false
    } : false;
    window.addEventListener('mouseup', this._upHandler, opts);
    window.addEventListener('mousedown', this._downHandler, opts);
    window.addEventListener('mousemove', this._moveHandler, opts);
    window.addEventListener('wheel', this._wheelHandler, opts);
  }

  /**
   * Remove mouse events from the element that it is attached to.
   */
  detach() {
    if (!this._attached) return;
    this._attached = false;
    this._target = null;
    const opts = platform.passiveEvents ? {
      passive: false
    } : false;
    window.removeEventListener('mouseup', this._upHandler, opts);
    window.removeEventListener('mousedown', this._downHandler, opts);
    window.removeEventListener('mousemove', this._moveHandler, opts);
    window.removeEventListener('wheel', this._wheelHandler, opts);
  }

  /**
   * Disable the context menu usually activated with right-click.
   */
  disableContextMenu() {
    if (!this._target) return;
    this._target.addEventListener('contextmenu', this._contextMenuHandler);
  }

  /**
   * Enable the context menu usually activated with right-click. This option is active by
   * default.
   */
  enableContextMenu() {
    if (!this._target) return;
    this._target.removeEventListener('contextmenu', this._contextMenuHandler);
  }

  /**
   * Request that the browser hides the mouse cursor and locks the mouse to the element. Allowing
   * raw access to mouse movement input without risking the mouse exiting the element. Notes:
   *
   * - In some browsers this will only work when the browser is running in fullscreen mode. See
   * {@link https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API Fullscreen API} for
   * more details.
   * - Enabling pointer lock can only be initiated by a user action e.g. in the event handler for
   * a mouse or keyboard input.
   *
   * @param {LockMouseCallback} [success] - Function called if the request for mouse lock is
   * successful.
   * @param {LockMouseCallback} [error] - Function called if the request for mouse lock is
   * unsuccessful.
   */
  enablePointerLock(success, error) {
    if (!document.body.requestPointerLock) {
      if (error) error();
      return;
    }
    const s = () => {
      success();
      document.removeEventListener('pointerlockchange', s);
    };
    const e = () => {
      error();
      document.removeEventListener('pointerlockerror', e);
    };
    if (success) {
      document.addEventListener('pointerlockchange', s, false);
    }
    if (error) {
      document.addEventListener('pointerlockerror', e, false);
    }
    document.body.requestPointerLock();
  }

  /**
   * Return control of the mouse cursor to the user.
   *
   * @param {LockMouseCallback} [success] - Function called when the mouse lock is disabled.
   */
  disablePointerLock(success) {
    if (!document.exitPointerLock) {
      return;
    }
    const s = () => {
      success();
      document.removeEventListener('pointerlockchange', s);
    };
    if (success) {
      document.addEventListener('pointerlockchange', s, false);
    }
    document.exitPointerLock();
  }

  /**
   * Update method, should be called once per frame.
   */
  update() {
    // Copy current button state
    this._lastbuttons[0] = this._buttons[0];
    this._lastbuttons[1] = this._buttons[1];
    this._lastbuttons[2] = this._buttons[2];
  }

  /**
   * Returns true if the mouse button is currently pressed.
   *
   * @param {number} button - The mouse button to test. Can be:
   *
   * - {@link MOUSEBUTTON_LEFT}
   * - {@link MOUSEBUTTON_MIDDLE}
   * - {@link MOUSEBUTTON_RIGHT}
   *
   * @returns {boolean} True if the mouse button is current pressed.
   */
  isPressed(button) {
    return this._buttons[button];
  }

  /**
   * Returns true if the mouse button was pressed this frame (since the last call to update).
   *
   * @param {number} button - The mouse button to test. Can be:
   *
   * - {@link MOUSEBUTTON_LEFT}
   * - {@link MOUSEBUTTON_MIDDLE}
   * - {@link MOUSEBUTTON_RIGHT}
   *
   * @returns {boolean} True if the mouse button was pressed since the last update.
   */
  wasPressed(button) {
    return this._buttons[button] && !this._lastbuttons[button];
  }

  /**
   * Returns true if the mouse button was released this frame (since the last call to update).
   *
   * @param {number} button - The mouse button to test. Can be:
   *
   * - {@link MOUSEBUTTON_LEFT}
   * - {@link MOUSEBUTTON_MIDDLE}
   * - {@link MOUSEBUTTON_RIGHT}
   *
   * @returns {boolean} True if the mouse button was released since the last update.
   */
  wasReleased(button) {
    return !this._buttons[button] && this._lastbuttons[button];
  }
  _handleUp(event) {
    // disable released button
    this._buttons[event.button] = false;
    const e = new MouseEvent(this, event);
    if (!e.event) return;

    // send 'mouseup' event
    this.fire(EVENT_MOUSEUP, e);
  }
  _handleDown(event) {
    // Store which button has affected
    this._buttons[event.button] = true;
    const e = new MouseEvent(this, event);
    if (!e.event) return;
    this.fire(EVENT_MOUSEDOWN, e);
  }
  _handleMove(event) {
    const e = new MouseEvent(this, event);
    if (!e.event) return;
    this.fire(EVENT_MOUSEMOVE, e);

    // Store the last offset position to calculate deltas
    this._lastX = e.x;
    this._lastY = e.y;
  }
  _handleWheel(event) {
    const e = new MouseEvent(this, event);
    if (!e.event) return;
    this.fire(EVENT_MOUSEWHEEL, e);
  }
  _getTargetCoords(event) {
    const rect = this._target.getBoundingClientRect();
    const left = Math.floor(rect.left);
    const top = Math.floor(rect.top);

    // mouse is outside of canvas
    if (event.clientX < left || event.clientX >= left + this._target.clientWidth || event.clientY < top || event.clientY >= top + this._target.clientHeight) {
      return null;
    }
    return {
      x: event.clientX - left,
      y: event.clientY - top
    };
  }
}

export { Mouse };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW91c2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9wbGF0Zm9ybS9pbnB1dC9tb3VzZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgRXZlbnRIYW5kbGVyIH0gZnJvbSAnLi4vLi4vY29yZS9ldmVudC1oYW5kbGVyLmpzJztcblxuaW1wb3J0IHsgRVZFTlRfTU9VU0VET1dOLCBFVkVOVF9NT1VTRU1PVkUsIEVWRU5UX01PVVNFVVAsIEVWRU5UX01PVVNFV0hFRUwgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBpc01vdXNlUG9pbnRlckxvY2tlZCwgTW91c2VFdmVudCB9IGZyb20gJy4vbW91c2UtZXZlbnQuanMnO1xuXG4vKipcbiAqIENhbGxiYWNrIHVzZWQgYnkge0BsaW5rIE1vdXNlI2VuYWJsZVBvaW50ZXJMb2NrfSBhbmQge0BsaW5rIEFwcGxpY2F0aW9uI2Rpc2FibGVQb2ludGVyTG9ja30uXG4gKlxuICogQGNhbGxiYWNrIExvY2tNb3VzZUNhbGxiYWNrXG4gKi9cblxuLyoqXG4gKiBBIE1vdXNlIERldmljZSwgYm91bmQgdG8gYSBET00gRWxlbWVudC5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKiBAY2F0ZWdvcnkgSW5wdXRcbiAqL1xuY2xhc3MgTW91c2UgZXh0ZW5kcyBFdmVudEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBNb3VzZSBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7RWxlbWVudH0gW2VsZW1lbnRdIC0gVGhlIEVsZW1lbnQgdGhhdCB0aGUgbW91c2UgZXZlbnRzIGFyZSBhdHRhY2hlZCB0by5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50KSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgLy8gQ2xlYXIgdGhlIG1vdXNlIHN0YXRlXG4gICAgICAgIHRoaXMuX2xhc3RYID0gMDtcbiAgICAgICAgdGhpcy5fbGFzdFkgPSAwO1xuICAgICAgICB0aGlzLl9idXR0b25zID0gW2ZhbHNlLCBmYWxzZSwgZmFsc2VdO1xuICAgICAgICB0aGlzLl9sYXN0YnV0dG9ucyA9IFtmYWxzZSwgZmFsc2UsIGZhbHNlXTtcblxuXG4gICAgICAgIC8vIFNldHVwIGV2ZW50IGhhbmRsZXJzIHNvIHRoZXkgYXJlIGJvdW5kIHRvIHRoZSBjb3JyZWN0ICd0aGlzJ1xuICAgICAgICB0aGlzLl91cEhhbmRsZXIgPSB0aGlzLl9oYW5kbGVVcC5iaW5kKHRoaXMpO1xuICAgICAgICB0aGlzLl9kb3duSGFuZGxlciA9IHRoaXMuX2hhbmRsZURvd24uYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy5fbW92ZUhhbmRsZXIgPSB0aGlzLl9oYW5kbGVNb3ZlLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX3doZWVsSGFuZGxlciA9IHRoaXMuX2hhbmRsZVdoZWVsLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuX2NvbnRleHRNZW51SGFuZGxlciA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl90YXJnZXQgPSBudWxsO1xuICAgICAgICB0aGlzLl9hdHRhY2hlZCA9IGZhbHNlO1xuXG4gICAgICAgIHRoaXMuYXR0YWNoKGVsZW1lbnQpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gdGhlIG1vdXNlIGlzIG1vdmVkLlxuICAgICAqXG4gICAgICogQGV2ZW50IE1vdXNlI21vdXNlbW92ZVxuICAgICAqIEBwYXJhbSB7TW91c2VFdmVudH0gZXZlbnQgLSBUaGUgTW91c2VFdmVudCBvYmplY3QuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGEgbW91c2UgYnV0dG9uIGlzIHByZXNzZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgTW91c2UjbW91c2Vkb3duXG4gICAgICogQHBhcmFtIHtNb3VzZUV2ZW50fSBldmVudCAtIFRoZSBNb3VzZUV2ZW50IG9iamVjdC5cbiAgICAgKi9cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gYSBtb3VzZSBidXR0b24gaXMgcmVsZWFzZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgTW91c2UjbW91c2V1cFxuICAgICAqIEBwYXJhbSB7TW91c2VFdmVudH0gZXZlbnQgLSBUaGUgTW91c2VFdmVudCBvYmplY3QuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIGEgbW91c2Ugd2hlZWwgaXMgbW92ZWQuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgTW91c2UjbW91c2V3aGVlbFxuICAgICAqIEBwYXJhbSB7TW91c2VFdmVudH0gZXZlbnQgLSBUaGUgTW91c2VFdmVudCBvYmplY3QuXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBDaGVjayBpZiB0aGUgbW91c2UgcG9pbnRlciBoYXMgYmVlbiBsb2NrZWQsIHVzaW5nIHtAbGluayBNb3VzZSNlbmFibGVQb2ludGVyTG9ja30uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gVHJ1ZSBpZiBsb2NrZWQuXG4gICAgICovXG4gICAgc3RhdGljIGlzUG9pbnRlckxvY2tlZCgpIHtcbiAgICAgICAgcmV0dXJuIGlzTW91c2VQb2ludGVyTG9ja2VkKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQXR0YWNoIG1vdXNlIGV2ZW50cyB0byBhbiBFbGVtZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IC0gVGhlIERPTSBlbGVtZW50IHRvIGF0dGFjaCB0aGUgbW91c2UgdG8uXG4gICAgICovXG4gICAgYXR0YWNoKGVsZW1lbnQpIHtcbiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gZWxlbWVudDtcblxuICAgICAgICBpZiAodGhpcy5fYXR0YWNoZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy5fYXR0YWNoZWQgPSB0cnVlO1xuXG4gICAgICAgIGNvbnN0IG9wdHMgPSBwbGF0Zm9ybS5wYXNzaXZlRXZlbnRzID8geyBwYXNzaXZlOiBmYWxzZSB9IDogZmFsc2U7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fdXBIYW5kbGVyLCBvcHRzKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIHRoaXMuX2Rvd25IYW5kbGVyLCBvcHRzKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX21vdmVIYW5kbGVyLCBvcHRzKTtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgdGhpcy5fd2hlZWxIYW5kbGVyLCBvcHRzKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgbW91c2UgZXZlbnRzIGZyb20gdGhlIGVsZW1lbnQgdGhhdCBpdCBpcyBhdHRhY2hlZCB0by5cbiAgICAgKi9cbiAgICBkZXRhY2goKSB7XG4gICAgICAgIGlmICghdGhpcy5fYXR0YWNoZWQpIHJldHVybjtcbiAgICAgICAgdGhpcy5fYXR0YWNoZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdGFyZ2V0ID0gbnVsbDtcblxuICAgICAgICBjb25zdCBvcHRzID0gcGxhdGZvcm0ucGFzc2l2ZUV2ZW50cyA/IHsgcGFzc2l2ZTogZmFsc2UgfSA6IGZhbHNlO1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIHRoaXMuX3VwSGFuZGxlciwgb3B0cyk7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCB0aGlzLl9kb3duSGFuZGxlciwgb3B0cyk7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9tb3ZlSGFuZGxlciwgb3B0cyk7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIHRoaXMuX3doZWVsSGFuZGxlciwgb3B0cyk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGlzYWJsZSB0aGUgY29udGV4dCBtZW51IHVzdWFsbHkgYWN0aXZhdGVkIHdpdGggcmlnaHQtY2xpY2suXG4gICAgICovXG4gICAgZGlzYWJsZUNvbnRleHRNZW51KCkge1xuICAgICAgICBpZiAoIXRoaXMuX3RhcmdldCkgcmV0dXJuO1xuICAgICAgICB0aGlzLl90YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCB0aGlzLl9jb250ZXh0TWVudUhhbmRsZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuYWJsZSB0aGUgY29udGV4dCBtZW51IHVzdWFsbHkgYWN0aXZhdGVkIHdpdGggcmlnaHQtY2xpY2suIFRoaXMgb3B0aW9uIGlzIGFjdGl2ZSBieVxuICAgICAqIGRlZmF1bHQuXG4gICAgICovXG4gICAgZW5hYmxlQ29udGV4dE1lbnUoKSB7XG4gICAgICAgIGlmICghdGhpcy5fdGFyZ2V0KSByZXR1cm47XG4gICAgICAgIHRoaXMuX3RhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIHRoaXMuX2NvbnRleHRNZW51SGFuZGxlcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmVxdWVzdCB0aGF0IHRoZSBicm93c2VyIGhpZGVzIHRoZSBtb3VzZSBjdXJzb3IgYW5kIGxvY2tzIHRoZSBtb3VzZSB0byB0aGUgZWxlbWVudC4gQWxsb3dpbmdcbiAgICAgKiByYXcgYWNjZXNzIHRvIG1vdXNlIG1vdmVtZW50IGlucHV0IHdpdGhvdXQgcmlza2luZyB0aGUgbW91c2UgZXhpdGluZyB0aGUgZWxlbWVudC4gTm90ZXM6XG4gICAgICpcbiAgICAgKiAtIEluIHNvbWUgYnJvd3NlcnMgdGhpcyB3aWxsIG9ubHkgd29yayB3aGVuIHRoZSBicm93c2VyIGlzIHJ1bm5pbmcgaW4gZnVsbHNjcmVlbiBtb2RlLiBTZWVcbiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0Z1bGxzY3JlZW5fQVBJIEZ1bGxzY3JlZW4gQVBJfSBmb3JcbiAgICAgKiBtb3JlIGRldGFpbHMuXG4gICAgICogLSBFbmFibGluZyBwb2ludGVyIGxvY2sgY2FuIG9ubHkgYmUgaW5pdGlhdGVkIGJ5IGEgdXNlciBhY3Rpb24gZS5nLiBpbiB0aGUgZXZlbnQgaGFuZGxlciBmb3JcbiAgICAgKiBhIG1vdXNlIG9yIGtleWJvYXJkIGlucHV0LlxuICAgICAqXG4gICAgICogQHBhcmFtIHtMb2NrTW91c2VDYWxsYmFja30gW3N1Y2Nlc3NdIC0gRnVuY3Rpb24gY2FsbGVkIGlmIHRoZSByZXF1ZXN0IGZvciBtb3VzZSBsb2NrIGlzXG4gICAgICogc3VjY2Vzc2Z1bC5cbiAgICAgKiBAcGFyYW0ge0xvY2tNb3VzZUNhbGxiYWNrfSBbZXJyb3JdIC0gRnVuY3Rpb24gY2FsbGVkIGlmIHRoZSByZXF1ZXN0IGZvciBtb3VzZSBsb2NrIGlzXG4gICAgICogdW5zdWNjZXNzZnVsLlxuICAgICAqL1xuICAgIGVuYWJsZVBvaW50ZXJMb2NrKHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgIGlmICghZG9jdW1lbnQuYm9keS5yZXF1ZXN0UG9pbnRlckxvY2spIHtcbiAgICAgICAgICAgIGlmIChlcnJvcilcbiAgICAgICAgICAgICAgICBlcnJvcigpO1xuXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzID0gKCkgPT4ge1xuICAgICAgICAgICAgc3VjY2VzcygpO1xuICAgICAgICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxvY2tjaGFuZ2UnLCBzKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGVycm9yKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb2ludGVybG9ja2Vycm9yJywgZSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3BvaW50ZXJsb2NrY2hhbmdlJywgcywgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVybG9ja2Vycm9yJywgZSwgZmFsc2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgZG9jdW1lbnQuYm9keS5yZXF1ZXN0UG9pbnRlckxvY2soKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm4gY29udHJvbCBvZiB0aGUgbW91c2UgY3Vyc29yIHRvIHRoZSB1c2VyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtMb2NrTW91c2VDYWxsYmFja30gW3N1Y2Nlc3NdIC0gRnVuY3Rpb24gY2FsbGVkIHdoZW4gdGhlIG1vdXNlIGxvY2sgaXMgZGlzYWJsZWQuXG4gICAgICovXG4gICAgZGlzYWJsZVBvaW50ZXJMb2NrKHN1Y2Nlc3MpIHtcbiAgICAgICAgaWYgKCFkb2N1bWVudC5leGl0UG9pbnRlckxvY2spIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHMgPSAoKSA9PiB7XG4gICAgICAgICAgICBzdWNjZXNzKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdwb2ludGVybG9ja2NoYW5nZScsIHMpO1xuICAgICAgICB9O1xuICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigncG9pbnRlcmxvY2tjaGFuZ2UnLCBzLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgICAgZG9jdW1lbnQuZXhpdFBvaW50ZXJMb2NrKCk7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogVXBkYXRlIG1ldGhvZCwgc2hvdWxkIGJlIGNhbGxlZCBvbmNlIHBlciBmcmFtZS5cbiAgICAgKi9cbiAgICB1cGRhdGUoKSB7XG4gICAgICAgIC8vIENvcHkgY3VycmVudCBidXR0b24gc3RhdGVcbiAgICAgICAgdGhpcy5fbGFzdGJ1dHRvbnNbMF0gPSB0aGlzLl9idXR0b25zWzBdO1xuICAgICAgICB0aGlzLl9sYXN0YnV0dG9uc1sxXSA9IHRoaXMuX2J1dHRvbnNbMV07XG4gICAgICAgIHRoaXMuX2xhc3RidXR0b25zWzJdID0gdGhpcy5fYnV0dG9uc1syXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIG1vdXNlIGJ1dHRvbiBpcyBjdXJyZW50bHkgcHJlc3NlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBidXR0b24gLSBUaGUgbW91c2UgYnV0dG9uIHRvIHRlc3QuIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX0xFRlR9XG4gICAgICogLSB7QGxpbmsgTU9VU0VCVVRUT05fTUlERExFfVxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX1JJR0hUfVxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIG1vdXNlIGJ1dHRvbiBpcyBjdXJyZW50IHByZXNzZWQuXG4gICAgICovXG4gICAgaXNQcmVzc2VkKGJ1dHRvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnV0dG9uc1tidXR0b25dO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgbW91c2UgYnV0dG9uIHdhcyBwcmVzc2VkIHRoaXMgZnJhbWUgKHNpbmNlIHRoZSBsYXN0IGNhbGwgdG8gdXBkYXRlKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBidXR0b24gLSBUaGUgbW91c2UgYnV0dG9uIHRvIHRlc3QuIENhbiBiZTpcbiAgICAgKlxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX0xFRlR9XG4gICAgICogLSB7QGxpbmsgTU9VU0VCVVRUT05fTUlERExFfVxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX1JJR0hUfVxuICAgICAqXG4gICAgICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIG1vdXNlIGJ1dHRvbiB3YXMgcHJlc3NlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUuXG4gICAgICovXG4gICAgd2FzUHJlc3NlZChidXR0b24pIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLl9idXR0b25zW2J1dHRvbl0gJiYgIXRoaXMuX2xhc3RidXR0b25zW2J1dHRvbl0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgbW91c2UgYnV0dG9uIHdhcyByZWxlYXNlZCB0aGlzIGZyYW1lIChzaW5jZSB0aGUgbGFzdCBjYWxsIHRvIHVwZGF0ZSkuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gYnV0dG9uIC0gVGhlIG1vdXNlIGJ1dHRvbiB0byB0ZXN0LiBDYW4gYmU6XG4gICAgICpcbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9MRUZUfVxuICAgICAqIC0ge0BsaW5rIE1PVVNFQlVUVE9OX01JRERMRX1cbiAgICAgKiAtIHtAbGluayBNT1VTRUJVVFRPTl9SSUdIVH1cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIHRoZSBtb3VzZSBidXR0b24gd2FzIHJlbGVhc2VkIHNpbmNlIHRoZSBsYXN0IHVwZGF0ZS5cbiAgICAgKi9cbiAgICB3YXNSZWxlYXNlZChidXR0b24pIHtcbiAgICAgICAgcmV0dXJuICghdGhpcy5fYnV0dG9uc1tidXR0b25dICYmIHRoaXMuX2xhc3RidXR0b25zW2J1dHRvbl0pO1xuICAgIH1cblxuICAgIF9oYW5kbGVVcChldmVudCkge1xuICAgICAgICAvLyBkaXNhYmxlIHJlbGVhc2VkIGJ1dHRvblxuICAgICAgICB0aGlzLl9idXR0b25zW2V2ZW50LmJ1dHRvbl0gPSBmYWxzZTtcblxuICAgICAgICBjb25zdCBlID0gbmV3IE1vdXNlRXZlbnQodGhpcywgZXZlbnQpO1xuICAgICAgICBpZiAoIWUuZXZlbnQpIHJldHVybjtcblxuICAgICAgICAvLyBzZW5kICdtb3VzZXVwJyBldmVudFxuICAgICAgICB0aGlzLmZpcmUoRVZFTlRfTU9VU0VVUCwgZSk7XG4gICAgfVxuXG4gICAgX2hhbmRsZURvd24oZXZlbnQpIHtcbiAgICAgICAgLy8gU3RvcmUgd2hpY2ggYnV0dG9uIGhhcyBhZmZlY3RlZFxuICAgICAgICB0aGlzLl9idXR0b25zW2V2ZW50LmJ1dHRvbl0gPSB0cnVlO1xuXG4gICAgICAgIGNvbnN0IGUgPSBuZXcgTW91c2VFdmVudCh0aGlzLCBldmVudCk7XG4gICAgICAgIGlmICghZS5ldmVudCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuZmlyZShFVkVOVF9NT1VTRURPV04sIGUpO1xuICAgIH1cblxuICAgIF9oYW5kbGVNb3ZlKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGUgPSBuZXcgTW91c2VFdmVudCh0aGlzLCBldmVudCk7XG4gICAgICAgIGlmICghZS5ldmVudCkgcmV0dXJuO1xuXG4gICAgICAgIHRoaXMuZmlyZShFVkVOVF9NT1VTRU1PVkUsIGUpO1xuXG4gICAgICAgIC8vIFN0b3JlIHRoZSBsYXN0IG9mZnNldCBwb3NpdGlvbiB0byBjYWxjdWxhdGUgZGVsdGFzXG4gICAgICAgIHRoaXMuX2xhc3RYID0gZS54O1xuICAgICAgICB0aGlzLl9sYXN0WSA9IGUueTtcbiAgICB9XG5cbiAgICBfaGFuZGxlV2hlZWwoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBNb3VzZUV2ZW50KHRoaXMsIGV2ZW50KTtcbiAgICAgICAgaWYgKCFlLmV2ZW50KSByZXR1cm47XG5cbiAgICAgICAgdGhpcy5maXJlKEVWRU5UX01PVVNFV0hFRUwsIGUpO1xuICAgIH1cblxuICAgIF9nZXRUYXJnZXRDb29yZHMoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgcmVjdCA9IHRoaXMuX3RhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3QgbGVmdCA9IE1hdGguZmxvb3IocmVjdC5sZWZ0KTtcbiAgICAgICAgY29uc3QgdG9wID0gTWF0aC5mbG9vcihyZWN0LnRvcCk7XG5cbiAgICAgICAgLy8gbW91c2UgaXMgb3V0c2lkZSBvZiBjYW52YXNcbiAgICAgICAgaWYgKGV2ZW50LmNsaWVudFggPCBsZWZ0IHx8XG4gICAgICAgICAgICBldmVudC5jbGllbnRYID49IGxlZnQgKyB0aGlzLl90YXJnZXQuY2xpZW50V2lkdGggfHxcbiAgICAgICAgICAgIGV2ZW50LmNsaWVudFkgPCB0b3AgfHxcbiAgICAgICAgICAgIGV2ZW50LmNsaWVudFkgPj0gdG9wICsgdGhpcy5fdGFyZ2V0LmNsaWVudEhlaWdodCkge1xuXG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB4OiBldmVudC5jbGllbnRYIC0gbGVmdCxcbiAgICAgICAgICAgIHk6IGV2ZW50LmNsaWVudFkgLSB0b3BcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IE1vdXNlIH07XG4iXSwibmFtZXMiOlsiTW91c2UiLCJFdmVudEhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImVsZW1lbnQiLCJfbGFzdFgiLCJfbGFzdFkiLCJfYnV0dG9ucyIsIl9sYXN0YnV0dG9ucyIsIl91cEhhbmRsZXIiLCJfaGFuZGxlVXAiLCJiaW5kIiwiX2Rvd25IYW5kbGVyIiwiX2hhbmRsZURvd24iLCJfbW92ZUhhbmRsZXIiLCJfaGFuZGxlTW92ZSIsIl93aGVlbEhhbmRsZXIiLCJfaGFuZGxlV2hlZWwiLCJfY29udGV4dE1lbnVIYW5kbGVyIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsIl90YXJnZXQiLCJfYXR0YWNoZWQiLCJhdHRhY2giLCJpc1BvaW50ZXJMb2NrZWQiLCJpc01vdXNlUG9pbnRlckxvY2tlZCIsIm9wdHMiLCJwbGF0Zm9ybSIsInBhc3NpdmVFdmVudHMiLCJwYXNzaXZlIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImRldGFjaCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJkaXNhYmxlQ29udGV4dE1lbnUiLCJlbmFibGVDb250ZXh0TWVudSIsImVuYWJsZVBvaW50ZXJMb2NrIiwic3VjY2VzcyIsImVycm9yIiwiZG9jdW1lbnQiLCJib2R5IiwicmVxdWVzdFBvaW50ZXJMb2NrIiwicyIsImUiLCJkaXNhYmxlUG9pbnRlckxvY2siLCJleGl0UG9pbnRlckxvY2siLCJ1cGRhdGUiLCJpc1ByZXNzZWQiLCJidXR0b24iLCJ3YXNQcmVzc2VkIiwid2FzUmVsZWFzZWQiLCJNb3VzZUV2ZW50IiwiZmlyZSIsIkVWRU5UX01PVVNFVVAiLCJFVkVOVF9NT1VTRURPV04iLCJFVkVOVF9NT1VTRU1PVkUiLCJ4IiwieSIsIkVWRU5UX01PVVNFV0hFRUwiLCJfZ2V0VGFyZ2V0Q29vcmRzIiwicmVjdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImxlZnQiLCJNYXRoIiwiZmxvb3IiLCJ0b3AiLCJjbGllbnRYIiwiY2xpZW50V2lkdGgiLCJjbGllbnRZIiwiY2xpZW50SGVpZ2h0Il0sIm1hcHBpbmdzIjoiOzs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUEsS0FBSyxTQUFTQyxZQUFZLENBQUM7QUFDN0I7QUFDSjtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxPQUFPLEVBQUU7QUFDakIsSUFBQSxLQUFLLEVBQUUsQ0FBQTs7QUFFUDtJQUNBLElBQUksQ0FBQ0MsTUFBTSxHQUFHLENBQUMsQ0FBQTtJQUNmLElBQUksQ0FBQ0MsTUFBTSxHQUFHLENBQUMsQ0FBQTtJQUNmLElBQUksQ0FBQ0MsUUFBUSxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMs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
