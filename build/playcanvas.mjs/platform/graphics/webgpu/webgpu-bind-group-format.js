import { Debug, DebugHelper } from '../../../core/debug.js';
import { StringIds } from '../../../core/string-ids.js';
import { SAMPLETYPE_FLOAT, SAMPLETYPE_UNFILTERABLE_FLOAT, SAMPLETYPE_DEPTH } from '../constants.js';
import { WebgpuUtils } from './webgpu-utils.js';

const samplerTypes = [];
samplerTypes[SAMPLETYPE_FLOAT] = 'filtering';
samplerTypes[SAMPLETYPE_UNFILTERABLE_FLOAT] = 'non-filtering';
samplerTypes[SAMPLETYPE_DEPTH] = 'comparison';
const sampleTypes = [];
sampleTypes[SAMPLETYPE_FLOAT] = 'float';
sampleTypes[SAMPLETYPE_UNFILTERABLE_FLOAT] = 'unfilterable-float';
sampleTypes[SAMPLETYPE_DEPTH] = 'depth';
const stringIds = new StringIds();

/**
 * A WebGPU implementation of the BindGroupFormat, which is a wrapper over GPUBindGroupLayout.
 *
 * @ignore
 */
class WebgpuBindGroupFormat {
  /**
   * @param {import('../bind-group-format.js').BindGroupFormat} bindGroupFormat - Bind group format.
   */
  constructor(bindGroupFormat) {
    /** @type {import('./webgpu-graphics-device.js').WebgpuGraphicsDevice} */
    const device = bindGroupFormat.device;
    const {
      key,
      descr
    } = this.createDescriptor(bindGroupFormat);

    /**
     * Unique key, used for caching
     *
     * @type {number}
     */
    this.key = stringIds.get(key);

    // keep descr in debug mode
    Debug.call(() => {
      this.descr = descr;
    });

    /**
     * @type {GPUBindGroupLayout}
     * @private
     */
    this.bindGroupLayout = device.wgpu.createBindGroupLayout(descr);
    DebugHelper.setLabel(this.bindGroupLayout, bindGroupFormat.name);
  }
  destroy() {
    this.bindGroupLayout = null;
  }
  loseContext() {
    // this.bindGroupLayout = null;
  }

  /**
   * Returns texture binding slot.
   *
   * @param {import('../bind-group-format.js').BindGroupFormat} bindGroupFormat - Bind group format.
   * @param {number} index - The index of the texture.
   * @returns {number} - The slot index.
   */
  getTextureSlot(bindGroupFormat, index) {
    // each texture takes 2 slots (texture, sampler) and those are added after uniform buffers
    return bindGroupFormat.bufferFormats.length + index * 2;
  }

  /**
   * @param {any} bindGroupFormat - The format of the bind group.
   * @returns {any} Returns the bind group descriptor.
   */
  createDescriptor(bindGroupFormat) {
    // all WebGPU bindings:
    // - buffer: GPUBufferBindingLayout, resource type is GPUBufferBinding
    // - sampler: GPUSamplerBindingLayout, resource type is GPUSampler
    // - texture: GPUTextureBindingLayout, resource type is GPUTextureView
    // - storageTexture: GPUStorageTextureBindingLayout, resource type is GPUTextureView
    // - externalTexture: GPUExternalTextureBindingLayout, resource type is GPUExternalTexture
    const entries = [];

    // generate unique key
    let key = '';
    let index = 0;
    bindGroupFormat.bufferFormats.forEach(bufferFormat => {
      const visibility = WebgpuUtils.shaderStage(bufferFormat.visibility);
      key += `#${index}U:${visibility}`;
      entries.push({
        binding: index++,
        visibility: visibility,
        buffer: {
          type: 'uniform',
          // "uniform", "storage", "read-only-storage"

          // whether this binding requires a dynamic offset
          // currently all UBs are dynamic and need the offset
          hasDynamicOffset: true

          // defaults to 0 meaning no validation, can do early size validation using it
          // minBindingSize
        }
      });
    });

    bindGroupFormat.textureFormats.forEach(textureFormat => {
      const visibility = WebgpuUtils.shaderStage(textureFormat.visibility);

      // texture
      const sampleType = textureFormat.sampleType;
      const viewDimension = textureFormat.textureDimension;
      const multisampled = false;
      const gpuSampleType = sampleTypes[sampleType];
      Debug.assert(gpuSampleType);
      key += `#${index}T:${visibility}-${gpuSampleType}-${viewDimension}-${multisampled}`;
      entries.push({
        binding: index++,
        visibility: visibility,
        texture: {
          // Indicates the type required for texture views bound to this binding.
          // "float", "unfilterable-float", "depth", "sint", "uint",
          sampleType: gpuSampleType,
          // Indicates the required dimension for texture views bound to this binding.
          // "1d", "2d", "2d-array", "cube", "cube-array", "3d"
          viewDimension: viewDimension,
          // Indicates whether or not texture views bound to this binding must be multisampled
          multisampled: multisampled
        }
      });

      // sampler
      const gpuSamplerType = samplerTypes[sampleType];
      Debug.assert(gpuSamplerType);
      key += `#${index}S:${visibility}-${gpuSamplerType}`;
      entries.push({
        binding: index++,
        visibility: visibility,
        sampler: {
          // Indicates the required type of a sampler bound to this bindings
          // 'filtering', 'non-filtering', 'comparison'
          type: gpuSamplerType
        }
      });
    });

    /** @type {GPUBindGroupLayoutDescriptor} */
    const descr = {
      entries: entries
    };
    return {
      key,
      descr
    };
  }
}

export { WebgpuBindGroupFormat };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViZ3B1LWJpbmQtZ3JvdXAtZm9ybWF0LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvcGxhdGZvcm0vZ3JhcGhpY3Mvd2ViZ3B1L3dlYmdwdS1iaW5kLWdyb3VwLWZvcm1hdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEZWJ1ZywgRGVidWdIZWxwZXIgfSBmcm9tICcuLi8uLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7IFN0cmluZ0lkcyB9IGZyb20gJy4uLy4uLy4uL2NvcmUvc3RyaW5nLWlkcy5qcyc7XG5pbXBvcnQgeyBTQU1QTEVUWVBFX0ZMT0FULCBTQU1QTEVUWVBFX1VORklMVEVSQUJMRV9GTE9BVCwgU0FNUExFVFlQRV9ERVBUSCB9IGZyb20gJy4uL2NvbnN0YW50cy5qcyc7XG5cbmltcG9ydCB7IFdlYmdwdVV0aWxzIH0gZnJvbSAnLi93ZWJncHUtdXRpbHMuanMnO1xuXG5jb25zdCBzYW1wbGVyVHlwZXMgPSBbXTtcbnNhbXBsZXJUeXBlc1tTQU1QTEVUWVBFX0ZMT0FUXSA9ICdmaWx0ZXJpbmcnO1xuc2FtcGxlclR5cGVzW1NBTVBMRVRZUEVfVU5GSUxURVJBQkxFX0ZMT0FUXSA9ICdub24tZmlsdGVyaW5nJztcbnNhbXBsZXJUeXBlc1tTQU1QTEVUWVBFX0RFUFRIXSA9ICdjb21wYXJpc29uJztcblxuY29uc3Qgc2FtcGxlVHlwZXMgPSBbXTtcbnNhbXBsZVR5cGVzW1NBTVBMRVRZUEVfRkxPQVRdID0gJ2Zsb2F0JztcbnNhbXBsZVR5cGVzW1NBTVBMRVRZUEVfVU5GSUxURVJBQkxFX0ZMT0FUXSA9ICd1bmZpbHRlcmFibGUtZmxvYXQnO1xuc2FtcGxlVHlwZXNbU0FNUExFVFlQRV9ERVBUSF0gPSAnZGVwdGgnO1xuXG5jb25zdCBzdHJpbmdJZHMgPSBuZXcgU3RyaW5nSWRzKCk7XG5cbi8qKlxuICogQSBXZWJHUFUgaW1wbGVtZW50YXRpb24gb2YgdGhlIEJpbmRHcm91cEZvcm1hdCwgd2hpY2ggaXMgYSB3cmFwcGVyIG92ZXIgR1BVQmluZEdyb3VwTGF5b3V0LlxuICpcbiAqIEBpZ25vcmVcbiAqL1xuY2xhc3MgV2ViZ3B1QmluZEdyb3VwRm9ybWF0IHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYmluZC1ncm91cC1mb3JtYXQuanMnKS5CaW5kR3JvdXBGb3JtYXR9IGJpbmRHcm91cEZvcm1hdCAtIEJpbmQgZ3JvdXAgZm9ybWF0LlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGJpbmRHcm91cEZvcm1hdCkge1xuXG4gICAgICAgIC8qKiBAdHlwZSB7aW1wb3J0KCcuL3dlYmdwdS1ncmFwaGljcy1kZXZpY2UuanMnKS5XZWJncHVHcmFwaGljc0RldmljZX0gKi9cbiAgICAgICAgY29uc3QgZGV2aWNlID0gYmluZEdyb3VwRm9ybWF0LmRldmljZTtcblxuICAgICAgICBjb25zdCB7IGtleSwgZGVzY3IgfSA9IHRoaXMuY3JlYXRlRGVzY3JpcHRvcihiaW5kR3JvdXBGb3JtYXQpO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBVbmlxdWUga2V5LCB1c2VkIGZvciBjYWNoaW5nXG4gICAgICAgICAqXG4gICAgICAgICAqIEB0eXBlIHtudW1iZXJ9XG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmtleSA9IHN0cmluZ0lkcy5nZXQoa2V5KTtcblxuICAgICAgICAvLyBrZWVwIGRlc2NyIGluIGRlYnVnIG1vZGVcbiAgICAgICAgRGVidWcuY2FsbCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRlc2NyID0gZGVzY3I7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAdHlwZSB7R1BVQmluZEdyb3VwTGF5b3V0fVxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5iaW5kR3JvdXBMYXlvdXQgPSBkZXZpY2Uud2dwdS5jcmVhdGVCaW5kR3JvdXBMYXlvdXQoZGVzY3IpO1xuICAgICAgICBEZWJ1Z0hlbHBlci5zZXRMYWJlbCh0aGlzLmJpbmRHcm91cExheW91dCwgYmluZEdyb3VwRm9ybWF0Lm5hbWUpO1xuICAgIH1cblxuICAgIGRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuYmluZEdyb3VwTGF5b3V0ID0gbnVsbDtcbiAgICB9XG5cbiAgICBsb3NlQ29udGV4dCgpIHtcbiAgICAgICAgLy8gdGhpcy5iaW5kR3JvdXBMYXlvdXQgPSBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGV4dHVyZSBiaW5kaW5nIHNsb3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYmluZC1ncm91cC1mb3JtYXQuanMnKS5CaW5kR3JvdXBGb3JtYXR9IGJpbmRHcm91cEZvcm1hdCAtIEJpbmQgZ3JvdXAgZm9ybWF0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBpbmRleCAtIFRoZSBpbmRleCBvZiB0aGUgdGV4dHVyZS5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSAtIFRoZSBzbG90IGluZGV4LlxuICAgICAqL1xuICAgIGdldFRleHR1cmVTbG90KGJpbmRHcm91cEZvcm1hdCwgaW5kZXgpIHtcbiAgICAgICAgLy8gZWFjaCB0ZXh0dXJlIHRha2VzIDIgc2xvdHMgKHRleHR1cmUsIHNhbXBsZXIpIGFuZCB0aG9zZSBhcmUgYWRkZWQgYWZ0ZXIgdW5pZm9ybSBidWZmZXJzXG4gICAgICAgIHJldHVybiBiaW5kR3JvdXBGb3JtYXQuYnVmZmVyRm9ybWF0cy5sZW5ndGggKyBpbmRleCAqIDI7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHthbnl9IGJpbmRHcm91cEZvcm1hdCAtIFRoZSBmb3JtYXQgb2YgdGhlIGJpbmQgZ3JvdXAuXG4gICAgICogQHJldHVybnMge2FueX0gUmV0dXJucyB0aGUgYmluZCBncm91cCBkZXNjcmlwdG9yLlxuICAgICAqL1xuICAgIGNyZWF0ZURlc2NyaXB0b3IoYmluZEdyb3VwRm9ybWF0KSB7XG4gICAgICAgIC8vIGFsbCBXZWJHUFUgYmluZGluZ3M6XG4gICAgICAgIC8vIC0gYnVmZmVyOiBHUFVCdWZmZXJCaW5kaW5nTGF5b3V0LCByZXNvdXJjZSB0eXBlIGlzIEdQVUJ1ZmZlckJpbmRpbmdcbiAgICAgICAgLy8gLSBzYW1wbGVyOiBHUFVTYW1wbGVyQmluZGluZ0xheW91dCwgcmVzb3VyY2UgdHlwZSBpcyBHUFVTYW1wbGVyXG4gICAgICAgIC8vIC0gdGV4dHVyZTogR1BVVGV4dHVyZUJpbmRpbmdMYXlvdXQsIHJlc291cmNlIHR5cGUgaXMgR1BVVGV4dHVyZVZpZXdcbiAgICAgICAgLy8gLSBzdG9yYWdlVGV4dHVyZTogR1BVU3RvcmFnZVRleHR1cmVCaW5kaW5nTGF5b3V0LCByZXNvdXJjZSB0eXBlIGlzIEdQVVRleHR1cmVWaWV3XG4gICAgICAgIC8vIC0gZXh0ZXJuYWxUZXh0dXJlOiBHUFVFeHRlcm5hbFRleHR1cmVCaW5kaW5nTGF5b3V0LCByZXNvdXJjZSB0eXBlIGlzIEdQVUV4dGVybmFsVGV4dHVyZVxuICAgICAgICBjb25zdCBlbnRyaWVzID0gW107XG5cbiAgICAgICAgLy8gZ2VuZXJhdGUgdW5pcXVlIGtleVxuICAgICAgICBsZXQga2V5ID0gJyc7XG5cbiAgICAgICAgbGV0IGluZGV4ID0gMDtcbiAgICAgICAgYmluZEdyb3VwRm9ybWF0LmJ1ZmZlckZvcm1hdHMuZm9yRWFjaCgoYnVmZmVyRm9ybWF0KSA9PiB7XG5cbiAgICAgICAgICAgIGNvbnN0IHZpc2liaWxpdHkgPSBXZWJncHVVdGlscy5zaGFkZXJTdGFnZShidWZmZXJGb3JtYXQudmlzaWJpbGl0eSk7XG4gICAgICAgICAgICBrZXkgKz0gYCMke2luZGV4fVU6JHt2aXNpYmlsaXR5fWA7XG5cbiAgICAgICAgICAgIGVudHJpZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgYmluZGluZzogaW5kZXgrKyxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmlsaXR5LFxuXG4gICAgICAgICAgICAgICAgYnVmZmVyOiB7XG5cbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VuaWZvcm0nLCAvLyBcInVuaWZvcm1cIiwgXCJzdG9yYWdlXCIsIFwicmVhZC1vbmx5LXN0b3JhZ2VcIlxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHdoZXRoZXIgdGhpcyBiaW5kaW5nIHJlcXVpcmVzIGEgZHluYW1pYyBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudGx5IGFsbCBVQnMgYXJlIGR5bmFtaWMgYW5kIG5lZWQgdGhlIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICBoYXNEeW5hbWljT2Zmc2V0OiB0cnVlXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZGVmYXVsdHMgdG8gMCBtZWFuaW5nIG5vIHZhbGlkYXRpb24sIGNhbiBkbyBlYXJseSBzaXplIHZhbGlkYXRpb24gdXNpbmcgaXRcbiAgICAgICAgICAgICAgICAgICAgLy8gbWluQmluZGluZ1NpemVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYmluZEdyb3VwRm9ybWF0LnRleHR1cmVGb3JtYXRzLmZvckVhY2goKHRleHR1cmVGb3JtYXQpID0+IHtcblxuICAgICAgICAgICAgY29uc3QgdmlzaWJpbGl0eSA9IFdlYmdwdVV0aWxzLnNoYWRlclN0YWdlKHRleHR1cmVGb3JtYXQudmlzaWJpbGl0eSk7XG5cbiAgICAgICAgICAgIC8vIHRleHR1cmVcbiAgICAgICAgICAgIGNvbnN0IHNhbXBsZVR5cGUgPSB0ZXh0dXJlRm9ybWF0LnNhbXBsZVR5cGU7XG4gICAgICAgICAgICBjb25zdCB2aWV3RGltZW5zaW9uID0gdGV4dHVyZUZvcm1hdC50ZXh0dXJlRGltZW5zaW9uO1xuICAgICAgICAgICAgY29uc3QgbXVsdGlzYW1wbGVkID0gZmFsc2U7XG5cbiAgICAgICAgICAgIGNvbnN0IGdwdVNhbXBsZVR5cGUgPSBzYW1wbGVUeXBlc1tzYW1wbGVUeXBlXTtcbiAgICAgICAgICAgIERlYnVnLmFzc2VydChncHVTYW1wbGVUeXBlKTtcblxuICAgICAgICAgICAga2V5ICs9IGAjJHtpbmRleH1UOiR7dmlzaWJpbGl0eX0tJHtncHVTYW1wbGVUeXBlfS0ke3ZpZXdEaW1lbnNpb259LSR7bXVsdGlzYW1wbGVkfWA7XG5cbiAgICAgICAgICAgIGVudHJpZXMucHVzaCh7XG4gICAgICAgICAgICAgICAgYmluZGluZzogaW5kZXgrKyxcbiAgICAgICAgICAgICAgICB2aXNpYmlsaXR5OiB2aXNpYmlsaXR5LFxuICAgICAgICAgICAgICAgIHRleHR1cmU6IHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSW5kaWNhdGVzIHRoZSB0eXBlIHJlcXVpcmVkIGZvciB0ZXh0dXJlIHZpZXdzIGJvdW5kIHRvIHRoaXMgYmluZGluZy5cbiAgICAgICAgICAgICAgICAgICAgLy8gXCJmbG9hdFwiLCBcInVuZmlsdGVyYWJsZS1mbG9hdFwiLCBcImRlcHRoXCIsIFwic2ludFwiLCBcInVpbnRcIixcbiAgICAgICAgICAgICAgICAgICAgc2FtcGxlVHlwZTogZ3B1U2FtcGxlVHlwZSxcblxuICAgICAgICAgICAgICAgICAgICAvLyBJbmRpY2F0ZXMgdGhlIHJlcXVpcmVkIGRpbWVuc2lvbiBmb3IgdGV4dHVyZSB2aWV3cyBib3VuZCB0byB0aGlzIGJpbmRpbmcuXG4gICAgICAgICAgICAgICAgICAgIC8vIFwiMWRcIiwgXCIyZFwiLCBcIjJkLWFycmF5XCIsIFwiY3ViZVwiLCBcImN1YmUtYXJyYXlcIiwgXCIzZFwiXG4gICAgICAgICAgICAgICAgICAgIHZpZXdEaW1lbnNpb246IHZpZXdEaW1lbnNpb24sXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSW5kaWNhdGVzIHdoZXRoZXIgb3Igbm90IHRleHR1cmUgdmlld3MgYm91bmQgdG8gdGhpcyBiaW5kaW5nIG11c3QgYmUgbXVsdGlzYW1wbGVkXG4gICAgICAgICAgICAgICAgICAgIG11bHRpc2FtcGxlZDogbXVsdGlzYW1wbGVkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIHNhbXBsZXJcbiAgICAgICAgICAgIGNvbnN0IGdwdVNhbXBsZXJUeXBlID0gc2FtcGxlclR5cGVzW3NhbXBsZVR5cGVdO1xuICAgICAgICAgICAgRGVidWcuYXNzZXJ0KGdwdVNhbXBsZXJUeXBlKTtcblxuICAgICAgICAgICAga2V5ICs9IGAjJHtpbmRleH1TOiR7dmlzaWJpbGl0eX0tJHtncHVTYW1wbGVyVHlwZX1gO1xuXG4gICAgICAgICAgICBlbnRyaWVzLnB1c2goe1xuICAgICAgICAgICAgICAgIGJpbmRpbmc6IGluZGV4KyssXG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eTogdmlzaWJpbGl0eSxcbiAgICAgICAgICAgICAgICBzYW1wbGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEluZGljYXRlcyB0aGUgcmVxdWlyZWQgdHlwZSBvZiBhIHNhbXBsZXIgYm91bmQgdG8gdGhpcyBiaW5kaW5nc1xuICAgICAgICAgICAgICAgICAgICAvLyAnZmlsdGVyaW5nJywgJ25vbi1maWx0ZXJpbmcnLCAnY29tcGFyaXNvbidcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogZ3B1U2FtcGxlclR5cGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLyoqIEB0eXBlIHtHUFVCaW5kR3JvdXBMYXlvdXREZXNjcmlwdG9yfSAqL1xuICAgICAgICBjb25zdCBkZXNjciA9IHtcbiAgICAgICAgICAgIGVudHJpZXM6IGVudHJpZXNcbiAgICAgICAgfTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2V5LFxuICAgICAgICAgICAgZGVzY3JcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFdlYmdwdUJpbmRHcm91cEZvcm1hdCB9O1xuIl0sIm5hbWVzIjpbInNhbXBsZXJUeXBlcyIsIlNBTVBMRVRZUEVfRkxPQVQiLCJTQU1QTEVUWVBFX1VORklMVEVSQUJMRV9GTE9BVCIsIlNBTVBMRVRZUEVfREVQVEgiLCJzYW1wbGVUeXBlcyIsInN0cmluZ0lkcyIsIlN0cmluZ0lkcyIsIldlYmdwdUJpbmRHcm91cEZvcm1hdCIsImNvbnN0cnVjdG9yIiwiYmluZEdyb3VwRm9ybWF0IiwiZGV2aWNlIiwia2V5IiwiZGVzY3IiLCJjcmVhdGVEZXNjcmlwdG9yIiwiZ2V0IiwiRGVidWciLCJjYWxsIiwiYmluZEdyb3VwTGF5b3V0Iiwid2dwdSIsImNyZWF0ZUJpbmRHcm91cExheW91dCIsIkRlYnVnSGVscGVyIiwic2V0TGFiZWwiLCJuYW1lIiwiZGVzdHJveSIsImxvc2VDb250ZXh0IiwiZ2V0VGV4dHVyZVNsb3QiLCJpbmRleCIsImJ1ZmZlckZvcm1hdHMiLCJsZW5ndGgiLCJlbnRyaWVzIiwiZm9yRWFjaCIsImJ1ZmZlckZvcm1hdCIsInZpc2liaWxpdHkiLCJXZWJncHVVdGlscyIsInNoYWRlclN0YWdlIiwicHVzaCIsImJpbmRpbmciLCJidWZmZXIiLCJ0eXBlIiwiaGFzRHluYW1pY09mZnNldCIsInRleHR1cmVGb3JtYXRzIiwidGV4dHVyZUZvcm1hdCIsInNhbXBsZVR5cGUiLCJ2aWV3RGltZW5zaW9uIiwidGV4dHVyZURpbWVuc2lvbiIsIm11bHRpc2FtcGxlZCIsImdwdVNhbXBsZVR5cGUiLCJhc3NlcnQiLCJ0ZXh0dXJlIiwiZ3B1U2FtcGxlclR5cGUiLCJzYW1wbGVyIl0sIm1hcHBpbmdzIjoiOzs7OztBQU1BLE1BQU1BLFlBQVksR0FBRyxFQUFFLENBQUE7QUFDdkJBLFlBQVksQ0FBQ0MsZ0JBQWdCLENBQUMsR0FBRyxXQUFXLENBQUE7QUFDNUNELFlBQVksQ0FBQ0UsNkJBQTZCLENBQUMsR0FBRyxlQUFlLENBQUE7QUFDN0RGLFlBQVksQ0FBQ0csZ0JBQWdCLENBQUMsR0FBRyxZQUFZLENBQUE7QUFFN0MsTUFBTUMsV0FBVyxHQUFHLEVBQUUsQ0FBQTtBQUN0QkEsV0FBVyxDQUFDSCxnQkFBZ0IsQ0FBQyxHQUFHLE9BQU8sQ0FBQTtBQUN2Q0csV0FBVyxDQUFDRiw2QkFBNkIsQ0FB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
