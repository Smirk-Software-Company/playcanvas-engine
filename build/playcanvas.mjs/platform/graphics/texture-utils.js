import { Debug } from '../../core/debug.js';
import { pixelFormatInfo, PIXELFORMAT_PVRTC_2BPP_RGB_1, PIXELFORMAT_PVRTC_2BPP_RGBA_1 } from './constants.js';

/**
 * A class providing utility functions for textures.
 *
 * @ignore
 */
class TextureUtils {
  /**
   * Calculate the dimension of a texture at a specific mip level.
   *
   * @param {number} dimension - Texture dimension at level 0.
   * @param {number} mipLevel - Mip level.
   * @returns {number} The dimension of the texture at the specified mip level.
   */
  static calcLevelDimension(dimension, mipLevel) {
    return Math.max(dimension >> mipLevel, 1);
  }

  /**
   * Calculate the size in bytes of the texture level given its format and dimensions.
   *
   * @param {number} width - Texture's width.
   * @param {number} height - Texture's height.
   * @param {number} depth - Texture's depth.
   * @param {number} format - Texture's pixel format PIXELFORMAT_***.
   * @returns {number} The number of bytes of GPU memory required for the texture.
   * @ignore
   */
  static calcLevelGpuSize(width, height, depth, format) {
    var _pixelFormatInfo$get$, _pixelFormatInfo$get, _formatInfo$blockSize;
    const formatInfo = pixelFormatInfo.get(format);
    Debug.assert(formatInfo !== undefined, `Invalid pixel format ${format}`);
    const pixelSize = (_pixelFormatInfo$get$ = (_pixelFormatInfo$get = pixelFormatInfo.get(format)) == null ? void 0 : _pixelFormatInfo$get.size) != null ? _pixelFormatInfo$get$ : 0;
    if (pixelSize > 0) {
      return width * height * depth * pixelSize;
    }
    const blockSize = (_formatInfo$blockSize = formatInfo.blockSize) != null ? _formatInfo$blockSize : 0;
    let blockWidth = Math.floor((width + 3) / 4);
    const blockHeight = Math.floor((height + 3) / 4);
    const blockDepth = Math.floor((depth + 3) / 4);
    if (format === PIXELFORMAT_PVRTC_2BPP_RGB_1 || format === PIXELFORMAT_PVRTC_2BPP_RGBA_1) {
      blockWidth = Math.max(Math.floor(blockWidth / 2), 1);
    }
    return blockWidth * blockHeight * blockDepth * blockSize;
  }

  /**
   * Calculate the GPU memory required for a texture.
   *
   * @param {number} width - Texture's width.
   * @param {number} height - Texture's height.
   * @param {number} depth - Texture's depth.
   * @param {number} format - Texture's pixel format PIXELFORMAT_***.
   * @param {boolean} mipmaps - True if the texture includes mipmaps, false otherwise.
   * @param {boolean} cubemap - True is the texture is a cubemap, false otherwise.
   * @returns {number} The number of bytes of GPU memory required for the texture.
   * @ignore
   */
  static calcGpuSize(width, height, depth, format, mipmaps, cubemap) {
    let result = 0;
    while (1) {
      result += TextureUtils.calcLevelGpuSize(width, height, depth, format);

      // we're done if mipmaps aren't required or we've calculated the smallest mipmap level
      if (!mipmaps || width === 1 && height === 1 && depth === 1) {
        break;
      }
      width = Math.max(width >> 1, 1);
      height = Math.max(height >> 1, 1);
      depth = Math.max(depth >> 1, 1);
    }
    return result * (cubemap ? 6 : 1);
  }
}

export { TextureUtils };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dHVyZS11dGlscy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3BsYXRmb3JtL2dyYXBoaWNzL3RleHR1cmUtdXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRGVidWcgfSBmcm9tICcuLi8uLi9jb3JlL2RlYnVnLmpzJztcbmltcG9ydCB7XG4gICAgcGl4ZWxGb3JtYXRJbmZvLFxuICAgIFBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCXzEsIFBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCQV8xXG59IGZyb20gJy4vY29uc3RhbnRzLmpzJztcblxuLyoqXG4gKiBBIGNsYXNzIHByb3ZpZGluZyB1dGlsaXR5IGZ1bmN0aW9ucyBmb3IgdGV4dHVyZXMuXG4gKlxuICogQGlnbm9yZVxuICovXG5jbGFzcyBUZXh0dXJlVXRpbHMge1xuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZSB0aGUgZGltZW5zaW9uIG9mIGEgdGV4dHVyZSBhdCBhIHNwZWNpZmljIG1pcCBsZXZlbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkaW1lbnNpb24gLSBUZXh0dXJlIGRpbWVuc2lvbiBhdCBsZXZlbCAwLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBtaXBMZXZlbCAtIE1pcCBsZXZlbC5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgZGltZW5zaW9uIG9mIHRoZSB0ZXh0dXJlIGF0IHRoZSBzcGVjaWZpZWQgbWlwIGxldmVsLlxuICAgICAqL1xuICAgIHN0YXRpYyBjYWxjTGV2ZWxEaW1lbnNpb24oZGltZW5zaW9uLCBtaXBMZXZlbCkge1xuICAgICAgICByZXR1cm4gTWF0aC5tYXgoZGltZW5zaW9uID4+IG1pcExldmVsLCAxKTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDYWxjdWxhdGUgdGhlIHNpemUgaW4gYnl0ZXMgb2YgdGhlIHRleHR1cmUgbGV2ZWwgZ2l2ZW4gaXRzIGZvcm1hdCBhbmQgZGltZW5zaW9ucy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB3aWR0aCAtIFRleHR1cmUncyB3aWR0aC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gaGVpZ2h0IC0gVGV4dHVyZSdzIGhlaWdodC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZGVwdGggLSBUZXh0dXJlJ3MgZGVwdGguXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGZvcm1hdCAtIFRleHR1cmUncyBwaXhlbCBmb3JtYXQgUElYRUxGT1JNQVRfKioqLlxuICAgICAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBudW1iZXIgb2YgYnl0ZXMgb2YgR1BVIG1lbW9yeSByZXF1aXJlZCBmb3IgdGhlIHRleHR1cmUuXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIHN0YXRpYyBjYWxjTGV2ZWxHcHVTaXplKHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBmb3JtYXQpIHtcblxuICAgICAgICBjb25zdCBmb3JtYXRJbmZvID0gcGl4ZWxGb3JtYXRJbmZvLmdldChmb3JtYXQpO1xuICAgICAgICBEZWJ1Zy5hc3NlcnQoZm9ybWF0SW5mbyAhPT0gdW5kZWZpbmVkLCBgSW52YWxpZCBwaXhlbCBmb3JtYXQgJHtmb3JtYXR9YCk7XG5cbiAgICAgICAgY29uc3QgcGl4ZWxTaXplID0gcGl4ZWxGb3JtYXRJbmZvLmdldChmb3JtYXQpPy5zaXplID8/IDA7XG4gICAgICAgIGlmIChwaXhlbFNpemUgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gd2lkdGggKiBoZWlnaHQgKiBkZXB0aCAqIHBpeGVsU2l6ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJsb2NrU2l6ZSA9IGZvcm1hdEluZm8uYmxvY2tTaXplID8/IDA7XG4gICAgICAgIGxldCBibG9ja1dpZHRoID0gTWF0aC5mbG9vcigod2lkdGggKyAzKSAvIDQpO1xuICAgICAgICBjb25zdCBibG9ja0hlaWdodCA9IE1hdGguZmxvb3IoKGhlaWdodCArIDMpIC8gNCk7XG4gICAgICAgIGNvbnN0IGJsb2NrRGVwdGggPSBNYXRoLmZsb29yKChkZXB0aCArIDMpIC8gNCk7XG5cbiAgICAgICAgaWYgKGZvcm1hdCA9PT0gUElYRUxGT1JNQVRfUFZSVENfMkJQUF9SR0JfMSB8fFxuICAgICAgICAgICAgZm9ybWF0ID09PSBQSVhFTEZPUk1BVF9QVlJUQ18yQlBQX1JHQkFfMSkge1xuICAgICAgICAgICAgYmxvY2tXaWR0aCA9IE1hdGgubWF4KE1hdGguZmxvb3IoYmxvY2tXaWR0aCAvIDIpLCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBibG9ja1dpZHRoICogYmxvY2tIZWlnaHQgKiBibG9ja0RlcHRoICogYmxvY2tTaXplO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENhbGN1bGF0ZSB0aGUgR1BVIG1lbW9yeSByZXF1aXJlZCBmb3IgYSB0ZXh0dXJlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHdpZHRoIC0gVGV4dHVyZSdzIHdpZHRoLlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBoZWlnaHQgLSBUZXh0dXJlJ3MgaGVpZ2h0LlxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkZXB0aCAtIFRleHR1cmUncyBkZXB0aC5cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZm9ybWF0IC0gVGV4dHVyZSdzIHBpeGVsIGZvcm1hdCBQSVhFTEZPUk1BVF8qKiouXG4gICAgICogQHBhcmFtIHtib29sZWFufSBtaXBtYXBzIC0gVHJ1ZSBpZiB0aGUgdGV4dHVyZSBpbmNsdWRlcyBtaXBtYXBzLCBmYWxzZSBvdGhlcndpc2UuXG4gICAgICogQHBhcmFtIHtib29sZWFufSBjdWJlbWFwIC0gVHJ1ZSBpcyB0aGUgdGV4dHVyZSBpcyBhIGN1YmVtYXAsIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgKiBAcmV0dXJucyB7bnVtYmVyfSBUaGUgbnVtYmVyIG9mIGJ5dGVzIG9mIEdQVSBtZW1vcnkgcmVxdWlyZWQgZm9yIHRoZSB0ZXh0dXJlLlxuICAgICAqIEBpZ25vcmVcbiAgICAgKi9cbiAgICBzdGF0aWMgY2FsY0dwdVNpemUod2lkdGgsIGhlaWdodCwgZGVwdGgsIGZvcm1hdCwgbWlwbWFwcywgY3ViZW1hcCkge1xuICAgICAgICBsZXQgcmVzdWx0ID0gMDtcblxuICAgICAgICB3aGlsZSAoMSkge1xuICAgICAgICAgICAgcmVzdWx0ICs9IFRleHR1cmVVdGlscy5jYWxjTGV2ZWxHcHVTaXplKHdpZHRoLCBoZWlnaHQsIGRlcHRoLCBmb3JtYXQpO1xuXG4gICAgICAgICAgICAvLyB3ZSdyZSBkb25lIGlmIG1pcG1hcHMgYXJlbid0IHJlcXVpcmVkIG9yIHdlJ3ZlIGNhbGN1bGF0ZWQgdGhlIHNtYWxsZXN0IG1pcG1hcCBsZXZlbFxuICAgICAgICAgICAgaWYgKCFtaXBtYXBzIHx8ICgod2lkdGggPT09IDEpICYmIChoZWlnaHQgPT09IDEpICYmIChkZXB0aCA9PT0gMSkpKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoID4+IDEsIDEpO1xuICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5tYXgoaGVpZ2h0ID4+IDEsIDEpO1xuICAgICAgICAgICAgZGVwdGggPSBNYXRoLm1heChkZXB0aCA+PiAxLCAxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHQgKiAoY3ViZW1hcCA/IDYgOiAxKTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IFRleHR1cmVVdGlscyB9O1xuIl0sIm5hbWVzIjpbIlRleHR1cmVVdGlscyIsImNhbGNMZXZlbERpbWVuc2lvbiIsImRpbWVuc2lvbiIsIm1pcExldmVsIiwiTWF0aCIsIm1heCIsImNhbGNMZXZlbEdwdVNpemUiLCJ3aWR0aCIsImhlaWdodCIsImRlcHRoIiwiZm9ybWF0IiwiX3BpeGVsRm9ybWF0SW5mbyRnZXQkIiwiX3BpeGVsRm9ybWF0SW5mbyRnZXQiLCJfZm9ybWF0SW5mbyRibG9ja1NpemUiLCJmb3JtYXRJbmZvIiwicGl4ZWxGb3JtYXRJbmZvIiwiZ2V0IiwiRGVidWciLCJhc3NlcnQiLCJ1bmRlZmluZWQiLCJwaXhlbFNpemUiLCJzaXplIiwiYmxvY2tTaXplIiwiYmxvY2tXaWR0aCIsImZsb29yIiwiYmxvY2tIZWlnaHQiLCJibG9ja0RlcHRoIiwiUElYRUxGT1JNQVRfUFZSVENfMkJQUF9SR0JfMSIsIlBJWEVMRk9STUFUX1BWUlRDXzJCUFBfUkdCQV8xIiwiY2FsY0dwdVNpemUiLCJtaXBtYXBzIiwiY3ViZW1hcCIsInJlc3VsdCJdLCJtYXBwaW5ncyI6Ijs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1BLFlBQVksQ0FBQztBQUNmO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0ksRUFBQSxPQUFPQyxrQkFBa0JBLENBQUNDLFNBQVMsRUFBRUMsUUFBUSxFQUFFO0lBQzNDLE9BQU9DLElBQUksQ0FBQ0MsR0FBRyxDQUFDSCxTQUFTLElBQUlDLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQTtBQUM3QyxHQUFBOztBQUVBO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0VBQ0ksT0FBT0csZ0JBQWdCQSxDQUFDQyxLQUFLLEVBQUVDLE1BQU0sRUFBRUMsS0FBSyxFQUFFQyxNQUFNLEVBQUU7QUFBQSxJQUFBLElBQUFDLHFCQUFBLEVBQUFDLG9CQUFBLEVBQUFDLHFCQUFBLENBQUE7QUFFbEQsSUFBQSxNQUFNQyxVQUFVLEdBQUdDLGVBQWUsQ0FBQ0MsR0FBRyxDQUFDTixNQUFNLENBQUMsQ0FBQTtJQUM5Q08sS0FBSyxDQUFDQyxNQUFNLENBQUNKLFVBQVUsS0FBS0ssU0FBUyxFQUFHLENBQUEscUJBQUEsRUFBdUJULE1BQU8sQ0FBQSxDQUFDLENBQUMsQ0FBQTtBQUV4RSxJQUFBLE1BQU1VLFNBQVMsR0FBQVQsQ0FBQUEscUJBQUEsSUFBQUMsb0JBQUEsR0FBR0csZUFBZSxDQUFDQyxHQUFHLENBQUNOLE1BQU0sQ0FBQyxxQkFBM0JFLG9CQUFBLENBQTZCUyxJQUFJLEtBQUFWLElBQUFB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
