import { path } from '../../core/path.js';
import { http } from '../../platform/net/http.js';
import { Sprite } from '../../scene/sprite.js';

/** @typedef {import('./handler.js').ResourceHandler} ResourceHandler */

// The scope of this function is the sprite asset
function onTextureAtlasLoaded(atlasAsset) {
  const spriteAsset = this;
  if (spriteAsset.resource) {
    spriteAsset.resource.atlas = atlasAsset.resource;
  }
}

// The scope of this function is the sprite asset
function onTextureAtlasAdded(atlasAsset) {
  const spriteAsset = this;
  spriteAsset.registry.load(atlasAsset);
}

/**
 * Resource handler used for loading {@link Sprite} resources.
 *
 * @implements {ResourceHandler}
 * @category Graphics
 */
class SpriteHandler {
  /**
   * Create a new SpriteHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @hideconstructor
   */
  constructor(app) {
    /**
     * Type of the resource the handler handles.
     *
     * @type {string}
     */
    this.handlerType = "sprite";
    this._assets = app.assets;
    this._device = app.graphicsDevice;
    this.maxRetries = 0;
  }
  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }

    // if given a json file (probably engine-only use case)
    if (path.getExtension(url.original) === '.json') {
      http.get(url.load, {
        retry: this.maxRetries > 0,
        maxRetries: this.maxRetries
      }, function (err, response) {
        if (!err) {
          callback(null, response);
        } else {
          callback(err);
        }
      });
    }
  }

  // Create sprite resource
  open(url, data) {
    const sprite = new Sprite(this._device);
    if (url) {
      // if url field is present json data is being loaded from file
      // store data on sprite object temporarily
      sprite.__data = data;
    }
    return sprite;
  }

  // Set sprite data
  patch(asset, assets) {
    const sprite = asset.resource;
    if (sprite.__data) {
      // loading from a json file we have asset data store temporarily on the sprite resource
      // copy it into asset.data and delete

      asset.data.pixelsPerUnit = sprite.__data.pixelsPerUnit;
      asset.data.renderMode = sprite.__data.renderMode;
      asset.data.frameKeys = sprite.__data.frameKeys;
      if (sprite.__data.textureAtlasAsset) {
        const atlas = assets.getByUrl(sprite.__data.textureAtlasAsset);
        if (atlas) {
          asset.data.textureAtlasAsset = atlas.id;
        } else {
          console.warn('Could not find textureatlas with url: ' + sprite.__data.textureAtlasAsset);
        }
      }

      // note: we don't remove sprite.__data in case another asset is loaded from the same URL when it is fetched from the cache
      // the __data is not re-assigned and so asset.data is not set up.
    }

    sprite.startUpdate();
    sprite.renderMode = asset.data.renderMode;
    sprite.pixelsPerUnit = asset.data.pixelsPerUnit;
    sprite.frameKeys = asset.data.frameKeys;
    this._updateAtlas(asset);
    sprite.endUpdate();
    asset.off('change', this._onAssetChange, this);
    asset.on('change', this._onAssetChange, this);
  }

  // Load atlas
  _updateAtlas(asset) {
    const sprite = asset.resource;
    if (!asset.data.textureAtlasAsset) {
      sprite.atlas = null;
      return;
    }
    this._assets.off('load:' + asset.data.textureAtlasAsset, onTextureAtlasLoaded, asset);
    this._assets.on('load:' + asset.data.textureAtlasAsset, onTextureAtlasLoaded, asset);
    const atlasAsset = this._assets.get(asset.data.textureAtlasAsset);
    if (atlasAsset && atlasAsset.resource) {
      sprite.atlas = atlasAsset.resource;
    } else {
      if (!atlasAsset) {
        this._assets.off('add:' + asset.data.textureAtlasAsset, onTextureAtlasAdded, asset);
        this._assets.on('add:' + asset.data.textureAtlasAsset, onTextureAtlasAdded, asset);
      } else {
        this._assets.load(atlasAsset);
      }
    }
  }
  _onAssetChange(asset, attribute, value, oldValue) {
    if (attribute === 'data') {
      // if the texture atlas changed, clear events for old atlas asset
      if (value && value.textureAtlasAsset && oldValue && value.textureAtlasAsset !== oldValue.textureAtlasAsset) {
        this._assets.off('load:' + oldValue.textureAtlasAsset, onTextureAtlasLoaded, asset);
        this._assets.off('add:' + oldValue.textureAtlasAsset, onTextureAtlasAdded, asset);
      }
    }
  }
}

export { SpriteHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3ByaXRlLmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvZnJhbWV3b3JrL2hhbmRsZXJzL3Nwcml0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBwYXRoIH0gZnJvbSAnLi4vLi4vY29yZS9wYXRoLmpzJztcblxuaW1wb3J0IHsgaHR0cCB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL25ldC9odHRwLmpzJztcblxuaW1wb3J0IHsgU3ByaXRlIH0gZnJvbSAnLi4vLi4vc2NlbmUvc3ByaXRlLmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vaGFuZGxlci5qcycpLlJlc291cmNlSGFuZGxlcn0gUmVzb3VyY2VIYW5kbGVyICovXG5cbi8vIFRoZSBzY29wZSBvZiB0aGlzIGZ1bmN0aW9uIGlzIHRoZSBzcHJpdGUgYXNzZXRcbmZ1bmN0aW9uIG9uVGV4dHVyZUF0bGFzTG9hZGVkKGF0bGFzQXNzZXQpIHtcbiAgICBjb25zdCBzcHJpdGVBc3NldCA9IHRoaXM7XG4gICAgaWYgKHNwcml0ZUFzc2V0LnJlc291cmNlKSB7XG4gICAgICAgIHNwcml0ZUFzc2V0LnJlc291cmNlLmF0bGFzID0gYXRsYXNBc3NldC5yZXNvdXJjZTtcbiAgICB9XG59XG5cbi8vIFRoZSBzY29wZSBvZiB0aGlzIGZ1bmN0aW9uIGlzIHRoZSBzcHJpdGUgYXNzZXRcbmZ1bmN0aW9uIG9uVGV4dHVyZUF0bGFzQWRkZWQoYXRsYXNBc3NldCkge1xuICAgIGNvbnN0IHNwcml0ZUFzc2V0ID0gdGhpcztcbiAgICBzcHJpdGVBc3NldC5yZWdpc3RyeS5sb2FkKGF0bGFzQXNzZXQpO1xufVxuXG4vKipcbiAqIFJlc291cmNlIGhhbmRsZXIgdXNlZCBmb3IgbG9hZGluZyB7QGxpbmsgU3ByaXRlfSByZXNvdXJjZXMuXG4gKlxuICogQGltcGxlbWVudHMge1Jlc291cmNlSGFuZGxlcn1cbiAqIEBjYXRlZ29yeSBHcmFwaGljc1xuICovXG5jbGFzcyBTcHJpdGVIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBUeXBlIG9mIHRoZSByZXNvdXJjZSB0aGUgaGFuZGxlciBoYW5kbGVzLlxuICAgICAqXG4gICAgICogQHR5cGUge3N0cmluZ31cbiAgICAgKi9cbiAgICBoYW5kbGVyVHlwZSA9IFwic3ByaXRlXCI7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgU3ByaXRlSGFuZGxlciBpbnN0YW5jZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuLi9hcHAtYmFzZS5qcycpLkFwcEJhc2V9IGFwcCAtIFRoZSBydW5uaW5nIHtAbGluayBBcHBCYXNlfS5cbiAgICAgKiBAaGlkZWNvbnN0cnVjdG9yXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXBwKSB7XG4gICAgICAgIHRoaXMuX2Fzc2V0cyA9IGFwcC5hc3NldHM7XG4gICAgICAgIHRoaXMuX2RldmljZSA9IGFwcC5ncmFwaGljc0RldmljZTtcbiAgICAgICAgdGhpcy5tYXhSZXRyaWVzID0gMDtcbiAgICB9XG5cbiAgICBsb2FkKHVybCwgY2FsbGJhY2spIHtcbiAgICAgICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB1cmwgPSB7XG4gICAgICAgICAgICAgICAgbG9hZDogdXJsLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICAvLyBpZiBnaXZlbiBhIGpzb24gZmlsZSAocHJvYmFibHkgZW5naW5lLW9ubHkgdXNlIGNhc2UpXG4gICAgICAgIGlmIChwYXRoLmdldEV4dGVuc2lvbih1cmwub3JpZ2luYWwpID09PSAnLmpzb24nKSB7XG4gICAgICAgICAgICBodHRwLmdldCh1cmwubG9hZCwge1xuICAgICAgICAgICAgICAgIHJldHJ5OiB0aGlzLm1heFJldHJpZXMgPiAwLFxuICAgICAgICAgICAgICAgIG1heFJldHJpZXM6IHRoaXMubWF4UmV0cmllc1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVyciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWVycikge1xuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBzcHJpdGUgcmVzb3VyY2VcbiAgICBvcGVuKHVybCwgZGF0YSkge1xuICAgICAgICBjb25zdCBzcHJpdGUgPSBuZXcgU3ByaXRlKHRoaXMuX2RldmljZSk7XG4gICAgICAgIGlmICh1cmwpIHtcbiAgICAgICAgICAgIC8vIGlmIHVybCBmaWVsZCBpcyBwcmVzZW50IGpzb24gZGF0YSBpcyBiZWluZyBsb2FkZWQgZnJvbSBmaWxlXG4gICAgICAgICAgICAvLyBzdG9yZSBkYXRhIG9uIHNwcml0ZSBvYmplY3QgdGVtcG9yYXJpbHlcbiAgICAgICAgICAgIHNwcml0ZS5fX2RhdGEgPSBkYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNwcml0ZTtcbiAgICB9XG5cbiAgICAvLyBTZXQgc3ByaXRlIGRhdGFcbiAgICBwYXRjaChhc3NldCwgYXNzZXRzKSB7XG4gICAgICAgIGNvbnN0IHNwcml0ZSA9IGFzc2V0LnJlc291cmNlO1xuICAgICAgICBpZiAoc3ByaXRlLl9fZGF0YSkge1xuICAgICAgICAgICAgLy8gbG9hZGluZyBmcm9tIGEganNvbiBmaWxlIHdlIGhhdmUgYXNzZXQgZGF0YSBzdG9yZSB0ZW1wb3JhcmlseSBvbiB0aGUgc3ByaXRlIHJlc291cmNlXG4gICAgICAgICAgICAvLyBjb3B5IGl0IGludG8gYXNzZXQuZGF0YSBhbmQgZGVsZXRlXG5cbiAgICAgICAgICAgIGFzc2V0LmRhdGEucGl4ZWxzUGVyVW5pdCA9IHNwcml0ZS5fX2RhdGEucGl4ZWxzUGVyVW5pdDtcbiAgICAgICAgICAgIGFzc2V0LmRhdGEucmVuZGVyTW9kZSA9IHNwcml0ZS5fX2RhdGEucmVuZGVyTW9kZTtcbiAgICAgICAgICAgIGFzc2V0LmRhdGEuZnJhbWVLZXlzID0gc3ByaXRlLl9fZGF0YS5mcmFtZUtleXM7XG5cbiAgICAgICAgICAgIGlmIChzcHJpdGUuX19kYXRhLnRleHR1cmVBdGxhc0Fzc2V0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXRsYXMgPSBhc3NldHMuZ2V0QnlVcmwoc3ByaXRlLl9fZGF0YS50ZXh0dXJlQXRsYXNBc3NldCk7XG4gICAgICAgICAgICAgICAgaWYgKGF0bGFzKSB7XG4gICAgICAgICAgICAgICAgICAgIGFzc2V0LmRhdGEudGV4dHVyZUF0bGFzQXNzZXQgPSBhdGxhcy5pZDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBmaW5kIHRleHR1cmVhdGxhcyB3aXRoIHVybDogJyArIHNwcml0ZS5fX2RhdGEudGV4dHVyZUF0bGFzQXNzZXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbm90ZTogd2UgZG9uJ3QgcmVtb3ZlIHNwcml0ZS5fX2RhdGEgaW4gY2FzZSBhbm90aGVyIGFzc2V0IGlzIGxvYWRlZCBmcm9tIHRoZSBzYW1lIFVSTCB3aGVuIGl0IGlzIGZldGNoZWQgZnJvbSB0aGUgY2FjaGVcbiAgICAgICAgICAgIC8vIHRoZSBfX2RhdGEgaXMgbm90IHJlLWFzc2lnbmVkIGFuZCBzbyBhc3NldC5kYXRhIGlzIG5vdCBzZXQgdXAuXG4gICAgICAgIH1cblxuICAgICAgICBzcHJpdGUuc3RhcnRVcGRhdGUoKTtcbiAgICAgICAgc3ByaXRlLnJlbmRlck1vZGUgPSBhc3NldC5kYXRhLnJlbmRlck1vZGU7XG4gICAgICAgIHNwcml0ZS5waXhlbHNQZXJVbml0ID0gYXNzZXQuZGF0YS5waXhlbHNQZXJVbml0O1xuICAgICAgICBzcHJpdGUuZnJhbWVLZXlzID0gYXNzZXQuZGF0YS5mcmFtZUtleXM7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUF0bGFzKGFzc2V0KTtcbiAgICAgICAgc3ByaXRlLmVuZFVwZGF0ZSgpO1xuXG4gICAgICAgIGFzc2V0Lm9mZignY2hhbmdlJywgdGhpcy5fb25Bc3NldENoYW5nZSwgdGhpcyk7XG4gICAgICAgIGFzc2V0Lm9uKCdjaGFuZ2UnLCB0aGlzLl9vbkFzc2V0Q2hhbmdlLCB0aGlzKTtcbiAgICB9XG5cbiAgICAvLyBMb2FkIGF0bGFzXG4gICAgX3VwZGF0ZUF0bGFzKGFzc2V0KSB7XG4gICAgICAgIGNvbnN0IHNwcml0ZSA9IGFzc2V0LnJlc291cmNlO1xuICAgICAgICBpZiAoIWFzc2V0LmRhdGEudGV4dHVyZUF0bGFzQXNzZXQpIHtcbiAgICAgICAgICAgIHNwcml0ZS5hdGxhcyA9IG51bGw7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9hc3NldHMub2ZmKCdsb2FkOicgKyBhc3NldC5kYXRhLnRleHR1cmVBdGxhc0Fzc2V0LCBvblRleHR1cmVBdGxhc0xvYWRlZCwgYXNzZXQpO1xuICAgICAgICB0aGlzLl9hc3NldHMub24oJ2xvYWQ6JyArIGFzc2V0LmRhdGEudGV4dHVyZUF0bGFzQXNzZXQsIG9uVGV4dHVyZUF0bGFzTG9hZGVkLCBhc3NldCk7XG5cbiAgICAgICAgY29uc3QgYXRsYXNBc3NldCA9IHRoaXMuX2Fzc2V0cy5nZXQoYXNzZXQuZGF0YS50ZXh0dXJlQXRsYXNBc3NldCk7XG4gICAgICAgIGlmIChhdGxhc0Fzc2V0ICYmIGF0bGFzQXNzZXQucmVzb3VyY2UpIHtcbiAgICAgICAgICAgIHNwcml0ZS5hdGxhcyA9IGF0bGFzQXNzZXQucmVzb3VyY2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoIWF0bGFzQXNzZXQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hc3NldHMub2ZmKCdhZGQ6JyArIGFzc2V0LmRhdGEudGV4dHVyZUF0bGFzQXNzZXQsIG9uVGV4dHVyZUF0bGFzQWRkZWQsIGFzc2V0KTtcbiAgICAgICAgICAgICAgICB0aGlzLl9hc3NldHMub24oJ2FkZDonICsgYXNzZXQuZGF0YS50ZXh0dXJlQXRsYXNBc3NldCwgb25UZXh0dXJlQXRsYXNBZGRlZCwgYXNzZXQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hc3NldHMubG9hZChhdGxhc0Fzc2V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIF9vbkFzc2V0Q2hhbmdlKGFzc2V0LCBhdHRyaWJ1dGUsIHZhbHVlLCBvbGRWYWx1ZSkge1xuICAgICAgICBpZiAoYXR0cmlidXRlID09PSAnZGF0YScpIHtcbiAgICAgICAgICAgIC8vIGlmIHRoZSB0ZXh0dXJlIGF0bGFzIGNoYW5nZWQsIGNsZWFyIGV2ZW50cyBmb3Igb2xkIGF0bGFzIGFzc2V0XG4gICAgICAgICAgICBpZiAodmFsdWUgJiYgdmFsdWUudGV4dHVyZUF0bGFzQXNzZXQgJiYgb2xkVmFsdWUgJiYgdmFsdWUudGV4dHVyZUF0bGFzQXNzZXQgIT09IG9sZFZhbHVlLnRleHR1cmVBdGxhc0Fzc2V0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXRzLm9mZignbG9hZDonICsgb2xkVmFsdWUudGV4dHVyZUF0bGFzQXNzZXQsIG9uVGV4dHVyZUF0bGFzTG9hZGVkLCBhc3NldCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fYXNzZXRzLm9mZignYWRkOicgKyBvbGRWYWx1ZS50ZXh0dXJlQXRsYXNBc3NldCwgb25UZXh0dXJlQXRsYXNBZGRlZCwgYXNzZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBTcHJpdGVIYW5kbGVyIH07XG4iXSwibmFtZXMiOlsib25UZXh0dXJlQXRsYXNMb2FkZWQiLCJhdGxhc0Fzc2V0Iiwic3ByaXRlQXNzZXQiLCJyZXNvdXJjZSIsImF0bGFzIiwib25UZXh0dXJlQXRsYXNBZGRlZCIsInJlZ2lzdHJ5IiwibG9hZCIsIlNwcml0ZUhhbmRsZXIiLCJjb25zdHJ1Y3RvciIsImFwcCIsImhhbmRsZXJUeXBlIiwiX2Fzc2V0cyIsImFzc2V0cyIsIl9kZXZpY2UiLCJncmFwaGljc0RldmljZSIsIm1heFJldHJpZXMiLCJ1cmwiLCJjYWxsYmFjayIsIm9yaWdpbmFsIiwicGF0aCIsImdldEV4dGVuc2lvbiIsImh0dHAiLCJnZXQiLCJyZXRyeSIsImVyciIsInJlc3BvbnNlIiwib3BlbiIsImRhdGEiLCJzcHJpdGUiLCJTcHJpdGUiLCJfX2RhdGEiLCJwYXRjaCIsImFzc2V0IiwicGl4ZWxzUGVyVW5pdCIsInJlbmRlck1vZGUiLCJmcmFtZUtleXMiLCJ0ZXh0dXJlQXRsYXNBc3NldCIsImdldEJ5VXJsIiwiaWQiLCJjb25zb2xlIiwid2FybiIsInN0YXJ0VXBkYXRlIiwiX3VwZGF0ZUF0bGFzIiwiZW5kVXBkYXRlIiwib2ZmIiwiX29uQXNzZXRDaGFuZ2UiLCJvbiIsImF0dHJpYnV0ZSIsInZhbHVlIiwib2xkVmFsdWUiXSwibWFwcGluZ3MiOiI7Ozs7QUFNQTs7QUFFQTtBQUNBLFNBQVNBLG9CQUFvQkEsQ0FBQ0MsVUFBVSxFQUFFO0VBQ3RDLE1BQU1DLFdBQVcsR0FBRyxJQUFJLENBQUE7RUFDeEIsSUFBSUEsV0FBVyxDQUFDQyxRQUFRLEVBQUU7QUFDdEJELElBQUFBLFdBQVcsQ0FBQ0MsUUFBUSxDQUFDQyxLQUFLLEdBQUdILFVBQVUsQ0FBQ0UsUUFBUSxDQUFBO0FBQ3BELEdBQUE7QUFDSixDQUFBOztBQUVBO0FBQ0EsU0FBU0UsbUJBQW1CQSxDQUFDSixVQUFVLEVBQUU7RUFDckMsTUFBTUMsV0FBVyxHQUFHLElBQUksQ0FBQTtBQUN4QkEsRUFBQUEsV0FBVyxDQUFDSSxRQUFRLENBQUNDLElBQUksQ0FBQ04sVUFBVSxDQUFDLENBQUE7QUFDekMsQ0FBQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNTyxhQUFhLENB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
