import { path } from '../../core/path.js';
import { Vec2 } from '../../core/math/vec2.js';
import { Vec4 } from '../../core/math/vec4.js';
import { TEXTURETYPE_RGBM, TEXTURETYPE_DEFAULT, ADDRESS_REPEAT, ADDRESS_CLAMP_TO_EDGE, ADDRESS_MIRRORED_REPEAT, FILTER_NEAREST, FILTER_LINEAR, FILTER_NEAREST_MIPMAP_NEAREST, FILTER_LINEAR_MIPMAP_NEAREST, FILTER_NEAREST_MIPMAP_LINEAR, FILTER_LINEAR_MIPMAP_LINEAR } from '../../platform/graphics/constants.js';
import { http } from '../../platform/net/http.js';
import { TextureAtlas } from '../../scene/texture-atlas.js';

/** @typedef {import('./handler.js').ResourceHandler} ResourceHandler */

const JSON_ADDRESS_MODE = {
  'repeat': ADDRESS_REPEAT,
  'clamp': ADDRESS_CLAMP_TO_EDGE,
  'mirror': ADDRESS_MIRRORED_REPEAT
};
const JSON_FILTER_MODE = {
  'nearest': FILTER_NEAREST,
  'linear': FILTER_LINEAR,
  'nearest_mip_nearest': FILTER_NEAREST_MIPMAP_NEAREST,
  'linear_mip_nearest': FILTER_LINEAR_MIPMAP_NEAREST,
  'nearest_mip_linear': FILTER_NEAREST_MIPMAP_LINEAR,
  'linear_mip_linear': FILTER_LINEAR_MIPMAP_LINEAR
};
const regexFrame = /^data\.frames\.(\d+)$/;

/**
 * Resource handler used for loading {@link TextureAtlas} resources.
 *
 * @implements {ResourceHandler}
 * @category Graphics
 */
class TextureAtlasHandler {
  /**
   * Create a new TextureAtlasHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @hideconstructor
   */
  constructor(app) {
    /**
     * Type of the resource the handler handles.
     *
     * @type {string}
     */
    this.handlerType = "textureatlas";
    this._loader = app.loader;
    this.maxRetries = 0;
  }

  // Load the texture atlas texture using the texture resource loader
  load(url, callback) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    const self = this;
    const handler = this._loader.getHandler('texture');

    // if supplied with a json file url (probably engine-only)
    // load json data then load texture of same name
    if (path.getExtension(url.original) === '.json') {
      http.get(url.load, {
        retry: this.maxRetries > 0,
        maxRetries: this.maxRetries
      }, function (err, response) {
        if (!err) {
          // load texture
          const textureUrl = url.original.replace('.json', '.png');
          self._loader.load(textureUrl, 'texture', function (err, texture) {
            if (err) {
              callback(err);
            } else {
              callback(null, {
                data: response,
                texture: texture
              });
            }
          });
        } else {
          callback(err);
        }
      });
    } else {
      handler.load(url, callback);
    }
  }

  // Create texture atlas resource using the texture from the texture loader
  open(url, data) {
    const resource = new TextureAtlas();
    if (data.texture && data.data) {
      resource.texture = data.texture;
      resource.__data = data.data; // store data temporarily to be copied into asset
    } else {
      const handler = this._loader.getHandler('texture');
      const texture = handler.open(url, data);
      if (!texture) return null;
      resource.texture = texture;
    }
    return resource;
  }
  patch(asset, assets) {
    // during editor update the underlying texture is temporarily null. just return in that case.
    if (!asset.resource) {
      return;
    }
    if (asset.resource.__data) {
      // engine-only, so copy temporary asset data from texture atlas into asset and delete temp property
      if (asset.resource.__data.minfilter !== undefined) asset.data.minfilter = asset.resource.__data.minfilter;
      if (asset.resource.__data.magfilter !== undefined) asset.data.magfilter = asset.resource.__data.magfilter;
      if (asset.resource.__data.addressu !== undefined) asset.data.addressu = asset.resource.__data.addressu;
      if (asset.resource.__data.addressv !== undefined) asset.data.addressv = asset.resource.__data.addressv;
      if (asset.resource.__data.mipmaps !== undefined) asset.data.mipmaps = asset.resource.__data.mipmaps;
      if (asset.resource.__data.anisotropy !== undefined) asset.data.anisotropy = asset.resource.__data.anisotropy;
      if (asset.resource.__data.rgbm !== undefined) asset.data.rgbm = !!asset.resource.__data.rgbm;
      asset.data.frames = asset.resource.__data.frames;
      delete asset.resource.__data;
    }

    // pass texture data
    const texture = asset.resource.texture;
    if (texture) {
      texture.name = asset.name;
      if (asset.data.hasOwnProperty('minfilter') && texture.minFilter !== JSON_FILTER_MODE[asset.data.minfilter]) texture.minFilter = JSON_FILTER_MODE[asset.data.minfilter];
      if (asset.data.hasOwnProperty('magfilter') && texture.magFilter !== JSON_FILTER_MODE[asset.data.magfilter]) texture.magFilter = JSON_FILTER_MODE[asset.data.magfilter];
      if (asset.data.hasOwnProperty('addressu') && texture.addressU !== JSON_ADDRESS_MODE[asset.data.addressu]) texture.addressU = JSON_ADDRESS_MODE[asset.data.addressu];
      if (asset.data.hasOwnProperty('addressv') && texture.addressV !== JSON_ADDRESS_MODE[asset.data.addressv]) texture.addressV = JSON_ADDRESS_MODE[asset.data.addressv];
      if (asset.data.hasOwnProperty('mipmaps') && texture.mipmaps !== asset.data.mipmaps) texture.mipmaps = asset.data.mipmaps;
      if (asset.data.hasOwnProperty('anisotropy') && texture.anisotropy !== asset.data.anisotropy) texture.anisotropy = asset.data.anisotropy;
      if (asset.data.hasOwnProperty('rgbm')) {
        const type = asset.data.rgbm ? TEXTURETYPE_RGBM : TEXTURETYPE_DEFAULT;
        if (texture.type !== type) {
          texture.type = type;
        }
      }
    }
    asset.resource.texture = texture;

    // set frames
    const frames = {};
    for (const key in asset.data.frames) {
      const frame = asset.data.frames[key];
      frames[key] = {
        rect: new Vec4(frame.rect),
        pivot: new Vec2(frame.pivot),
        border: new Vec4(frame.border)
      };
    }
    asset.resource.frames = frames;
    asset.off('change', this._onAssetChange, this);
    asset.on('change', this._onAssetChange, this);
  }
  _onAssetChange(asset, attribute, value) {
    let frame;
    if (attribute === 'data' || attribute === 'data.frames') {
      // set frames
      const frames = {};
      for (const key in value.frames) {
        frame = value.frames[key];
        frames[key] = {
          rect: new Vec4(frame.rect),
          pivot: new Vec2(frame.pivot),
          border: new Vec4(frame.border)
        };
      }
      asset.resource.frames = frames;
    } else {
      const match = attribute.match(regexFrame);
      if (match) {
        const frameKey = match[1];
        if (value) {
          // add or update frame
          if (!asset.resource.frames[frameKey]) {
            asset.resource.frames[frameKey] = {
              rect: new Vec4(value.rect),
              pivot: new Vec2(value.pivot),
              border: new Vec4(value.border)
            };
          } else {
            frame = asset.resource.frames[frameKey];
            frame.rect.set(value.rect[0], value.rect[1], value.rect[2], value.rect[3]);
            frame.pivot.set(value.pivot[0], value.pivot[1]);
            frame.border.set(value.border[0], value.border[1], value.border[2], value.border[3]);
          }
          asset.resource.fire('set:frame', frameKey, asset.resource.frames[frameKey]);
        } else {
          // delete frame
          if (asset.resource.frames[frameKey]) {
            delete asset.resource.frames[frameKey];
            asset.resource.fire('remove:frame', frameKey);
          }
        }
      }
    }
  }
}

export { TextureAtlasHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV4dHVyZS1hdGxhcy5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9oYW5kbGVycy90ZXh0dXJlLWF0bGFzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhdGggfSBmcm9tICcuLi8uLi9jb3JlL3BhdGguanMnO1xuaW1wb3J0IHsgVmVjMiB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC92ZWMyLmpzJztcbmltcG9ydCB7IFZlYzQgfSBmcm9tICcuLi8uLi9jb3JlL21hdGgvdmVjNC5qcyc7XG5cbmltcG9ydCB7XG4gICAgQUREUkVTU19DTEFNUF9UT19FREdFLCBBRERSRVNTX01JUlJPUkVEX1JFUEVBVCwgQUREUkVTU19SRVBFQVQsXG4gICAgRklMVEVSX0xJTkVBUiwgRklMVEVSX05FQVJFU1QsIEZJTFRFUl9ORUFSRVNUX01JUE1BUF9ORUFSRVNULCBGSUxURVJfTkVBUkVTVF9NSVBNQVBfTElORUFSLCBGSUxURVJfTElORUFSX01JUE1BUF9ORUFSRVNULCBGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIsXG4gICAgVEVYVFVSRVRZUEVfREVGQVVMVCwgVEVYVFVSRVRZUEVfUkdCTVxufSBmcm9tICcuLi8uLi9wbGF0Zm9ybS9ncmFwaGljcy9jb25zdGFudHMuanMnO1xuaW1wb3J0IHsgaHR0cCB9IGZyb20gJy4uLy4uL3BsYXRmb3JtL25ldC9odHRwLmpzJztcblxuaW1wb3J0IHsgVGV4dHVyZUF0bGFzIH0gZnJvbSAnLi4vLi4vc2NlbmUvdGV4dHVyZS1hdGxhcy5qcyc7XG5cbi8qKiBAdHlwZWRlZiB7aW1wb3J0KCcuL2hhbmRsZXIuanMnKS5SZXNvdXJjZUhhbmRsZXJ9IFJlc291cmNlSGFuZGxlciAqL1xuXG5jb25zdCBKU09OX0FERFJFU1NfTU9ERSA9IHtcbiAgICAncmVwZWF0JzogQUREUkVTU19SRVBFQVQsXG4gICAgJ2NsYW1wJzogQUREUkVTU19DTEFNUF9UT19FREdFLFxuICAgICdtaXJyb3InOiBBRERSRVNTX01JUlJPUkVEX1JFUEVBVFxufTtcblxuY29uc3QgSlNPTl9GSUxURVJfTU9ERSA9IHtcbiAgICAnbmVhcmVzdCc6IEZJTFRFUl9ORUFSRVNULFxuICAgICdsaW5lYXInOiBGSUxURVJfTElORUFSLFxuICAgICduZWFyZXN0X21pcF9uZWFyZXN0JzogRklMVEVSX05FQVJFU1RfTUlQTUFQX05FQVJFU1QsXG4gICAgJ2xpbmVhcl9taXBfbmVhcmVzdCc6IEZJTFRFUl9MSU5FQVJfTUlQTUFQX05FQVJFU1QsXG4gICAgJ25lYXJlc3RfbWlwX2xpbmVhcic6IEZJTFRFUl9ORUFSRVNUX01JUE1BUF9MSU5FQVIsXG4gICAgJ2xpbmVhcl9taXBfbGluZWFyJzogRklMVEVSX0xJTkVBUl9NSVBNQVBfTElORUFSXG59O1xuXG5jb25zdCByZWdleEZyYW1lID0gL15kYXRhXFwuZnJhbWVzXFwuKFxcZCspJC87XG5cbi8qKlxuICogUmVzb3VyY2UgaGFuZGxlciB1c2VkIGZvciBsb2FkaW5nIHtAbGluayBUZXh0dXJlQXRsYXN9IHJlc291cmNlcy5cbiAqXG4gKiBAaW1wbGVtZW50cyB7UmVzb3VyY2VIYW5kbGVyfVxuICogQGNhdGVnb3J5IEdyYXBoaWNzXG4gKi9cbmNsYXNzIFRleHR1cmVBdGxhc0hhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIFR5cGUgb2YgdGhlIHJlc291cmNlIHRoZSBoYW5kbGVyIGhhbmRsZXMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIGhhbmRsZXJUeXBlID0gXCJ0ZXh0dXJlYXRsYXNcIjtcblxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBUZXh0dXJlQXRsYXNIYW5kbGVyIGluc3RhbmNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtpbXBvcnQoJy4uL2FwcC1iYXNlLmpzJykuQXBwQmFzZX0gYXBwIC0gVGhlIHJ1bm5pbmcge0BsaW5rIEFwcEJhc2V9LlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihhcHApIHtcbiAgICAgICAgdGhpcy5fbG9hZGVyID0gYXBwLmxvYWRlcjtcbiAgICAgICAgdGhpcy5tYXhSZXRyaWVzID0gMDtcbiAgICB9XG5cbiAgICAvLyBMb2FkIHRoZSB0ZXh0dXJlIGF0bGFzIHRleHR1cmUgdXNpbmcgdGhlIHRleHR1cmUgcmVzb3VyY2UgbG9hZGVyXG4gICAgbG9hZCh1cmwsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgdXJsID0ge1xuICAgICAgICAgICAgICAgIGxvYWQ6IHVybCxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbDogdXJsXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIGNvbnN0IGhhbmRsZXIgPSB0aGlzLl9sb2FkZXIuZ2V0SGFuZGxlcigndGV4dHVyZScpO1xuXG4gICAgICAgIC8vIGlmIHN1cHBsaWVkIHdpdGggYSBqc29uIGZpbGUgdXJsIChwcm9iYWJseSBlbmdpbmUtb25seSlcbiAgICAgICAgLy8gbG9hZCBqc29uIGRhdGEgdGhlbiBsb2FkIHRleHR1cmUgb2Ygc2FtZSBuYW1lXG4gICAgICAgIGlmIChwYXRoLmdldEV4dGVuc2lvbih1cmwub3JpZ2luYWwpID09PSAnLmpzb24nKSB7XG4gICAgICAgICAgICBodHRwLmdldCh1cmwubG9hZCwge1xuICAgICAgICAgICAgICAgIHJldHJ5OiB0aGlzLm1heFJldHJpZXMgPiAwLFxuICAgICAgICAgICAgICAgIG1heFJldHJpZXM6IHRoaXMubWF4UmV0cmllc1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVyciwgcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIWVycikge1xuICAgICAgICAgICAgICAgICAgICAvLyBsb2FkIHRleHR1cmVcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dHVyZVVybCA9IHVybC5vcmlnaW5hbC5yZXBsYWNlKCcuanNvbicsICcucG5nJyk7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYuX2xvYWRlci5sb2FkKHRleHR1cmVVcmwsICd0ZXh0dXJlJywgZnVuY3Rpb24gKGVyciwgdGV4dHVyZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHR1cmU6IHRleHR1cmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGhhbmRsZXIubG9hZCh1cmwsIGNhbGxiYWNrKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSB0ZXh0dXJlIGF0bGFzIHJlc291cmNlIHVzaW5nIHRoZSB0ZXh0dXJlIGZyb20gdGhlIHRleHR1cmUgbG9hZGVyXG4gICAgb3Blbih1cmwsIGRhdGEpIHtcbiAgICAgICAgY29uc3QgcmVzb3VyY2UgPSBuZXcgVGV4dHVyZUF0bGFzKCk7XG4gICAgICAgIGlmIChkYXRhLnRleHR1cmUgJiYgZGF0YS5kYXRhKSB7XG4gICAgICAgICAgICByZXNvdXJjZS50ZXh0dXJlID0gZGF0YS50ZXh0dXJlO1xuICAgICAgICAgICAgcmVzb3VyY2UuX19kYXRhID0gZGF0YS5kYXRhOyAvLyBzdG9yZSBkYXRhIHRlbXBvcmFyaWx5IHRvIGJlIGNvcGllZCBpbnRvIGFzc2V0XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBoYW5kbGVyID0gdGhpcy5fbG9hZGVyLmdldEhhbmRsZXIoJ3RleHR1cmUnKTtcbiAgICAgICAgICAgIGNvbnN0IHRleHR1cmUgPSBoYW5kbGVyLm9wZW4odXJsLCBkYXRhKTtcbiAgICAgICAgICAgIGlmICghdGV4dHVyZSkgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICByZXNvdXJjZS50ZXh0dXJlID0gdGV4dHVyZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzb3VyY2U7XG4gICAgfVxuXG4gICAgcGF0Y2goYXNzZXQsIGFzc2V0cykge1xuICAgICAgICAvLyBkdXJpbmcgZWRpdG9yIHVwZGF0ZSB0aGUgdW5kZXJseWluZyB0ZXh0dXJlIGlzIHRlbXBvcmFyaWx5IG51bGwuIGp1c3QgcmV0dXJuIGluIHRoYXQgY2FzZS5cbiAgICAgICAgaWYgKCFhc3NldC5yZXNvdXJjZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGFzc2V0LnJlc291cmNlLl9fZGF0YSkge1xuICAgICAgICAgICAgLy8gZW5naW5lLW9ubHksIHNvIGNvcHkgdGVtcG9yYXJ5IGFzc2V0IGRhdGEgZnJvbSB0ZXh0dXJlIGF0bGFzIGludG8gYXNzZXQgYW5kIGRlbGV0ZSB0ZW1wIHByb3BlcnR5XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLm1pbmZpbHRlciAhPT0gdW5kZWZpbmVkKSBhc3NldC5kYXRhLm1pbmZpbHRlciA9IGFzc2V0LnJlc291cmNlLl9fZGF0YS5taW5maWx0ZXI7XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLm1hZ2ZpbHRlciAhPT0gdW5kZWZpbmVkKSBhc3NldC5kYXRhLm1hZ2ZpbHRlciA9IGFzc2V0LnJlc291cmNlLl9fZGF0YS5tYWdmaWx0ZXI7XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLmFkZHJlc3N1ICE9PSB1bmRlZmluZWQpIGFzc2V0LmRhdGEuYWRkcmVzc3UgPSBhc3NldC5yZXNvdXJjZS5fX2RhdGEuYWRkcmVzc3U7XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLmFkZHJlc3N2ICE9PSB1bmRlZmluZWQpIGFzc2V0LmRhdGEuYWRkcmVzc3YgPSBhc3NldC5yZXNvdXJjZS5fX2RhdGEuYWRkcmVzc3Y7XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLm1pcG1hcHMgIT09IHVuZGVmaW5lZCkgYXNzZXQuZGF0YS5taXBtYXBzID0gYXNzZXQucmVzb3VyY2UuX19kYXRhLm1pcG1hcHM7XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCkgYXNzZXQuZGF0YS5hbmlzb3Ryb3B5ID0gYXNzZXQucmVzb3VyY2UuX19kYXRhLmFuaXNvdHJvcHk7XG4gICAgICAgICAgICBpZiAoYXNzZXQucmVzb3VyY2UuX19kYXRhLnJnYm0gIT09IHVuZGVmaW5lZCkgYXNzZXQuZGF0YS5yZ2JtID0gISFhc3NldC5yZXNvdXJjZS5fX2RhdGEucmdibTtcblxuICAgICAgICAgICAgYXNzZXQuZGF0YS5mcmFtZXMgPSBhc3NldC5yZXNvdXJjZS5fX2RhdGEuZnJhbWVzO1xuXG4gICAgICAgICAgICBkZWxldGUgYXNzZXQucmVzb3VyY2UuX19kYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gcGFzcyB0ZXh0dXJlIGRhdGFcbiAgICAgICAgY29uc3QgdGV4dHVyZSA9IGFzc2V0LnJlc291cmNlLnRleHR1cmU7XG4gICAgICAgIGlmICh0ZXh0dXJlKSB7XG4gICAgICAgICAgICB0ZXh0dXJlLm5hbWUgPSBhc3NldC5uYW1lO1xuXG4gICAgICAgICAgICBpZiAoYXNzZXQuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnbWluZmlsdGVyJykgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IEpTT05fRklMVEVSX01PREVbYXNzZXQuZGF0YS5taW5maWx0ZXJdKVxuICAgICAgICAgICAgICAgIHRleHR1cmUubWluRmlsdGVyID0gSlNPTl9GSUxURVJfTU9ERVthc3NldC5kYXRhLm1pbmZpbHRlcl07XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5kYXRhLmhhc093blByb3BlcnR5KCdtYWdmaWx0ZXInKSAmJiB0ZXh0dXJlLm1hZ0ZpbHRlciAhPT0gSlNPTl9GSUxURVJfTU9ERVthc3NldC5kYXRhLm1hZ2ZpbHRlcl0pXG4gICAgICAgICAgICAgICAgdGV4dHVyZS5tYWdGaWx0ZXIgPSBKU09OX0ZJTFRFUl9NT0RFW2Fzc2V0LmRhdGEubWFnZmlsdGVyXTtcblxuICAgICAgICAgICAgaWYgKGFzc2V0LmRhdGEuaGFzT3duUHJvcGVydHkoJ2FkZHJlc3N1JykgJiYgdGV4dHVyZS5hZGRyZXNzVSAhPT0gSlNPTl9BRERSRVNTX01PREVbYXNzZXQuZGF0YS5hZGRyZXNzdV0pXG4gICAgICAgICAgICAgICAgdGV4dHVyZS5hZGRyZXNzVSA9IEpTT05fQUREUkVTU19NT0RFW2Fzc2V0LmRhdGEuYWRkcmVzc3VdO1xuXG4gICAgICAgICAgICBpZiAoYXNzZXQuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnYWRkcmVzc3YnKSAmJiB0ZXh0dXJlLmFkZHJlc3NWICE9PSBKU09OX0FERFJFU1NfTU9ERVthc3NldC5kYXRhLmFkZHJlc3N2XSlcbiAgICAgICAgICAgICAgICB0ZXh0dXJlLmFkZHJlc3NWID0gSlNPTl9BRERSRVNTX01PREVbYXNzZXQuZGF0YS5hZGRyZXNzdl07XG5cbiAgICAgICAgICAgIGlmIChhc3NldC5kYXRhLmhhc093blByb3BlcnR5KCdtaXBtYXBzJykgJiYgdGV4dHVyZS5taXBtYXBzICE9PSBhc3NldC5kYXRhLm1pcG1hcHMpXG4gICAgICAgICAgICAgICAgdGV4dHVyZS5taXBtYXBzID0gYXNzZXQuZGF0YS5taXBtYXBzO1xuXG4gICAgICAgICAgICBpZiAoYXNzZXQuZGF0YS5oYXNPd25Qcm9wZXJ0eSgnYW5pc290cm9weScpICYmIHRleHR1cmUuYW5pc290cm9weSAhPT0gYXNzZXQuZGF0YS5hbmlzb3Ryb3B5KVxuICAgICAgICAgICAgICAgIHRleHR1cmUuYW5pc290cm9weSA9IGFzc2V0LmRhdGEuYW5pc290cm9weTtcblxuICAgICAgICAgICAgaWYgKGFzc2V0LmRhdGEuaGFzT3duUHJvcGVydHkoJ3JnYm0nKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSBhc3NldC5kYXRhLnJnYm0gPyBURVhUVVJFVFlQRV9SR0JNIDogVEVYVFVSRVRZUEVfREVGQVVMVDtcbiAgICAgICAgICAgICAgICBpZiAodGV4dHVyZS50eXBlICE9PSB0eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRleHR1cmUudHlwZSA9IHR5cGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgYXNzZXQucmVzb3VyY2UudGV4dHVyZSA9IHRleHR1cmU7XG5cbiAgICAgICAgLy8gc2V0IGZyYW1lc1xuICAgICAgICBjb25zdCBmcmFtZXMgPSB7fTtcbiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gYXNzZXQuZGF0YS5mcmFtZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lID0gYXNzZXQuZGF0YS5mcmFtZXNba2V5XTtcbiAgICAgICAgICAgIGZyYW1lc1trZXldID0ge1xuICAgICAgICAgICAgICAgIHJlY3Q6IG5ldyBWZWM0KGZyYW1lLnJlY3QpLFxuICAgICAgICAgICAgICAgIHBpdm90OiBuZXcgVmVjMihmcmFtZS5waXZvdCksXG4gICAgICAgICAgICAgICAgYm9yZGVyOiBuZXcgVmVjNChmcmFtZS5ib3JkZXIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGFzc2V0LnJlc291cmNlLmZyYW1lcyA9IGZyYW1lcztcblxuICAgICAgICBhc3NldC5vZmYoJ2NoYW5nZScsIHRoaXMuX29uQXNzZXRDaGFuZ2UsIHRoaXMpO1xuICAgICAgICBhc3NldC5vbignY2hhbmdlJywgdGhpcy5fb25Bc3NldENoYW5nZSwgdGhpcyk7XG4gICAgfVxuXG4gICAgX29uQXNzZXRDaGFuZ2UoYXNzZXQsIGF0dHJpYnV0ZSwgdmFsdWUpIHtcbiAgICAgICAgbGV0IGZyYW1lO1xuXG4gICAgICAgIGlmIChhdHRyaWJ1dGUgPT09ICdkYXRhJyB8fCBhdHRyaWJ1dGUgPT09ICdkYXRhLmZyYW1lcycpIHtcbiAgICAgICAgICAgIC8vIHNldCBmcmFtZXNcbiAgICAgICAgICAgIGNvbnN0IGZyYW1lcyA9IHt9O1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdmFsdWUuZnJhbWVzKSB7XG4gICAgICAgICAgICAgICAgZnJhbWUgPSB2YWx1ZS5mcmFtZXNba2V5XTtcbiAgICAgICAgICAgICAgICBmcmFtZXNba2V5XSA9IHtcbiAgICAgICAgICAgICAgICAgICAgcmVjdDogbmV3IFZlYzQoZnJhbWUucmVjdCksXG4gICAgICAgICAgICAgICAgICAgIHBpdm90OiBuZXcgVmVjMihmcmFtZS5waXZvdCksXG4gICAgICAgICAgICAgICAgICAgIGJvcmRlcjogbmV3IFZlYzQoZnJhbWUuYm9yZGVyKVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhc3NldC5yZXNvdXJjZS5mcmFtZXMgPSBmcmFtZXM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IGF0dHJpYnV0ZS5tYXRjaChyZWdleEZyYW1lKTtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZyYW1lS2V5ID0gbWF0Y2hbMV07XG5cbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gYWRkIG9yIHVwZGF0ZSBmcmFtZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIWFzc2V0LnJlc291cmNlLmZyYW1lc1tmcmFtZUtleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0LnJlc291cmNlLmZyYW1lc1tmcmFtZUtleV0gPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVjdDogbmV3IFZlYzQodmFsdWUucmVjdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGl2b3Q6IG5ldyBWZWMyKHZhbHVlLnBpdm90KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IG5ldyBWZWM0KHZhbHVlLmJvcmRlcilcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcmFtZSA9IGFzc2V0LnJlc291cmNlLmZyYW1lc1tmcmFtZUtleV07XG4gICAgICAgICAgICAgICAgICAgICAgICBmcmFtZS5yZWN0LnNldCh2YWx1ZS5yZWN0WzBdLCB2YWx1ZS5yZWN0WzFdLCB2YWx1ZS5yZWN0WzJdLCB2YWx1ZS5yZWN0WzNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lLnBpdm90LnNldCh2YWx1ZS5waXZvdFswXSwgdmFsdWUucGl2b3RbMV0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJhbWUuYm9yZGVyLnNldCh2YWx1ZS5ib3JkZXJbMF0sIHZhbHVlLmJvcmRlclsxXSwgdmFsdWUuYm9yZGVyWzJdLCB2YWx1ZS5ib3JkZXJbM10pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgYXNzZXQucmVzb3VyY2UuZmlyZSgnc2V0OmZyYW1lJywgZnJhbWVLZXksIGFzc2V0LnJlc291cmNlLmZyYW1lc1tmcmFtZUtleV0pO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGZyYW1lXG4gICAgICAgICAgICAgICAgICAgIGlmIChhc3NldC5yZXNvdXJjZS5mcmFtZXNbZnJhbWVLZXldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgYXNzZXQucmVzb3VyY2UuZnJhbWVzW2ZyYW1lS2V5XTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFzc2V0LnJlc291cmNlLmZpcmUoJ3JlbW92ZTpmcmFtZScsIGZyYW1lS2V5KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgeyBUZXh0dXJlQXRsYXNIYW5kbGVyIH07XG4iXSwibmFtZXMiOlsiSlNPTl9BRERSRVNTX01PREUiLCJBRERSRVNTX1JFUEVBVCIsIkFERFJFU1NfQ0xBTVBfVE9fRURHRSIsIkFERFJFU1NfTUlSUk9SRURfUkVQRUFUIiwiSlNPTl9GSUxURVJfTU9ERSIsIkZJTFRFUl9ORUFSRVNUIiwiRklMVEVSX0xJTkVBUiIsIkZJTFRFUl9ORUFSRVNUX01JUE1BUF9ORUFSRVNUIiwiRklMVEVSX0xJTkVBUl9NSVBNQVBfTkVBUkVTVCIsIkZJTFRFUl9ORUFSRVNUX01JUE1BUF9MSU5FQVIiLCJGSUxURVJfTElORUFSX01JUE1BUF9MSU5FQVIiLCJyZWdleEZyYW1lIiwiVGV4dHVyZUF0bGFzSGFuZGxlciIsImNvbnN0cnVjdG9yIiwiYXBwIiwiaGFuZGxlclR5cGUiLCJfbG9hZGVyIiwibG9hZGVyIiwibWF4UmV0cmllcyIsImxvYWQiLCJ1cmwiLCJjYWxsYmFjayIsIm9yaWdpbmFsIiwic2VsZiIsImhhbmRsZXIiLCJnZXRIYW5kbGVyIiwicGF0aCIsImdldEV4dGVuc2lvbiIsImh0dHAiLCJnZXQiLCJyZXRyeSIsImVyciIsInJlc3BvbnNlIiwidGV4dHVyZVVybCIsInJlcGxhY2UiLCJ0ZXh0dXJlIiwiZGF0YSIsIm9wZW4iLCJyZXNvdXJjZSIsIlRleHR1cmVBdGxhcyIsIl9fZGF0YSIsInBhdGNoIiwiYXNzZXQiLCJhc3NldHMiLCJtaW5maWx0ZXIiLCJ1bmRlZmluZWQiLCJtYWdmaWx0ZXIiLCJhZGRyZXNzdSIsImFkZHJlc3N2IiwibWlwbWFwcyIsImFuaXNvdHJvcHkiLCJyZ2JtIiwiZnJhbWVzIiwibmFtZSIsImhhc093blByb3BlcnR5IiwibWluRmlsdGVyIiwibWFnRmlsdGVyIiwiYWRkcmVzc1UiLCJhZGRyZXNzViIsInR5cGUiLCJURVhUVVJFVFlQRV9SR0JNIiwiVEVYVFVSRVRZUEVfREVGQVVMVCIsImtleSIsImZyYW1lIiwicmVjdCIsIlZlYzQiLCJwaXZvdCIsIlZlYzIiLCJib3JkZXIiLCJvZmYiLCJfb25Bc3NldENoYW5nZSIsIm9uIiwiYXR0cmlidXRlIiwidmFsdWUiLCJtYXRjaCIsImZyYW1lS2V5Iiwic2V0IiwiZmlyZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQWFBOztBQUVBLE1BQU1BLGlCQUFpQixHQUFHO0FBQ3RCLEVBQUEsUUFBUSxFQUFFQyxjQUFjO0FBQ3hCLEVBQUEsT0FBTyxFQUFFQyxxQkFBcUI7QUFDOUIsRUFBQSxRQUFRLEVBQUVDLHVCQUFBQTtBQUNkLENBQUMsQ0FBQTtBQUVELE1BQU1DLGdCQUFnQixHQUFHO0FBQ3JCLEVBQUEsU0FBUyxFQUFFQyxjQUFjO0FBQ3pCLEVBQUEsUUFBUSxFQUFFQyxhQUFhO0FBQ3ZCLEVBQUEscUJBQXFCLEVBQUVDLDZCQUE2QjtBQUNwRCxFQUFBLG9CQUFvQixFQUFFQyw0QkFBNEI7QUFDbEQsRUFBQSxvQkFBb0IsRUFBRUMsNEJBQTRCO0FBQ2xELEVBQUEsbUJBQW1CLEVBQUVDLDJCQUFBQTtBQUN6QixDQUFDLENBQUE7QUFFRCxNQUFNQyxVQUFVLEdBQUcsdUJBQXVCLENBQUE7O0FBRTFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLG1CQUFtQixDQUFDO0FBUXRCO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtFQUNJQyxXQUFXQSxDQUFDQyxHQUFHLEVBQUU7QUFiakI7QUFDSjtBQUNBO0FBQ0E7QUFDQTtJQUpJLElBS0FDLENBQUFBLFdBQVcsR0FBRyxjQUFjLENBQUE7QUFTeEIsSUFBQSxJQUFJLENBQUNDLE9BQU8sR0FBR0YsR0FBRyxDQUFDRyxNQUFNLENBQUE7SUFDekIsSUFBSSxDQUFDQyxVQUFVLEdBQUcsQ0FBQyxDQUFBO0FBQ3ZCLEdBQUE7O0FBRUE7QUFDQUMsRUFBQUEsSUFBSUEsQ0FBQ0MsR0FBRyxFQUFFQyxRQUFRLEVBQUU7QUFDaEIsSUFBQSxJQUFJLE9BQU9ELEdBQUcsS0FBSyxRQUFRLEVBQUU7QUFDekJBLE1BQUFBLEdBQUcsR0FBRztBQUNGRCxRQUFBQSxJQUFJLEVBQUVDLEdBQUc7QUFDVEUsUUFBQUEsUUFBUSxFQUFFRixHQUFBQTtPQUNiLENBQUE7QUFDTCxLQUFBO0lBRUEsTUFBTUcsSUFBSSxHQUFHLElBQUksQ0FBQTtJQUNqQixNQUFNQyxPQUFPLEdBQUcsSUFBSSxDQUFDUixPQUFPLENBQUNTLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQTs7QUFFbEQ7QUFDQTtJQUNBLElBQUlDLElBQUksQ0FBQ0MsWUFBWSxDQUFDUCxHQUFHLENBQUNFLFFBQVEsQ0FBQyxLQUFLLE9BQU8sRUFBRTtBQUM3Q00sTUFBQUEsSUFBSSxDQUFDQyxHQUFHLENBQUNULEdBQUcsQ0FBQ0QsSUFBSSxFQUFFO0FBQ2ZXLFFBQUFBLEtBQUssRUFBRSxJQUFJLENBQUNaLFVBQVUsR0FBRyxDQUFDO1FBQzFCQSxVQUFVLEVBQUUsSUFBSSxDQUFDQSxVQUFBQTtBQUNyQixPQUFDLEVBQUUsVUFBVWEsR0FBRyxFQUFFQyxRQUFRLEVBQUU7UUFDeEIsSUFBSSxDQUFDRCxHQUFHLEVBQUU7QUFDTjtVQUNBLE1BQU1FLFVBQVUsR0FBR2IsR0FBRyxDQUFDRSxRQUFRLENBQUNZLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUE7QUFDeERYLFVBQUFBLElBQUksQ0FBQ1AsT0FBTyxDQUFDRyxJQUFJLENBQUNjLFVBQVUsRUFBRSxTQUFTLEVBQUUsVUFBVUYsR0FBRyxFQUFFSSxPQUFPLEVBQUU7QUFDN0QsWUFBQSxJQUFJSixHQUFHLEVBQUU7Y0FDTFYsUUFBUSxDQUFDVSxHQUFHLENBQUMsQ0FBQTtBQUNqQixhQUFDLE1BQU07Y0FDSFYsUUFBUSxDQUFDLElBQUksRUFBRTtBQUNYZSxnQkFBQUEsSUFBSSxFQUFFSixRQUFRO0FBQ2RHLGdCQUFBQSxPQUFPLEVBQUVBLE9BQUFBO0FBQ2IsZUFBQyxDQUFDLENBQUE7QUFDTixhQUFBO0FBQ0osV0FBQyxDQUFDLENBQUE7QUFDTixTQUFDLE1BQU07VUFDSGQsUUFBUSxDQUFDVSxHQUFHLENBQUMsQ0FBQTtBQUNqQixTQUFBO0FBQ0osT0FBQyxDQUFDLENBQUE7QUFDTixLQUFDLE1BQU07QUFDSFAsTUFBQUEsT0FBTyxDQUFDTCxJQUFJLENBQUNDLEdBQUcsRUFBRUMsUUFBUSxDQUFDLENBQUE7QUFDL0IsS0FBQTtBQUNKLEdBQUE7O0FBRUE7QUFDQWdCLEVBQUFBLElBQUlBLENBQUNqQixHQUFHLEVBQUVnQixJQUFJLEVBQUU7QUFDWixJQUFBLE1BQU1FLFFBQVEsR0FBRyxJQUFJQyxZQUFZLEVBQUUsQ0FBQTtBQUNuQyxJQUFBLElBQUlILElBQUksQ0FBQ0QsT0FBTyxJQUFJQyxJQUFJLENBQUNBLElBQUksRUFBRTtBQUMzQkUsTUFBQUEsUUFBUSxDQUFDSCxPQUFPLEdBQUdDLElBQUksQ0FBQ0QsT0FBTyxDQUFBO0FBQy9CRyxNQUFBQSxRQUFRLENBQUNFLE1BQU0sR0FBR0osSUFBSSxDQUFDQSxJQUFJLENBQUM7QUFDaEMsS0FBQyxNQUFNO01BQ0gsTUFBTVosT0FBTyxHQUFHLElBQUksQ0FBQ1IsT0FBTyxDQUFDUyxVQUFVLENBQUMsU0FBUyxDQUFDLENBQUE7TUFDbEQsTUFBTVUsT0FBTyxHQUFHWCxPQUFPLENBQUNhLElBQUksQ0FBQ2pCLEdBQUcsRUFBRWdCLElBQUksQ0FBQyxDQUFBO0FBQ3ZDLE1BQUEsSUFBSSxDQUFDRCxPQUFPLEVBQUUsT0FBTyxJQUFJLENBQUE7TUFDekJHLFFBQVEsQ0FBQ0gsT0FBTyxHQUFHQSxPQUFPLENBQUE7QUFDOUIsS0FBQTtBQUNBLElBQUEsT0FBT0csUUFBUSxDQUFBO0FBQ25CLEdBQUE7QUFFQUcsRUFBQUEsS0FBS0EsQ0FBQ0MsS0FBSyxFQUFFQyxNQUFNLEVBQUU7QUFDakI7QUFDQSxJQUFBLElBQUksQ0FBQ0QsS0FBSyxDQUFDSixRQUFRLEVBQUU7QUFDakIsTUFBQSxPQUFBO0FBQ0osS0FBQTtBQUVBLElBQUEsSUFBSUksS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sRUFBRTtBQUN2QjtNQUNBLElBQUlFLEtBQUssQ0FBQ0osUUFBUSxDQUFDRSxNQUFNLENBQUNJLFNBQVMsS0FBS0MsU0FBUyxFQUFFSCxLQUFLLENBQUNOLElBQUksQ0FBQ1EsU0FBUyxHQUFHRixLQUFLLENBQUNKLFFBQVEsQ0FBQ0UsTUFBTSxDQUFDSSxTQUFTLENBQUE7TUFDekcsSUFBSUYsS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQ00sU0FBUyxLQUFLRCxTQUFTLEVBQUVILEtBQUssQ0FBQ04sSUFBSSxDQUFDVSxTQUFTLEdBQUdKLEtBQUssQ0FBQ0osUUFBUSxDQUFDRSxNQUFNLENBQUNNLFNBQVMsQ0FBQTtNQUN6RyxJQUFJSixLQUFLLENBQUNKLFFBQVEsQ0FBQ0UsTUFBTSxDQUFDTyxRQUFRLEtBQUtGLFNBQVMsRUFBRUgsS0FBSyxDQUFDTixJQUFJLENBQUNXLFFBQVEsR0FBR0wsS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQ08sUUFBUSxDQUFBO01BQ3RHLElBQUlMLEtBQUssQ0FBQ0osUUFBUSxDQUFDRSxNQUFNLENBQUNRLFFBQVEsS0FBS0gsU0FBUyxFQUFFSCxLQUFLLENBQUNOLElBQUksQ0FBQ1ksUUFBUSxHQUFHTixLQUFLLENBQUNKLFFBQVEsQ0FBQ0UsTUFBTSxDQUFDUSxRQUFRLENBQUE7TUFDdEcsSUFBSU4sS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQ1MsT0FBTyxLQUFLSixTQUFTLEVBQUVILEtBQUssQ0FBQ04sSUFBSSxDQUFDYSxPQUFPLEdBQUdQLEtBQUssQ0FBQ0osUUFBUSxDQUFDRSxNQUFNLENBQUNTLE9BQU8sQ0FBQTtNQUNuRyxJQUFJUCxLQUFLLENBQUNKLFFBQVEsQ0FBQ0UsTUFBTSxDQUFDVSxVQUFVLEtBQUtMLFNBQVMsRUFBRUgsS0FBSyxDQUFDTixJQUFJLENBQUNjLFVBQVUsR0FBR1IsS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQ1UsVUFBVSxDQUFBO01BQzVHLElBQUlSLEtBQUssQ0FBQ0osUUFBUSxDQUFDRSxNQUFNLENBQUNXLElBQUksS0FBS04sU0FBUyxFQUFFSCxLQUFLLENBQUNOLElBQUksQ0FBQ2UsSUFBSSxHQUFHLENBQUMsQ0FBQ1QsS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQ1csSUFBSSxDQUFBO01BRTVGVCxLQUFLLENBQUNOLElBQUksQ0FBQ2dCLE1BQU0sR0FBR1YsS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQ1ksTUFBTSxDQUFBO0FBRWhELE1BQUEsT0FBT1YsS0FBSyxDQUFDSixRQUFRLENBQUNFLE1BQU0sQ0FBQTtBQUNoQyxLQUFBOztBQUVBO0FBQ0EsSUFBQSxNQUFNTCxPQUFPLEdBQUdPLEtBQUssQ0FBQ0osUUFBUSxDQUFDSCxPQUFPLENBQUE7QUFDdEMsSUFBQSxJQUFJQSxPQUFPLEVBQUU7QUFDVEEsTUFBQUEsT0FBTyxDQUFDa0IsSUFBSSxHQUFHWCxLQUFLLENBQUNXLElBQUksQ0FBQTtBQUV6QixNQUFBLElBQUlYLEtBQUssQ0FBQ04sSUFBSSxDQUFDa0IsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJbkIsT0FBTyxDQUFDb0IsU0FBUyxLQUFLbkQsZ0JBQWdCLENBQUNzQyxLQUFLLENBQUNOLElBQUksQ0FBQ1EsU0FBUyxDQUFDLEVBQ3RHVCxPQUFPLENBQUNvQixTQUFTLEdBQUduRCxnQkFBZ0IsQ0FBQ3NDLEtBQUssQ0FBQ04sSUFBSSxDQUFDUSxTQUFTLENBQUMsQ0FBQTtBQUU5RCxNQUFBLElBQUlGLEtBQUssQ0FBQ04sSUFBSSxDQUFDa0IsY0FBYyxDQUFDLFdBQVcsQ0FBQyxJQUFJbkIsT0FBTyxDQUFDcUIsU0FBUyxLQUFLcEQsZ0JBQWdCLENBQUNzQyxLQUFLLENBQUNOLElBQUksQ0FBQ1UsU0FBUyxDQUFDLEVBQ3RHWCxPQUFPLENBQUNxQixTQUFTLEdBQUdwRCxnQkFBZ0IsQ0FBQ3NDLEtBQUssQ0FBQ04sSUFBSSxDQUFDVSxTQUFTLENBQUMsQ0FBQTtBQUU5RCxNQUFBLElBQUlKLEtBQUssQ0FBQ04sSUFBSSxDQUFDa0IsY0FBYyxDQUFDLFVBQVUsQ0FBQyxJQUFJbkIsT0FBTyxDQUFDc0IsUUFBUSxLQUFLekQsaUJBQWlCLENBQUMwQyxLQUFLLENBQUNOLElBQUksQ0FBQ1csUUFBUSxDQUFDLEVBQ3BHWixPQUFPLENBQUNzQixRQUFRLEdBQUd6RCxpQkFBaUIsQ0FBQzBDLEtBQUssQ0FBQ04sSUFBSSxDQUFDVyxRQUFRLENBQUMsQ0FBQTtBQUU3RCxNQUFBLElBQUlMLEtBQUssQ0FBQ04sSUFBSSxDQUFDa0IsY0FBYyxDQUFDLFVBQVUsQ0FBQyxJQUFJbkIsT0FBTyxDQUFDdUIsUUFBUSxLQUFLMUQsaUJBQWlCLENBQUMwQyxLQUFLLENBQUNOLElBQUksQ0FBQ1ksUUFBUSxDQUFDLEVBQ3BHYixPQUFPLENBQUN1QixRQUFRLEdBQUcxRCxpQkFBaUIsQ0FBQzBDLEtBQUssQ0FBQ04sSUFBSSxDQUFDWSxRQUFRLENBQUMsQ0FBQTtNQUU3RCxJQUFJTixLQUFLLENBQUNOLElBQUksQ0FBQ2tCLGNBQWMsQ0FBQyxTQUFTLENBQUMsSUFBSW5CLE9BQU8sQ0FBQ2MsT0FBTyxLQUFLUCxLQUFLLENBQUNOLElBQUksQ0FBQ2EsT0FBTyxFQUM5RWQsT0FBTyxDQUFDYyxPQUFPLEdBQUdQLEtBQUssQ0FBQ04sSUFBSSxDQUFDYSxPQUFPLENBQUE7TUFFeEMsSUFBSVAsS0FBSyxDQUFDTixJQUFJLENBQUNrQixjQUFjLENBQUMsWUFBWSxDQUFDLElBQUluQixPQUFPLENBQUNlLFVBQVUsS0FBS1IsS0FBSyxDQUFDTixJQUFJLENBQUNjLFVBQVUsRUFDdkZmLE9BQU8sQ0FBQ2UsVUFBVSxHQUFHUixLQUFLLENBQUNOLElBQUksQ0FBQ2MsVUFBVSxDQUFBO01BRTlDLElBQUlSLEtBQUssQ0FBQ04sSUFBSSxDQUFDa0IsY0FBYyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ25DLE1BQU1LLElBQUksR0FBR2pCLEtBQUssQ0FBQ04sSUFBSSxDQUFDZSxJQUFJLEdBQUdTLGdCQUFnQixHQUFHQyxtQkFBbUIsQ0FBQTtBQUNyRSxRQUFBLElBQUkxQixPQUFPLENBQUN3QixJQUFJLEtBQUtBLElBQUksRUFBRTtVQUN2QnhCLE9BQU8sQ0FBQ3dCLElBQUksR0FBR0EsSUFBSSxDQUFBO0FBQ3ZCLFNBQUE7QUFDSixPQUFBO0FBQ0osS0FBQTtBQUVBakIsSUFBQUEsS0FBSyxDQUFDSixRQUFRLENBQUNILE9BQU8sR0FBR0EsT0FBTyxDQUFBOztBQUVoQztJQUNBLE1BQU1pQixNQUFNLEdBQUcsRUFBRSxDQUFBO0lBQ2pCLEtBQUssTUFBTVUsR0FBRyxJQUFJcEIsS0FBSyxDQUFDTixJQUFJLENBQUNnQixNQUFNLEVBQUU7TUFDakMsTUFBTVcsS0FBSyxHQUFHckIsS0FBSyxDQUFDTixJQUFJLENBQUNnQixNQUFNLENBQUNVLEdBQUcsQ0FBQyxDQUFBO01BQ3BDVixNQUFNLENBQUNVLEdBQUcsQ0FBQyxHQUFHO0FBQ1ZFLFFBQUFBLElBQUksRUFBRSxJQUFJQyxJQUFJLENBQUNGLEtBQUssQ0FBQ0MsSUFBSSxDQUFDO0FBQzFCRSxRQUFBQSxLQUFLLEVBQUUsSUFBSUMsSUFBSSxDQUFDSixLQUFLLENBQUNHLEtBQUssQ0FBQztBQUM1QkUsUUFBQUEsTUFBTSxFQUFFLElBQUlILElBQUksQ0FBQ0YsS0FBSyxDQUFDSyxNQUFNLENBQUE7T0FDaEMsQ0FBQTtBQUNMLEtBQUE7QUFDQTFCLElBQUFBLEtBQUssQ0FBQ0osUUFBUSxDQUFDYyxNQUFNLEdBQUdBLE1BQU0sQ0FBQTtJQUU5QlYsS0FBSyxDQUFDMkIsR0FBRyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUNDLGNBQWMsRUFBRSxJQUFJLENBQUMsQ0FBQTtJQUM5QzVCLEtBQUssQ0FBQzZCLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDRCxjQUFjLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDakQsR0FBQTtBQUVBQSxFQUFBQSxjQUFjQSxDQUFDNUIsS0FBSyxFQUFFOEIsU0FBUyxFQUFFQyxLQUFLLEVBQUU7QUFDcEMsSUFBQSxJQUFJVixLQUFLLENBQUE7QUFFVCxJQUFBLElBQUlTLFNBQVMsS0FBSyxNQUFNLElBQUlBLFNBQVMsS0FBSyxhQUFhLEVBQUU7QUFDckQ7TUFDQSxNQUFNcEIsTUFBTSxHQUFHLEVBQUUsQ0FBQTtBQUNqQixNQUFBLEtBQUssTUFBTVUsR0FBRyxJQUFJVyxLQUFLLENBQUNyQixNQUFNLEVBQUU7QUFDNUJXLFFBQUFBLEtBQUssR0FBR1UsS0FBSyxDQUFDckIsTUFBTSxDQUFDVSxHQUFHLENBQUMsQ0FBQTtRQUN6QlYsTUFBTSxDQUFDVSxHQUFHLENBQUMsR0FBRztBQUNWRSxVQUFBQSxJQUFJLEVBQUUsSUFBSUMsSUFBSSxDQUFDRixLQUFLLENBQUNDLElBQUksQ0FBQztBQUMxQkUsVUFBQUEsS0FBSyxFQUFFLElBQUlDLElBQUksQ0FBQ0osS0FBSyxDQUFDRyxLQUFLLENBQUM7QUFDNUJFLFVBQUFBLE1BQU0sRUFBRSxJQUFJSCxJQUFJLENBQUNGLEtBQUssQ0FBQ0ssTUFBTSxDQUFBO1NBQ2hDLENBQUE7QUFDTCxPQUFBO0FBQ0ExQixNQUFBQSxLQUFLLENBQUNKLFFBQVEsQ0FBQ2MsTUFBTSxHQUFHQSxNQUFNLENBQUE7QUFDbEMsS0FBQyxNQUFNO0FBQ0gsTUFBQSxNQUFNc0IsS0FBSyxHQUFHRixTQUFTLENBQUNFLEtBQUssQ0FBQy9ELFVBQVUsQ0FBQyxDQUFBO0FBQ3pDLE1BQUEsSUFBSStELEtBQUssRUFBRTtBQUNQLFFBQUEsTUFBTUMsUUFBUSxHQUFHRCxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFFekIsUUFBQSxJQUFJRCxLQUFLLEVBQUU7QUFDUDtVQUNBLElBQUksQ0FBQy9CLEtBQUssQ0FBQ0osUUFBUSxDQUFDYyxNQUFNLENBQUN1QixRQUFRLENBQUMsRUFBRTtBQUNsQ2pDLFlBQUFBLEtBQUssQ0FBQ0osUUFBUSxDQUFDYyxNQUFNLENBQUN1QixRQUFRLENBQUMsR0FBRztBQUM5QlgsY0FBQUEsSUFBSSxFQUFFLElBQUlDLElBQUksQ0FBQ1EsS0FBSyxDQUFDVCxJQUFJLENBQUM7QUFDMUJFLGNBQUFBLEtBQUssRUFBRSxJQUFJQyxJQUFJLENBQUNNLEtBQUssQ0FBQ1AsS0FBSyxDQUFDO0FBQzVCRSxjQUFBQSxNQUFNLEVBQUUsSUFBSUgsSUFBSSxDQUFDUSxLQUFLLENBQUNMLE1BQU0sQ0FBQTthQUNoQyxDQUFBO0FBQ0wsV0FBQyxNQUFNO1lBQ0hMLEtBQUssR0FBR3JCLEtBQUssQ0FBQ0osUUFBUSxDQUFDYyxNQUFNLENBQUN1QixRQUFRLENBQUMsQ0FBQTtBQUN2Q1osWUFBQUEsS0FBSyxDQUFDQyxJQUFJLENBQUNZLEdBQUcsQ0FBQ0gsS0FBSyxDQUFDVCxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUVTLEtBQUssQ0FBQ1QsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFUyxLQUFLLENBQUNULElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRVMsS0FBSyxDQUFDVCxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUMxRUQsWUFBQUEsS0FBSyxDQUFDRyxLQUFLLENBQUNVLEdBQUcsQ0FBQ0gsS0FBSyxDQUFDUCxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUVPLEtBQUssQ0FBQ1AsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDL0NILFlBQUFBLEtBQUssQ0FBQ0ssTUFBTSxDQUFDUSxHQUFHLENBQUNILEtBQUssQ0FBQ0wsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFSyxLQUFLLENBQUNMLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRUssS0FBSyxDQUFDTCxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUVLLEtBQUssQ0FBQ0wsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDeEYsV0FBQTtBQUVBMUIsVUFBQUEsS0FBSyxDQUFDSixRQUFRLENBQUN1QyxJQUFJLENBQUMsV0FBVyxFQUFFRixRQUFRLEVBQUVqQyxLQUFLLENBQUNKLFFBQVEsQ0FBQ2MsTUFBTSxDQUFDdUIsUUFBUSxDQUFDLENBQUMsQ0FBQTtBQUUvRSxTQUFDLE1BQU07QUFDSDtVQUNBLElBQUlqQyxLQUFLLENBQUNKLFFBQVEsQ0FBQ2MsTUFBTSxDQUFDdUIsUUFBUSxDQUFDLEVBQUU7QUFDakMsWUFBQSxPQUFPakMsS0FBSyxDQUFDSixRQUFRLENBQUNjLE1BQU0sQ0FBQ3VCLFFBQVEsQ0FBQyxDQUFBO1lBQ3RDakMsS0FBSyxDQUFDSixRQUFRLENBQUN1QyxJQUFJLENBQUMsY0FBYyxFQUFFRixRQUFRLENBQUMsQ0FBQTtBQUNqRCxXQUFBO0FBQ0osU0FBQTtBQUVKLE9BQUE7QUFDSixLQUFBO0FBQ0osR0FBQTtBQUNKOzs7OyJ9
