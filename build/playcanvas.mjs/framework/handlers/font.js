import { path } from '../../core/path.js';
import { string } from '../../core/string.js';
import { http } from '../../platform/net/http.js';
import { Font } from '../font/font.js';

/** @typedef {import('./handler.js').ResourceHandler} ResourceHandler */

function upgradeDataSchema(data) {
  // convert v1 and v2 to v3 font data schema
  if (data.version < 3) {
    if (data.version < 2) {
      data.info.maps = data.info.maps || [{
        width: data.info.width,
        height: data.info.height
      }];
    }
    data.chars = Object.keys(data.chars || {}).reduce(function (newChars, key) {
      const existing = data.chars[key];
      // key by letter instead of char code
      const newKey = existing.letter !== undefined ? existing.letter : string.fromCodePoint(key);
      if (data.version < 2) {
        existing.map = existing.map || 0;
      }
      newChars[newKey] = existing;
      return newChars;
    }, {});
    data.version = 3;
  }
  return data;
}

/**
 * Resource handler used for loading {@link Font} resources.
 *
 * @implements {ResourceHandler}
 * @category User Interface
 */
class FontHandler {
  /**
   * Create a new FontHandler instance.
   *
   * @param {import('../app-base.js').AppBase} app - The running {@link AppBase}.
   * @hideconstructor
   */
  constructor(app) {
    /**
     * Type of the resource the handler handles.
     *
     * @type {string}
     */
    this.handlerType = "font";
    this._loader = app.loader;
    this.maxRetries = 0;
  }
  load(url, callback, asset) {
    if (typeof url === 'string') {
      url = {
        load: url,
        original: url
      };
    }
    const self = this;
    if (path.getExtension(url.original) === '.json') {
      // load json data then load texture of same name
      http.get(url.load, {
        retry: this.maxRetries > 0,
        maxRetries: this.maxRetries
      }, function (err, response) {
        // update asset data
        if (!err) {
          const data = upgradeDataSchema(response);
          self._loadTextures(url.load.replace('.json', '.png'), data, function (err, textures) {
            if (err) {
              callback(err);
            } else {
              callback(null, {
                data: data,
                textures: textures
              });
            }
          });
        } else {
          callback(`Error loading font resource: ${url.original} [${err}]`);
        }
      });
    } else {
      // upgrade asset data
      if (asset && asset.data) {
        asset.data = upgradeDataSchema(asset.data);
      }
      this._loadTextures(url.load, asset && asset.data, callback);
    }
  }
  _loadTextures(url, data, callback) {
    const numTextures = data.info.maps.length;
    let numLoaded = 0;
    let error = null;
    const textures = new Array(numTextures);
    const loader = this._loader;
    const loadTexture = function loadTexture(index) {
      const onLoaded = function onLoaded(err, texture) {
        if (error) return;
        if (err) {
          error = err;
          callback(err);
          return;
        }
        texture.upload();
        textures[index] = texture;
        numLoaded++;
        if (numLoaded === numTextures) {
          callback(null, textures);
        }
      };
      if (index === 0) {
        loader.load(url, 'texture', onLoaded);
      } else {
        loader.load(url.replace('.png', index + '.png'), 'texture', onLoaded);
      }
    };
    for (let i = 0; i < numTextures; i++) loadTexture(i);
  }
  open(url, data, asset) {
    let font;
    if (data.textures) {
      // both data and textures exist
      font = new Font(data.textures, data.data);
    } else {
      // only textures
      font = new Font(data, null);
    }
    return font;
  }
  patch(asset, assets) {
    // if not already set, get font data block from asset
    // and assign to font resource
    const font = asset.resource;
    if (!font.data && asset.data) {
      // font data present in asset but not in font
      font.data = asset.data;
    } else if (!asset.data && font.data) {
      // font data present in font but not in asset
      asset.data = font.data;
    }
    if (asset.data) {
      asset.data = upgradeDataSchema(asset.data);
    }
  }
}

export { FontHandler };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9udC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay9oYW5kbGVycy9mb250LmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHBhdGggfSBmcm9tICcuLi8uLi9jb3JlL3BhdGguanMnO1xuaW1wb3J0IHsgc3RyaW5nIH0gZnJvbSAnLi4vLi4vY29yZS9zdHJpbmcuanMnO1xuXG5pbXBvcnQgeyBodHRwIH0gZnJvbSAnLi4vLi4vcGxhdGZvcm0vbmV0L2h0dHAuanMnO1xuXG5pbXBvcnQgeyBGb250IH0gZnJvbSAnLi4vZm9udC9mb250LmpzJztcblxuLyoqIEB0eXBlZGVmIHtpbXBvcnQoJy4vaGFuZGxlci5qcycpLlJlc291cmNlSGFuZGxlcn0gUmVzb3VyY2VIYW5kbGVyICovXG5cbmZ1bmN0aW9uIHVwZ3JhZGVEYXRhU2NoZW1hKGRhdGEpIHtcbiAgICAvLyBjb252ZXJ0IHYxIGFuZCB2MiB0byB2MyBmb250IGRhdGEgc2NoZW1hXG4gICAgaWYgKGRhdGEudmVyc2lvbiA8IDMpIHtcbiAgICAgICAgaWYgKGRhdGEudmVyc2lvbiA8IDIpIHtcbiAgICAgICAgICAgIGRhdGEuaW5mby5tYXBzID0gZGF0YS5pbmZvLm1hcHMgfHwgW3tcbiAgICAgICAgICAgICAgICB3aWR0aDogZGF0YS5pbmZvLndpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodDogZGF0YS5pbmZvLmhlaWdodFxuICAgICAgICAgICAgfV07XG4gICAgICAgIH1cbiAgICAgICAgZGF0YS5jaGFycyA9IE9iamVjdC5rZXlzKGRhdGEuY2hhcnMgfHwge30pLnJlZHVjZShmdW5jdGlvbiAobmV3Q2hhcnMsIGtleSkge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmcgPSBkYXRhLmNoYXJzW2tleV07XG4gICAgICAgICAgICAvLyBrZXkgYnkgbGV0dGVyIGluc3RlYWQgb2YgY2hhciBjb2RlXG4gICAgICAgICAgICBjb25zdCBuZXdLZXkgPSBleGlzdGluZy5sZXR0ZXIgIT09IHVuZGVmaW5lZCA/IGV4aXN0aW5nLmxldHRlciA6IHN0cmluZy5mcm9tQ29kZVBvaW50KGtleSk7XG4gICAgICAgICAgICBpZiAoZGF0YS52ZXJzaW9uIDwgMikge1xuICAgICAgICAgICAgICAgIGV4aXN0aW5nLm1hcCA9IGV4aXN0aW5nLm1hcCB8fCAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbmV3Q2hhcnNbbmV3S2V5XSA9IGV4aXN0aW5nO1xuICAgICAgICAgICAgcmV0dXJuIG5ld0NoYXJzO1xuICAgICAgICB9LCB7fSk7XG4gICAgICAgIGRhdGEudmVyc2lvbiA9IDM7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufVxuXG4vKipcbiAqIFJlc291cmNlIGhhbmRsZXIgdXNlZCBmb3IgbG9hZGluZyB7QGxpbmsgRm9udH0gcmVzb3VyY2VzLlxuICpcbiAqIEBpbXBsZW1lbnRzIHtSZXNvdXJjZUhhbmRsZXJ9XG4gKiBAY2F0ZWdvcnkgVXNlciBJbnRlcmZhY2VcbiAqL1xuY2xhc3MgRm9udEhhbmRsZXIge1xuICAgIC8qKlxuICAgICAqIFR5cGUgb2YgdGhlIHJlc291cmNlIHRoZSBoYW5kbGVyIGhhbmRsZXMuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7c3RyaW5nfVxuICAgICAqL1xuICAgIGhhbmRsZXJUeXBlID0gXCJmb250XCI7XG5cbiAgICAvKipcbiAgICAgKiBDcmVhdGUgYSBuZXcgRm9udEhhbmRsZXIgaW5zdGFuY2UuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge2ltcG9ydCgnLi4vYXBwLWJhc2UuanMnKS5BcHBCYXNlfSBhcHAgLSBUaGUgcnVubmluZyB7QGxpbmsgQXBwQmFzZX0uXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICB0aGlzLl9sb2FkZXIgPSBhcHAubG9hZGVyO1xuICAgICAgICB0aGlzLm1heFJldHJpZXMgPSAwO1xuICAgIH1cblxuICAgIGxvYWQodXJsLCBjYWxsYmFjaywgYXNzZXQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB1cmwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB1cmwgPSB7XG4gICAgICAgICAgICAgICAgbG9hZDogdXJsLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsOiB1cmxcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcbiAgICAgICAgaWYgKHBhdGguZ2V0RXh0ZW5zaW9uKHVybC5vcmlnaW5hbCkgPT09ICcuanNvbicpIHtcbiAgICAgICAgICAgIC8vIGxvYWQganNvbiBkYXRhIHRoZW4gbG9hZCB0ZXh0dXJlIG9mIHNhbWUgbmFtZVxuICAgICAgICAgICAgaHR0cC5nZXQodXJsLmxvYWQsIHtcbiAgICAgICAgICAgICAgICByZXRyeTogdGhpcy5tYXhSZXRyaWVzID4gMCxcbiAgICAgICAgICAgICAgICBtYXhSZXRyaWVzOiB0aGlzLm1heFJldHJpZXNcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIsIHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gdXBkYXRlIGFzc2V0IGRhdGFcbiAgICAgICAgICAgICAgICBpZiAoIWVycikge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gdXBncmFkZURhdGFTY2hlbWEocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLl9sb2FkVGV4dHVyZXModXJsLmxvYWQucmVwbGFjZSgnLmpzb24nLCAnLnBuZycpLCBkYXRhLCBmdW5jdGlvbiAoZXJyLCB0ZXh0dXJlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHVyZXM6IHRleHR1cmVzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGBFcnJvciBsb2FkaW5nIGZvbnQgcmVzb3VyY2U6ICR7dXJsLm9yaWdpbmFsfSBbJHtlcnJ9XWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyB1cGdyYWRlIGFzc2V0IGRhdGFcbiAgICAgICAgICAgIGlmIChhc3NldCAmJiBhc3NldC5kYXRhKSB7XG4gICAgICAgICAgICAgICAgYXNzZXQuZGF0YSA9IHVwZ3JhZGVEYXRhU2NoZW1hKGFzc2V0LmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fbG9hZFRleHR1cmVzKHVybC5sb2FkLCBhc3NldCAmJiBhc3NldC5kYXRhLCBjYWxsYmFjayk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBfbG9hZFRleHR1cmVzKHVybCwgZGF0YSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgbnVtVGV4dHVyZXMgPSBkYXRhLmluZm8ubWFwcy5sZW5ndGg7XG4gICAgICAgIGxldCBudW1Mb2FkZWQgPSAwO1xuICAgICAgICBsZXQgZXJyb3IgPSBudWxsO1xuXG4gICAgICAgIGNvbnN0IHRleHR1cmVzID0gbmV3IEFycmF5KG51bVRleHR1cmVzKTtcbiAgICAgICAgY29uc3QgbG9hZGVyID0gdGhpcy5fbG9hZGVyO1xuXG4gICAgICAgIGNvbnN0IGxvYWRUZXh0dXJlID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBvbkxvYWRlZCA9IGZ1bmN0aW9uIChlcnIsIHRleHR1cmUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHJldHVybjtcblxuICAgICAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBlcnI7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0ZXh0dXJlLnVwbG9hZCgpO1xuICAgICAgICAgICAgICAgIHRleHR1cmVzW2luZGV4XSA9IHRleHR1cmU7XG4gICAgICAgICAgICAgICAgbnVtTG9hZGVkKys7XG4gICAgICAgICAgICAgICAgaWYgKG51bUxvYWRlZCA9PT0gbnVtVGV4dHVyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgdGV4dHVyZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGxvYWRlci5sb2FkKHVybCwgJ3RleHR1cmUnLCBvbkxvYWRlZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxvYWRlci5sb2FkKHVybC5yZXBsYWNlKCcucG5nJywgaW5kZXggKyAnLnBuZycpLCAndGV4dHVyZScsIG9uTG9hZGVkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVRleHR1cmVzOyBpKyspXG4gICAgICAgICAgICBsb2FkVGV4dHVyZShpKTtcbiAgICB9XG5cbiAgICBvcGVuKHVybCwgZGF0YSwgYXNzZXQpIHtcbiAgICAgICAgbGV0IGZvbnQ7XG4gICAgICAgIGlmIChkYXRhLnRleHR1cmVzKSB7XG4gICAgICAgICAgICAvLyBib3RoIGRhdGEgYW5kIHRleHR1cmVzIGV4aXN0XG4gICAgICAgICAgICBmb250ID0gbmV3IEZvbnQoZGF0YS50ZXh0dXJlcywgZGF0YS5kYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIG9ubHkgdGV4dHVyZXNcbiAgICAgICAgICAgIGZvbnQgPSBuZXcgRm9udChkYXRhLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm9udDtcbiAgICB9XG5cbiAgICBwYXRjaChhc3NldCwgYXNzZXRzKSB7XG4gICAgICAgIC8vIGlmIG5vdCBhbHJlYWR5IHNldCwgZ2V0IGZvbnQgZGF0YSBibG9jayBmcm9tIGFzc2V0XG4gICAgICAgIC8vIGFuZCBhc3NpZ24gdG8gZm9udCByZXNvdXJjZVxuICAgICAgICBjb25zdCBmb250ID0gYXNzZXQucmVzb3VyY2U7XG4gICAgICAgIGlmICghZm9udC5kYXRhICYmIGFzc2V0LmRhdGEpIHtcbiAgICAgICAgICAgIC8vIGZvbnQgZGF0YSBwcmVzZW50IGluIGFzc2V0IGJ1dCBub3QgaW4gZm9udFxuICAgICAgICAgICAgZm9udC5kYXRhID0gYXNzZXQuZGF0YTtcbiAgICAgICAgfSBlbHNlIGlmICghYXNzZXQuZGF0YSAmJiBmb250LmRhdGEpIHtcbiAgICAgICAgICAgIC8vIGZvbnQgZGF0YSBwcmVzZW50IGluIGZvbnQgYnV0IG5vdCBpbiBhc3NldFxuICAgICAgICAgICAgYXNzZXQuZGF0YSA9IGZvbnQuZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChhc3NldC5kYXRhKSB7XG4gICAgICAgICAgICBhc3NldC5kYXRhID0gdXBncmFkZURhdGFTY2hlbWEoYXNzZXQuZGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCB7IEZvbnRIYW5kbGVyIH07XG4iXSwibmFtZXMiOlsidXBncmFkZURhdGFTY2hlbWEiLCJkYXRhIiwidmVyc2lvbiIsImluZm8iLCJtYXBzIiwid2lkdGgiLCJoZWlnaHQiLCJjaGFycyIsIk9iamVjdCIsImtleXMiLCJyZWR1Y2UiLCJuZXdDaGFycyIsImtleSIsImV4aXN0aW5nIiwibmV3S2V5IiwibGV0dGVyIiwidW5kZWZpbmVkIiwic3RyaW5nIiwiZnJvbUNvZGVQb2ludCIsIm1hcCIsIkZvbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJhcHAiLCJoYW5kbGVyVHlwZSIsIl9sb2FkZXIiLCJsb2FkZXIiLCJtYXhSZXRyaWVzIiwibG9hZCIsInVybCIsImNhbGxiYWNrIiwiYXNzZXQiLCJvcmlnaW5hbCIsInNlbGYiLCJwYXRoIiwiZ2V0RXh0ZW5zaW9uIiwiaHR0cCIsImdldCIsInJldHJ5IiwiZXJyIiwicmVzcG9uc2UiLCJfbG9hZFRleHR1cmVzIiwicmVwbGFjZSIsInRleHR1cmVzIiwibnVtVGV4dHVyZXMiLCJsZW5ndGgiLCJudW1Mb2FkZWQiLCJlcnJvciIsIkFycmF5IiwibG9hZFRleHR1cmUiLCJpbmRleCIsIm9uTG9hZGVkIiwidGV4dHVyZSIsInVwbG9hZCIsImkiLCJvcGVuIiwiZm9udCIsIkZvbnQiLCJwYXRjaCIsImFzc2V0cyIsInJlc291cmNlIl0sIm1hcHBpbmdzIjoiOzs7OztBQU9BOztBQUVBLFNBQVNBLGlCQUFpQkEsQ0FBQ0MsSUFBSSxFQUFFO0FBQzdCO0FBQ0EsRUFBQSxJQUFJQSxJQUFJLENBQUNDLE9BQU8sR0FBRyxDQUFDLEVBQUU7QUFDbEIsSUFBQSxJQUFJRCxJQUFJLENBQUNDLE9BQU8sR0FBRyxDQUFDLEVBQUU7TUFDbEJELElBQUksQ0FBQ0UsSUFBSSxDQUFDQyxJQUFJLEdBQUdILElBQUksQ0FBQ0UsSUFBSSxDQUFDQyxJQUFJLElBQUksQ0FBQztBQUNoQ0MsUUFBQUEsS0FBSyxFQUFFSixJQUFJLENBQUNFLElBQUksQ0FBQ0UsS0FBSztBQUN0QkMsUUFBQUEsTUFBTSxFQUFFTCxJQUFJLENBQUNFLElBQUksQ0FBQ0csTUFBQUE7QUFDdEIsT0FBQyxDQUFDLENBQUE7QUFDTixLQUFBO0lBQ0FMLElBQUksQ0FBQ00sS0FBSyxHQUFHQyxNQUFNLENBQUNDLElBQUksQ0FBQ1IsSUFBSSxDQUFDTSxLQUFLLElB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
