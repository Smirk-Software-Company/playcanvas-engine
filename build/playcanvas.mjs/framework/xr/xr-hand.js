import { EventHandler } from '../../core/event-handler.js';
import { platform } from '../../core/platform.js';
import { Vec3 } from '../../core/math/vec3.js';
import { XRHAND_LEFT } from './constants.js';
import { XrFinger } from './xr-finger.js';
import { XrJoint } from './xr-joint.js';

/**
 * @type {string[][]}
 * @ignore
 */
let fingerJointIds = [];
const vecA = new Vec3();
const vecB = new Vec3();
const vecC = new Vec3();
if (platform.browser && window.XRHand) {
  fingerJointIds = [['thumb-metacarpal', 'thumb-phalanx-proximal', 'thumb-phalanx-distal', 'thumb-tip'], ['index-finger-metacarpal', 'index-finger-phalanx-proximal', 'index-finger-phalanx-intermediate', 'index-finger-phalanx-distal', 'index-finger-tip'], ['middle-finger-metacarpal', 'middle-finger-phalanx-proximal', 'middle-finger-phalanx-intermediate', 'middle-finger-phalanx-distal', 'middle-finger-tip'], ['ring-finger-metacarpal', 'ring-finger-phalanx-proximal', 'ring-finger-phalanx-intermediate', 'ring-finger-phalanx-distal', 'ring-finger-tip'], ['pinky-finger-metacarpal', 'pinky-finger-phalanx-proximal', 'pinky-finger-phalanx-intermediate', 'pinky-finger-phalanx-distal', 'pinky-finger-tip']];
}

/**
 * Represents a hand with fingers and joints.
 *
 * @augments EventHandler
 * @category XR
 */
class XrHand extends EventHandler {
  /**
   * Represents a hand with fingers and joints.
   *
   * @param {import('./xr-input-source.js').XrInputSource} inputSource - Input Source that hand
   * is related to.
   * @hideconstructor
   */
  constructor(inputSource) {
    super();
    /**
     * @type {import('./xr-manager.js').XrManager}
     * @private
     */
    this._manager = void 0;
    /**
     * @type {import('./xr-input-source.js').XrInputSource}
     * @private
     */
    this._inputSource = void 0;
    /**
     * @type {boolean}
     * @private
     */
    this._tracking = false;
    /**
     * @type {XrFinger[]}
     * @private
     */
    this._fingers = [];
    /**
     * @type {XrJoint[]}
     * @private
     */
    this._joints = [];
    /**
     * @type {Object<string, XrJoint>}
     * @private
     */
    this._jointsById = {};
    /**
     * @type {XrJoint[]}
     * @private
     */
    this._tips = [];
    /**
     * @type {XrJoint|null}
     * @private
     */
    this._wrist = null;
    const xrHand = inputSource._xrInputSource.hand;
    this._manager = inputSource._manager;
    this._inputSource = inputSource;
    if (xrHand.get('wrist')) {
      const joint = new XrJoint(0, 'wrist', this, null);
      this._wrist = joint;
      this._joints.push(joint);
      this._jointsById.wrist = joint;
    }
    for (let f = 0; f < fingerJointIds.length; f++) {
      const finger = new XrFinger(f, this);
      for (let j = 0; j < fingerJointIds[f].length; j++) {
        const jointId = fingerJointIds[f][j];
        if (!xrHand.get(jointId)) continue;
        const joint = new XrJoint(j, jointId, this, finger);
        this._joints.push(joint);
        this._jointsById[jointId] = joint;
        if (joint.tip) {
          this._tips.push(joint);
          finger._tip = joint;
        }
        finger._joints.push(joint);
      }
    }
  }

  /**
   * Fired when tracking becomes available.
   *
   * @event XrHand#tracking
   */

  /**
   * Fired when tracking is lost.
   *
   * @event XrHand#trackinglost
   */

  /**
   * @param {*} frame - XRFrame from requestAnimationFrame callback.
   * @ignore
   */
  update(frame) {
    const xrInputSource = this._inputSource._xrInputSource;

    // joints
    for (let j = 0; j < this._joints.length; j++) {
      const joint = this._joints[j];
      const jointSpace = xrInputSource.hand.get(joint._id);
      if (jointSpace) {
        let pose;
        if (frame.session.visibilityState !== 'hidden') pose = frame.getJointPose(jointSpace, this._manager._referenceSpace);
        if (pose) {
          joint.update(pose);
          if (joint.wrist && !this._tracking) {
            this._tracking = true;
            this.fire('tracking');
          }
        } else if (joint.wrist) {
          // lost tracking

          if (this._tracking) {
            this._tracking = false;
            this.fire('trackinglost');
          }
          break;
        }
      }
    }
    const j1 = this._jointsById['thumb-metacarpal'];
    const j4 = this._jointsById['thumb-tip'];
    const j6 = this._jointsById['index-finger-phalanx-proximal'];
    const j9 = this._jointsById['index-finger-tip'];
    const j16 = this._jointsById['ring-finger-phalanx-proximal'];
    const j21 = this._jointsById['pinky-finger-phalanx-proximal'];

    // ray
    if (j1 && j4 && j6 && j9 && j16 && j21) {
      this._inputSource._dirtyRay = true;

      // ray origin
      // get point between thumb tip and index tip
      this._inputSource._rayLocal.origin.lerp(j4._localPosition, j9._localPosition, 0.5);

      // ray direction
      let jointL = j1;
      let jointR = j21;
      if (this._inputSource.handedness === XRHAND_LEFT) {
        const t = jointL;
        jointL = jointR;
        jointR = t;
      }

      // (A) calculate normal vector between 3 joints: wrist, thumb metacarpal, little phalanx proximal
      vecA.sub2(jointL._localPosition, this._wrist._localPosition);
      vecB.sub2(jointR._localPosition, this._wrist._localPosition);
      vecC.cross(vecA, vecB).normalize();

      // get point between: index phalanx proximal and right phalanx proximal
      vecA.lerp(j6._localPosition, j16._localPosition, 0.5);
      // (B) get vector between that point and a wrist
      vecA.sub(this._wrist._localPosition).normalize();

      // mix normal vector (A) with hand directional vector (B)
      this._inputSource._rayLocal.direction.lerp(vecC, vecA, 0.5).normalize();
    }

    // emulate squeeze events by folding all 4 fingers
    const squeezing = this._fingerIsClosed(1) && this._fingerIsClosed(2) && this._fingerIsClosed(3) && this._fingerIsClosed(4);
    if (squeezing) {
      if (!this._inputSource._squeezing) {
        this._inputSource._squeezing = true;
        this._inputSource.fire('squeezestart');
        this._manager.input.fire('squeezestart', this._inputSource);
      }
    } else {
      if (this._inputSource._squeezing) {
        this._inputSource._squeezing = false;
        this._inputSource.fire('squeeze');
        this._manager.input.fire('squeeze', this._inputSource);
        this._inputSource.fire('squeezeend');
        this._manager.input.fire('squeezeend', this._inputSource);
      }
    }
  }

  /**
   * @param {number} index - Finger index.
   * @returns {boolean} True if finger is closed and false otherwise.
   * @private
   */
  _fingerIsClosed(index) {
    const finger = this._fingers[index];
    vecA.sub2(finger.joints[0]._localPosition, finger.joints[1]._localPosition).normalize();
    vecB.sub2(finger.joints[2]._localPosition, finger.joints[3]._localPosition).normalize();
    return vecA.dot(vecB) < -0.8;
  }

  /**
   * Returns joint by XRHand id from list in specs: https://immersive-web.github.io/webxr-hand-input/.
   *
   * @param {string} id - Id of a joint based on specs ID's in XRHand: https://immersive-web.github.io/webxr-hand-input/.
   * @returns {XrJoint|null} Joint or null if not available.
   */
  getJointById(id) {
    return this._jointsById[id] || null;
  }

  /**
   * List of fingers of a hand.
   *
   * @type {XrFinger[]}
   */
  get fingers() {
    return this._fingers;
  }

  /**
   * List of joints of hand.
   *
   * @type {XrJoint[]}
   */
  get joints() {
    return this._joints;
  }

  /**
   * List of joints that are fingertips.
   *
   * @type {XrJoint[]}
   */
  get tips() {
    return this._tips;
  }

  /**
   * Wrist of a hand, or null if it is not available by WebXR underlying system.
   *
   * @type {XrJoint|null}
   */
  get wrist() {
    return this._wrist;
  }

  /**
   * True if tracking is available, otherwise tracking might be lost.
   *
   * @type {boolean}
   */
  get tracking() {
    return this._tracking;
  }
}

export { XrHand };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieHItaGFuZC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2ZyYW1ld29yay94ci94ci1oYW5kLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50SGFuZGxlciB9IGZyb20gJy4uLy4uL2NvcmUvZXZlbnQtaGFuZGxlci5qcyc7XG5pbXBvcnQgeyBwbGF0Zm9ybSB9IGZyb20gJy4uLy4uL2NvcmUvcGxhdGZvcm0uanMnO1xuaW1wb3J0IHsgVmVjMyB9IGZyb20gJy4uLy4uL2NvcmUvbWF0aC92ZWMzLmpzJztcblxuaW1wb3J0IHsgWFJIQU5EX0xFRlQgfSBmcm9tICcuL2NvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBYckZpbmdlciB9IGZyb20gJy4veHItZmluZ2VyLmpzJztcbmltcG9ydCB7IFhySm9pbnQgfSBmcm9tICcuL3hyLWpvaW50LmpzJztcblxuXG4vKipcbiAqIEB0eXBlIHtzdHJpbmdbXVtdfVxuICogQGlnbm9yZVxuICovXG5sZXQgZmluZ2VySm9pbnRJZHMgPSBbXTtcblxuY29uc3QgdmVjQSA9IG5ldyBWZWMzKCk7XG5jb25zdCB2ZWNCID0gbmV3IFZlYzMoKTtcbmNvbnN0IHZlY0MgPSBuZXcgVmVjMygpO1xuXG5pZiAocGxhdGZvcm0uYnJvd3NlciAmJiB3aW5kb3cuWFJIYW5kKSB7XG4gICAgZmluZ2VySm9pbnRJZHMgPSBbXG4gICAgICAgIFsndGh1bWItbWV0YWNhcnBhbCcsICd0aHVtYi1waGFsYW54LXByb3hpbWFsJywgJ3RodW1iLXBoYWxhbngtZGlzdGFsJywgJ3RodW1iLXRpcCddLFxuICAgICAgICBbJ2luZGV4LWZpbmdlci1tZXRhY2FycGFsJywgJ2luZGV4LWZpbmdlci1waGFsYW54LXByb3hpbWFsJywgJ2luZGV4LWZpbmdlci1waGFsYW54LWludGVybWVkaWF0ZScsICdpbmRleC1maW5nZXItcGhhbGFueC1kaXN0YWwnLCAnaW5kZXgtZmluZ2VyLXRpcCddLFxuICAgICAgICBbJ21pZGRsZS1maW5nZXItbWV0YWNhcnBhbCcsICdtaWRkbGUtZmluZ2VyLXBoYWxhbngtcHJveGltYWwnLCAnbWlkZGxlLWZpbmdlci1waGFsYW54LWludGVybWVkaWF0ZScsICdtaWRkbGUtZmluZ2VyLXBoYWxhbngtZGlzdGFsJywgJ21pZGRsZS1maW5nZXItdGlwJ10sXG4gICAgICAgIFsncmluZy1maW5nZXItbWV0YWNhcnBhbCcsICdyaW5nLWZpbmdlci1waGFsYW54LXByb3hpbWFsJywgJ3JpbmctZmluZ2VyLXBoYWxhbngtaW50ZXJtZWRpYXRlJywgJ3JpbmctZmluZ2VyLXBoYWxhbngtZGlzdGFsJywgJ3JpbmctZmluZ2VyLXRpcCddLFxuICAgICAgICBbJ3Bpbmt5LWZpbmdlci1tZXRhY2FycGFsJywgJ3Bpbmt5LWZpbmdlci1waGFsYW54LXByb3hpbWFsJywgJ3Bpbmt5LWZpbmdlci1waGFsYW54LWludGVybWVkaWF0ZScsICdwaW5reS1maW5nZXItcGhhbGFueC1kaXN0YWwnLCAncGlua3ktZmluZ2VyLXRpcCddXG4gICAgXTtcbn1cblxuLyoqXG4gKiBSZXByZXNlbnRzIGEgaGFuZCB3aXRoIGZpbmdlcnMgYW5kIGpvaW50cy5cbiAqXG4gKiBAYXVnbWVudHMgRXZlbnRIYW5kbGVyXG4gKiBAY2F0ZWdvcnkgWFJcbiAqL1xuY2xhc3MgWHJIYW5kIGV4dGVuZHMgRXZlbnRIYW5kbGVyIHtcbiAgICAvKipcbiAgICAgKiBAdHlwZSB7aW1wb3J0KCcuL3hyLW1hbmFnZXIuanMnKS5Yck1hbmFnZXJ9XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfbWFuYWdlcjtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtpbXBvcnQoJy4veHItaW5wdXQtc291cmNlLmpzJykuWHJJbnB1dFNvdXJjZX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9pbnB1dFNvdXJjZTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3RyYWNraW5nID0gZmFsc2U7XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7WHJGaW5nZXJbXX1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9maW5nZXJzID0gW107XG5cbiAgICAvKipcbiAgICAgKiBAdHlwZSB7WHJKb2ludFtdfVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2pvaW50cyA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge09iamVjdDxzdHJpbmcsIFhySm9pbnQ+fVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2pvaW50c0J5SWQgPSB7fTtcblxuICAgIC8qKlxuICAgICAqIEB0eXBlIHtYckpvaW50W119XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfdGlwcyA9IFtdO1xuXG4gICAgLyoqXG4gICAgICogQHR5cGUge1hySm9pbnR8bnVsbH1cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF93cmlzdCA9IG51bGw7XG5cbiAgICAvKipcbiAgICAgKiBSZXByZXNlbnRzIGEgaGFuZCB3aXRoIGZpbmdlcnMgYW5kIGpvaW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7aW1wb3J0KCcuL3hyLWlucHV0LXNvdXJjZS5qcycpLlhySW5wdXRTb3VyY2V9IGlucHV0U291cmNlIC0gSW5wdXQgU291cmNlIHRoYXQgaGFuZFxuICAgICAqIGlzIHJlbGF0ZWQgdG8uXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGlucHV0U291cmNlKSB7XG4gICAgICAgIHN1cGVyKCk7XG5cbiAgICAgICAgY29uc3QgeHJIYW5kID0gaW5wdXRTb3VyY2UuX3hySW5wdXRTb3VyY2UuaGFuZDtcblxuICAgICAgICB0aGlzLl9tYW5hZ2VyID0gaW5wdXRTb3VyY2UuX21hbmFnZXI7XG4gICAgICAgIHRoaXMuX2lucHV0U291cmNlID0gaW5wdXRTb3VyY2U7XG5cbiAgICAgICAgaWYgKHhySGFuZC5nZXQoJ3dyaXN0JykpIHtcbiAgICAgICAgICAgIGNvbnN0IGpvaW50ID0gbmV3IFhySm9pbnQoMCwgJ3dyaXN0JywgdGhpcywgbnVsbCk7XG4gICAgICAgICAgICB0aGlzLl93cmlzdCA9IGpvaW50O1xuICAgICAgICAgICAgdGhpcy5fam9pbnRzLnB1c2goam9pbnQpO1xuICAgICAgICAgICAgdGhpcy5fam9pbnRzQnlJZC53cmlzdCA9IGpvaW50O1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChsZXQgZiA9IDA7IGYgPCBmaW5nZXJKb2ludElkcy5sZW5ndGg7IGYrKykge1xuICAgICAgICAgICAgY29uc3QgZmluZ2VyID0gbmV3IFhyRmluZ2VyKGYsIHRoaXMpO1xuXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGZpbmdlckpvaW50SWRzW2ZdLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgam9pbnRJZCA9IGZpbmdlckpvaW50SWRzW2ZdW2pdO1xuICAgICAgICAgICAgICAgIGlmICgheHJIYW5kLmdldChqb2ludElkKSkgY29udGludWU7XG5cbiAgICAgICAgICAgICAgICBjb25zdCBqb2ludCA9IG5ldyBYckpvaW50KGosIGpvaW50SWQsIHRoaXMsIGZpbmdlcik7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9qb2ludHMucHVzaChqb2ludCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fam9pbnRzQnlJZFtqb2ludElkXSA9IGpvaW50O1xuICAgICAgICAgICAgICAgIGlmIChqb2ludC50aXApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGlwcy5wdXNoKGpvaW50KTtcbiAgICAgICAgICAgICAgICAgICAgZmluZ2VyLl90aXAgPSBqb2ludDtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBmaW5nZXIuX2pvaW50cy5wdXNoKGpvaW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEZpcmVkIHdoZW4gdHJhY2tpbmcgYmVjb21lcyBhdmFpbGFibGUuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgWHJIYW5kI3RyYWNraW5nXG4gICAgICovXG5cbiAgICAvKipcbiAgICAgKiBGaXJlZCB3aGVuIHRyYWNraW5nIGlzIGxvc3QuXG4gICAgICpcbiAgICAgKiBAZXZlbnQgWHJIYW5kI3RyYWNraW5nbG9zdFxuICAgICAqL1xuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHsqfSBmcmFtZSAtIFhSRnJhbWUgZnJvbSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgY2FsbGJhY2suXG4gICAgICogQGlnbm9yZVxuICAgICAqL1xuICAgIHVwZGF0ZShmcmFtZSkge1xuICAgICAgICBjb25zdCB4cklucHV0U291cmNlID0gdGhpcy5faW5wdXRTb3VyY2UuX3hySW5wdXRTb3VyY2U7XG5cbiAgICAgICAgLy8gam9pbnRzXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGhpcy5fam9pbnRzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICBjb25zdCBqb2ludCA9IHRoaXMuX2pvaW50c1tqXTtcbiAgICAgICAgICAgIGNvbnN0IGpvaW50U3BhY2UgPSB4cklucHV0U291cmNlLmhhbmQuZ2V0KGpvaW50Ll9pZCk7XG4gICAgICAgICAgICBpZiAoam9pbnRTcGFjZSkge1xuICAgICAgICAgICAgICAgIGxldCBwb3NlO1xuXG4gICAgICAgICAgICAgICAgaWYgKGZyYW1lLnNlc3Npb24udmlzaWJpbGl0eVN0YXRlICE9PSAnaGlkZGVuJylcbiAgICAgICAgICAgICAgICAgICAgcG9zZSA9IGZyYW1lLmdldEpvaW50UG9zZShqb2ludFNwYWNlLCB0aGlzLl9tYW5hZ2VyLl9yZWZlcmVuY2VTcGFjZSk7XG5cbiAgICAgICAgICAgICAgICBpZiAocG9zZSkge1xuICAgICAgICAgICAgICAgICAgICBqb2ludC51cGRhdGUocG9zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGpvaW50LndyaXN0ICYmICF0aGlzLl90cmFja2luZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJhY2tpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCd0cmFja2luZycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChqb2ludC53cmlzdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBsb3N0IHRyYWNraW5nXG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3RyYWNraW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90cmFja2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5maXJlKCd0cmFja2luZ2xvc3QnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBqMSA9IHRoaXMuX2pvaW50c0J5SWRbJ3RodW1iLW1ldGFjYXJwYWwnXTtcbiAgICAgICAgY29uc3QgajQgPSB0aGlzLl9qb2ludHNCeUlkWyd0aHVtYi10aXAnXTtcbiAgICAgICAgY29uc3QgajYgPSB0aGlzLl9qb2ludHNCeUlkWydpbmRleC1maW5nZXItcGhhbGFueC1wcm94aW1hbCddO1xuICAgICAgICBjb25zdCBqOSA9IHRoaXMuX2pvaW50c0J5SWRbJ2luZGV4LWZpbmdlci10aXAnXTtcbiAgICAgICAgY29uc3QgajE2ID0gdGhpcy5fam9pbnRzQnlJZFsncmluZy1maW5nZXItcGhhbGFueC1wcm94aW1hbCddO1xuICAgICAgICBjb25zdCBqMjEgPSB0aGlzLl9qb2ludHNCeUlkWydwaW5reS1maW5nZXItcGhhbGFueC1wcm94aW1hbCddO1xuXG4gICAgICAgIC8vIHJheVxuICAgICAgICBpZiAoajEgJiYgajQgJiYgajYgJiYgajkgJiYgajE2ICYmIGoyMSkge1xuICAgICAgICAgICAgdGhpcy5faW5wdXRTb3VyY2UuX2RpcnR5UmF5ID0gdHJ1ZTtcblxuICAgICAgICAgICAgLy8gcmF5IG9yaWdpblxuICAgICAgICAgICAgLy8gZ2V0IHBvaW50IGJldHdlZW4gdGh1bWIgdGlwIGFuZCBpbmRleCB0aXBcbiAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLl9yYXlMb2NhbC5vcmlnaW4ubGVycChqNC5fbG9jYWxQb3NpdGlvbiwgajkuX2xvY2FsUG9zaXRpb24sIDAuNSk7XG5cbiAgICAgICAgICAgIC8vIHJheSBkaXJlY3Rpb25cbiAgICAgICAgICAgIGxldCBqb2ludEwgPSBqMTtcbiAgICAgICAgICAgIGxldCBqb2ludFIgPSBqMjE7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLl9pbnB1dFNvdXJjZS5oYW5kZWRuZXNzID09PSBYUkhBTkRfTEVGVCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBqb2ludEw7XG4gICAgICAgICAgICAgICAgam9pbnRMID0gam9pbnRSO1xuICAgICAgICAgICAgICAgIGpvaW50UiA9IHQ7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIChBKSBjYWxjdWxhdGUgbm9ybWFsIHZlY3RvciBiZXR3ZWVuIDMgam9pbnRzOiB3cmlzdCwgdGh1bWIgbWV0YWNhcnBhbCwgbGl0dGxlIHBoYWxhbnggcHJveGltYWxcbiAgICAgICAgICAgIHZlY0Euc3ViMihqb2ludEwuX2xvY2FsUG9zaXRpb24sIHRoaXMuX3dyaXN0Ll9sb2NhbFBvc2l0aW9uKTtcbiAgICAgICAgICAgIHZlY0Iuc3ViMihqb2ludFIuX2xvY2FsUG9zaXRpb24sIHRoaXMuX3dyaXN0Ll9sb2NhbFBvc2l0aW9uKTtcbiAgICAgICAgICAgIHZlY0MuY3Jvc3ModmVjQSwgdmVjQikubm9ybWFsaXplKCk7XG5cbiAgICAgICAgICAgIC8vIGdldCBwb2ludCBiZXR3ZWVuOiBpbmRleCBwaGFsYW54IHByb3hpbWFsIGFuZCByaWdodCBwaGFsYW54IHByb3hpbWFsXG4gICAgICAgICAgICB2ZWNBLmxlcnAoajYuX2xvY2FsUG9zaXRpb24sIGoxNi5fbG9jYWxQb3NpdGlvbiwgMC41KTtcbiAgICAgICAgICAgIC8vIChCKSBnZXQgdmVjdG9yIGJldHdlZW4gdGhhdCBwb2ludCBhbmQgYSB3cmlzdFxuICAgICAgICAgICAgdmVjQS5zdWIodGhpcy5fd3Jpc3QuX2xvY2FsUG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xuXG4gICAgICAgICAgICAvLyBtaXggbm9ybWFsIHZlY3RvciAoQSkgd2l0aCBoYW5kIGRpcmVjdGlvbmFsIHZlY3RvciAoQilcbiAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLl9yYXlMb2NhbC5kaXJlY3Rpb24ubGVycCh2ZWNDLCB2ZWNBLCAwLjUpLm5vcm1hbGl6ZSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZW11bGF0ZSBzcXVlZXplIGV2ZW50cyBieSBmb2xkaW5nIGFsbCA0IGZpbmdlcnNcbiAgICAgICAgY29uc3Qgc3F1ZWV6aW5nID0gdGhpcy5fZmluZ2VySXNDbG9zZWQoMSkgJiYgdGhpcy5fZmluZ2VySXNDbG9zZWQoMikgJiYgdGhpcy5fZmluZ2VySXNDbG9zZWQoMykgJiYgdGhpcy5fZmluZ2VySXNDbG9zZWQoNCk7XG5cbiAgICAgICAgaWYgKHNxdWVlemluZykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9pbnB1dFNvdXJjZS5fc3F1ZWV6aW5nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5wdXRTb3VyY2UuX3NxdWVlemluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5wdXRTb3VyY2UuZmlyZSgnc3F1ZWV6ZXN0YXJ0Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5pbnB1dC5maXJlKCdzcXVlZXplc3RhcnQnLCB0aGlzLl9pbnB1dFNvdXJjZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faW5wdXRTb3VyY2UuX3NxdWVlemluZykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLl9zcXVlZXppbmcgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIHRoaXMuX2lucHV0U291cmNlLmZpcmUoJ3NxdWVlemUnKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLmlucHV0LmZpcmUoJ3NxdWVlemUnLCB0aGlzLl9pbnB1dFNvdXJjZSk7XG5cbiAgICAgICAgICAgICAgICB0aGlzLl9pbnB1dFNvdXJjZS5maXJlKCdzcXVlZXplZW5kJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5fbWFuYWdlci5pbnB1dC5maXJlKCdzcXVlZXplZW5kJywgdGhpcy5faW5wdXRTb3VyY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IC0gRmluZ2VyIGluZGV4LlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBUcnVlIGlmIGZpbmdlciBpcyBjbG9zZWQgYW5kIGZhbHNlIG90aGVyd2lzZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9maW5nZXJJc0Nsb3NlZChpbmRleCkge1xuICAgICAgICBjb25zdCBmaW5nZXIgPSB0aGlzLl9maW5nZXJzW2luZGV4XTtcbiAgICAgICAgdmVjQS5zdWIyKGZpbmdlci5qb2ludHNbMF0uX2xvY2FsUG9zaXRpb24sIGZpbmdlci5qb2ludHNbMV0uX2xvY2FsUG9zaXRpb24pLm5vcm1hbGl6ZSgpO1xuICAgICAgICB2ZWNCLnN1YjIoZmluZ2VyLmpvaW50c1syXS5fbG9jYWxQb3NpdGlvbiwgZmluZ2VyLmpvaW50c1szXS5fbG9jYWxQb3NpdGlvbikubm9ybWFsaXplKCk7XG4gICAgICAgIHJldHVybiB2ZWNBLmRvdCh2ZWNCKSA8IC0wLjg7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogUmV0dXJucyBqb2ludCBieSBYUkhhbmQgaWQgZnJvbSBsaXN0IGluIHNwZWNzOiBodHRwczovL2ltbWVyc2l2ZS13ZWIuZ2l0aHViLmlvL3dlYnhyLWhhbmQtaW5wdXQvLlxuICAgICAqXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gSWQgb2YgYSBqb2ludCBiYXNlZCBvbiBzcGVjcyBJRCdzIGluIFhSSGFuZDogaHR0cHM6Ly9pbW1lcnNpdmUtd2ViLmdpdGh1Yi5pby93ZWJ4ci1oYW5kLWlucHV0Ly5cbiAgICAgKiBAcmV0dXJucyB7WHJKb2ludHxudWxsfSBKb2ludCBvciBudWxsIGlmIG5vdCBhdmFpbGFibGUuXG4gICAgICovXG4gICAgZ2V0Sm9pbnRCeUlkKGlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9qb2ludHNCeUlkW2lkXSB8fCBudWxsO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIExpc3Qgb2YgZmluZ2VycyBvZiBhIGhhbmQuXG4gICAgICpcbiAgICAgKiBAdHlwZSB7WHJGaW5nZXJbXX1cbiAgICAgKi9cbiAgICBnZXQgZmluZ2VycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmdlcnM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogTGlzdCBvZiBqb2ludHMgb2YgaGFuZC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtYckpvaW50W119XG4gICAgICovXG4gICAgZ2V0IGpvaW50cygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2pvaW50cztcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBMaXN0IG9mIGpvaW50cyB0aGF0IGFyZSBmaW5nZXJ0aXBzLlxuICAgICAqXG4gICAgICogQHR5cGUge1hySm9pbnRbXX1cbiAgICAgKi9cbiAgICBnZXQgdGlwcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RpcHM7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogV3Jpc3Qgb2YgYSBoYW5kLCBvciBudWxsIGlmIGl0IGlzIG5vdCBhdmFpbGFibGUgYnkgV2ViWFIgdW5kZXJseWluZyBzeXN0ZW0uXG4gICAgICpcbiAgICAgKiBAdHlwZSB7WHJKb2ludHxudWxsfVxuICAgICAqL1xuICAgIGdldCB3cmlzdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dyaXN0O1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIFRydWUgaWYgdHJhY2tpbmcgaXMgYXZhaWxhYmxlLCBvdGhlcndpc2UgdHJhY2tpbmcgbWlnaHQgYmUgbG9zdC5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtib29sZWFufVxuICAgICAqL1xuICAgIGdldCB0cmFja2luZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYWNraW5nO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgWHJIYW5kIH07XG4iXSwibmFtZXMiOlsiZmluZ2VySm9pbnRJZHMiLCJ2ZWNBIiwiVmVjMyIsInZlY0IiLCJ2ZWNDIiwicGxhdGZvcm0iLCJicm93c2VyIiwid2luZG93IiwiWFJIYW5kIiwiWHJIYW5kIiwiRXZlbnRIYW5kbGVyIiwiY29uc3RydWN0b3IiLCJpbnB1dFNvdXJjZSIsIl9tYW5hZ2VyIiwiX2lucHV0U291cmNlIiwiX3RyYWNraW5nIiwiX2ZpbmdlcnMiLCJfam9pbnRzIiwiX2pvaW50c0J5SWQiLCJfdGlwcyIsIl93cmlzdCIsInhySGFuZCIsIl94cklucHV0U291cmNlIiwiaGFuZCIsImdldCIsImpvaW50IiwiWHJKb2ludCIsInB1c2giLCJ3cmlzdCIsImYiLCJsZW5ndGgiLCJmaW5nZXIiLCJYckZpbmdlciIsImoiLCJqb2ludElkIiwidGlwIiwiX3RpcCIsInVwZGF0ZSIsImZyYW1lIiwieHJJbnB1dFNvdXJjZSIsImpvaW50U3BhY2UiLCJfaWQiLCJwb3NlIiwic2Vzc2lvbiIsInZpc2liaWxpdHlTdGF0ZSIsImdldEpvaW50UG9zZSIsIl9yZWZlcmVuY2VTcGFjZSIsImZpcmUiLCJqMSIsImo0IiwiajYiLCJqOSIsImoxNiIsImoyMSIsIl9kaXJ0eVJheSIsIl9yYXlMb2NhbCIsIm9yaWdpbiIsImxlcnAiLCJfbG9jYWxQb3NpdGlvbiIsImpvaW50TCIsImpvaW50UiIsImhhbmRlZG5lc3MiLCJYUkhBTkRfTEVGVCIsInQiLCJzdWIyIiwiY3Jvc3MiLCJub3JtYWxpemUiLCJzdWIiLCJkaXJlY3Rpb24iLCJzcXVlZXppbmciLCJfZmluZ2VySXNDbG9zZWQiLCJfc3F1ZWV6aW5nIiwiaW5wdXQiLCJpbmRleCIsImpvaW50cyIsImRvdCIsImdldEpvaW50QnlJZCIsImlkIiwiZmluZ2VycyIsInRpcHMiLCJ0cmFja2luZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSUEsY0FBYyxHQUFHLEVBQUUsQ0FBQTtBQUV2QixNQUFNQyxJQUFJLEdBQUcsSUFBSUMsSUFBSSxFQUFFLENBQUE7QUFDdkIsTUFBTUMsSUFBSSxHQUFHLElBQUlELElBQUksRUFBRSxDQUFBO0FBQ3ZCLE1BQU1FLElBQUksR0FBRyxJQUFJRixJQUFJLEVBQUUsQ0FBQTtBQUV2QixJQUFJRyxRQUFRLENBQUNDLE9BQU8sSUFBSUMsTUFBTSxDQUFDQyxNQUFNLEVBQUU7RUFDbkNSLGNBQWMsR0FBRyxDQUNiLENBQUMsa0JBQWtCLEVBQUUsd0JBQXdCLEVBQUUsc0JBQXNCLEVBQUUsV0FBVyxDQUFDLEVBQ25GLENBQUMseUJBQXlCLEVBQUUsK0JBQStCLEVBQUUsbUNBQW1DLEVBQUUsNkJBQTZCLEVBQUUsa0JBQWtCLENBQUMsRUFDcEosQ0FBQywwQkFBMEIsRUFBRSxnQ0FBZ0MsRUFBRSxvQ0FBb0MsRUFBRSw4QkFBOEIsRUFBRSxtQkFBbUIsQ0FBQyxFQUN6SixDQUFDLHdCQUF3QixFQUFFLDhCQUE4QixFQUFFLGtDQUFrQyxFQUFFLDRCQUE0QixFQUFFLGlCQUFpQixDQUFDLEVBQy9JLENBQUMseUJBQXlCLEVBQUUsK0JBQStCLEVBQUUsbUNBQW1DLEVBQUUsNkJBQTZCLEVBQUUsa0JBQWtCLENBQUMsQ0FDdkosQ0FBQTtBQUNMLENBQUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTVMsTUFBTSxTQUFTQyxZQUFZLENBQUM7QUFpRDlC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
